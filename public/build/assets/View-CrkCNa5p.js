import{r as m,q as f,j as q,c as o,a as h,b as t,w as j,e as b,u as F,l as B,t as l,p as u,s as H,z as P,F as v,y,o as n}from"./app-D5MV6r13.js";import{_ as X}from"./Header-dBQtE1X9.js";import{_ as z}from"./Footer-BsV406YB.js";import{_ as $}from"./_plugin-vue_export-helper-DlAUqK2U.js";const G={class:"min-h-screen bg-white antialiased"},J={class:"mx-auto max-w-7xl px-3 sm:px-4 lg:px-8 py-10"},O={class:"mb-6 text-sm text-gray-600","aria-label":"Breadcrumb"},W={class:"flex items-center gap-2"},K={class:"text-gray-900 font-medium truncate max-w-[12rem] sm:max-w-none"},Q={class:"mb-6"},Y={class:"flex items-start justify-between gap-3"},Z={class:"flex-1"},tt={class:"text-center space-y-1"},et={key:0,class:"text-xl sm:text-2xl font-extrabold text-emerald-800 uppercase"},st={key:0},at={key:1,class:"text-emerald-900"},lt={class:"text-sm sm:text-base font-semibold text-sky-700 uppercase"},ot={class:"shrink-0 flex items-center gap-2 print:hidden"},nt=["value"],rt={class:"mb-6 text-center"},dt={class:"mt-2 overflow-x-auto"},it={class:"mx-auto inline-block rounded-lg border border-emerald-200 bg-emerald-50/70 p-1.5 shadow-sm ring-1 ring-inset ring-emerald-100"},ct={class:"divide-y divide-emerald-200 text-xs"},ut={class:"divide-y divide-emerald-100"},xt={class:"px-3 py-1 font-medium text-emerald-900"},mt={class:"px-3 py-1 text-center text-emerald-900"},pt={class:"px-3 py-1 text-center text-emerald-900"},ft={class:"px-3 py-1 text-center text-emerald-900"},vt={class:"px-3 py-1 text-center text-emerald-900"},yt={class:"px-3 py-1 text-center text-emerald-900"},ht={class:"overflow-x-auto rounded-xl border border-gray-200 bg-white shadow-lg"},bt={class:"min-w-full divide-y divide-gray-200 text-sm"},gt={class:"bg-gray-50"},_t={class:"leading-tight"},It={key:0,class:"mt-0.5 text-[10px] font-normal text-slate-500"},wt={class:"divide-y divide-gray-100"},kt={class:"px-3 py-2 text-slate-900 whitespace-nowrap"},At={class:"px-3 py-2 text-slate-900"},St={class:"px-3 py-2 text-slate-800"},Ct={class:"px-3 py-2 text-center text-slate-800"},Vt={class:"px-3 py-2 text-center text-slate-800"},Mt={class:"px-3 py-2 text-center text-slate-800"},jt={key:0},Ft=["colspan"],Bt={key:1},Rt=["colspan"],Et={class:"mt-10"},Nt={class:"overflow-x-auto rounded-xl border border-gray-200 bg-white shadow-lg"},Tt={class:"min-w-full divide-y divide-gray-200 text-sm"},Dt={class:"divide-y divide-gray-100"},Lt={class:"px-3 py-2 text-slate-900"},Ut={class:"flex items-center gap-2"},qt={key:0,class:"rounded-full bg-emerald-100 px-2 py-0.5 text-xs font-medium text-emerald-700"},Ht={key:1,class:"rounded-full bg-rose-100 px-2 py-0.5 text-xs font-medium text-rose-700"},Pt={class:"px-3 py-2 text-center text-slate-800"},Xt={class:"px-3 py-2 text-center text-slate-800"},zt={class:"px-3 py-2 text-center text-slate-800"},$t={class:"px-3 py-2 text-center text-slate-800"},Gt={class:"px-3 py-2 text-center text-slate-800"},Jt={class:"px-3 py-2 text-center text-slate-900 font-semibold"},Ot={key:0},Wt={__name:"View",props:{schoolId:{type:[String,Number],required:!0},examId:{type:Number,required:!0}},setup(S){const g=S,_=m(!1),C=m(""),d=m(null),I=m({F:{I:0,II:0,III:0,IV:0,0:0},M:{I:0,II:0,III:0,IV:0,0:0},T:{I:0,II:0,III:0,IV:0,0:0}}),i=m([]),p=m([]),c=m(""),E=f(()=>[{label:"F",...I.value.F},{label:"M",...I.value.M},{label:"T",...I.value.T}]);f(()=>{const a=Array.isArray(i.value)?i.value.slice():[];return a.sort((s,e)=>(e.aggregate||0)-(s.aggregate||0)),a.slice(0,3)}),f(()=>{const a=(Array.isArray(i.value)?i.value:[]).filter(s=>String(s.division||"").toUpperCase()==="0");return a.sort((s,e)=>(s.aggregate||0)-(e.aggregate||0)),a.slice(0,3)});const w=f(()=>{const a=new Set;for(const s of i.value)for(const e of s.subjects||[])e.code&&a.add(e.code);return Array.from(a).sort()}),R=f(()=>{const a={};for(const s of i.value)for(const e of s.subjects||[])e.code&&e.name&&!a[e.code]&&(a[e.code]=e.name);return a});function N(a,s){const e=(a.subjects||[]).find(r=>r.code===s);return e&&typeof e.marks=="number"?e.marks:"-"}function T(a){let s=0;for(const e of a.subjects||[])typeof e.marks=="number"&&(s+=e.marks);return s}function D(a){let s=0,e=0;for(const r of a.subjects||[])typeof r.marks=="number"&&(s+=r.marks,e++);return e?Math.round(s/e):0}async function L(){try{const s=await(await fetch(`/api/public/schools/${g.schoolId}/exams`,{headers:{"X-Requested-With":"XMLHttpRequest"}})).json();d.value=Array.isArray(s)&&s.find(e=>e.id===g.examId)||null}catch{d.value=null}}async function V(){_.value=!0;try{const a=new URL(`/api/public/schools/${g.schoolId}/exams/${g.examId}/results`,window.location.origin);c.value?a.searchParams.set("class_name",c.value):p.value.length>0&&a.searchParams.set("class_name",p.value[0]);const e=await(await fetch(a,{headers:{"X-Requested-With":"XMLHttpRequest"}})).json();C.value=e?.school?.school_name||"",p.value=Array.isArray(e?.classes)?e.classes:[],I.value=e?.summary||{F:{I:0,II:0,III:0,IV:0,0:0},M:{I:0,II:0,III:0,IV:0,0:0},T:{I:0,II:0,III:0,IV:0,0:0}},i.value=Array.isArray(e?.students)?e.students:[]}finally{_.value=!1}}q(async()=>{try{const s=new URLSearchParams(window.location.search).get("class_name");s&&(c.value=s)}catch{}await L(),await V(),!c.value&&p.value.length>0&&(c.value=p.value[0],await V())});function U(){window.print()}const M=f(()=>{const a=new Map;for(const e of i.value)for(const r of e.subjects||[]){const k=r.code||"SUBJ";a.has(k)||a.set(k,{code:k,A:0,B:0,C:0,D:0,F:0,sum:0,cnt:0});const x=a.get(k),A=String(r.grade||"").toUpperCase();A==="A"?x.A++:A==="B"?x.B++:A==="C"?x.C++:A==="D"?x.D++:x.F++,typeof r.marks=="number"&&(x.sum+=r.marks,x.cnt++)}const s=Array.from(a.values()).map(e=>({...e,avg:e.cnt?Math.round(e.sum/e.cnt):0}));return s.sort((e,r)=>r.avg-e.avg),s});return(a,s)=>(n(),o("div",G,[h(X),t("section",J,[t("nav",O,[t("ol",W,[t("li",null,[h(F(B),{href:"/",class:"hover:text-green-700"},{default:j(()=>[...s[1]||(s[1]=[b("Home",-1)])]),_:1})]),s[3]||(s[3]=t("li",null,"/",-1)),t("li",null,[h(F(B),{href:"/results/schools",class:"hover:text-green-700"},{default:j(()=>[...s[2]||(s[2]=[b("Results",-1)])]),_:1})]),s[4]||(s[4]=t("li",null,"/",-1)),t("li",null,[h(F(B),{href:a.route("results.schools.show",{id:S.schoolId}),class:"hover:text-green-700"},{default:j(()=>[b(l(C.value||"School"),1)]),_:1},8,["href"])]),s[5]||(s[5]=t("li",null,"/",-1)),t("li",K,l(d.value&&d.value.name||"Exam"),1)])]),t("div",Q,[t("div",Y,[t("div",Z,[t("div",tt,[s[6]||(s[6]=t("div",{class:"text-[11px] sm:text-xs tracking-wide text-gray-600 uppercase"},"Regional Administration and Local Government",-1)),s[7]||(s[7]=t("div",{class:"text-[11px] sm:text-xs tracking-wide text-gray-600 uppercase"},"Form Results",-1)),d.value?(n(),o("div",et,[b(l(d.value&&d.value.name||"Exam")+" Examination Results ",1),d.value&&d.value.year?(n(),o("span",st,", "+l(d.value.year),1)):u("",!0),c.value?(n(),o("span",at," - "+l(String(c.value).toUpperCase()),1)):u("",!0)])):u("",!0),t("div",lt,l(String(S.schoolId))+" - "+l(C.value||"School Centre"),1)])]),t("div",ot,[H(t("select",{"onUpdate:modelValue":s[0]||(s[0]=e=>c.value=e),onChange:V,class:"rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},[s[8]||(s[8]=t("option",{value:""},"Select Class",-1)),(n(!0),o(v,null,y(p.value,e=>(n(),o("option",{key:e,value:e},l(e),9,nt))),128))],544),[[P,c.value]]),t("button",{onClick:U,class:"inline-flex items-center rounded-md border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50"},[...s[9]||(s[9]=[t("svg",{class:"mr-2 h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[t("path",{d:"M19 8H5a3 3 0 0 0-3 3v5h4v4h12v-4h4v-5a3 3 0 0 0-3-3zM7 18h10v2H7v-2zm13-3H4v-4a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v4z"}),t("path",{d:"M17 2H7v4h10V2z"})],-1),b(" Print ",-1)])])])])]),t("div",rt,[s[11]||(s[11]=t("div",{class:"text-center text-xs font-semibold text-emerald-800 uppercase"},"Division Performance Summary",-1)),t("div",dt,[t("div",it,[t("table",ct,[s[10]||(s[10]=t("thead",null,[t("tr",{class:"bg-emerald-100/70"},[t("th",{class:"px-3 py-1 text-left font-semibold text-emerald-900"},"SEX"),t("th",{class:"px-3 py-1 text-center font-semibold text-emerald-900"},"I"),t("th",{class:"px-3 py-1 text-center font-semibold text-emerald-900"},"II"),t("th",{class:"px-3 py-1 text-center font-semibold text-emerald-900"},"III"),t("th",{class:"px-3 py-1 text-center font-semibold text-emerald-900"},"IV"),t("th",{class:"px-3 py-1 text-center font-semibold text-emerald-900"},"0")])],-1)),t("tbody",ut,[(n(!0),o(v,null,y(E.value,e=>(n(),o("tr",{key:e.label,class:"bg-white/70"},[t("td",xt,l(e.label),1),t("td",mt,l(e.I),1),t("td",pt,l(e.II),1),t("td",ft,l(e.III),1),t("td",vt,l(e.IV),1),t("td",yt,l(e[0]),1)]))),128))])])])])]),t("div",ht,[t("table",bt,[t("thead",gt,[t("tr",null,[s[12]||(s[12]=t("th",{class:"px-3 py-1 text-left font-semibold text-rose-900"},"CNO",-1)),s[13]||(s[13]=t("th",{class:"px-3 py-2 text-left font-semibold text-slate-800"},"STUDENT NAME",-1)),s[14]||(s[14]=t("th",{class:"px-3 py-2 text-left font-semibold text-slate-800"},"SEX",-1)),(n(!0),o(v,null,y(w.value,e=>(n(),o("th",{key:e,class:"px-3 py-2 text-center font-semibold text-slate-800"},[t("div",_t,[t("div",null,l(e),1),R.value[e]?(n(),o("div",It,l(R.value[e]),1)):u("",!0)])]))),128)),s[15]||(s[15]=t("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"TOTAL",-1)),s[16]||(s[16]=t("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"AVG",-1)),s[17]||(s[17]=t("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"DIV",-1))])]),t("tbody",wt,[(n(!0),o(v,null,y(i.value,e=>(n(),o("tr",{key:e.reg_no,class:"hover:bg-slate-50"},[t("td",kt,l(e.reg_no),1),t("td",At,l(e.name||e.student_name||"â€”"),1),t("td",St,l(e.sex),1),(n(!0),o(v,null,y(w.value,r=>(n(),o("td",{key:r,class:"px-3 py-2 text-center text-slate-800"},l(N(e,r)),1))),128)),t("td",Ct,l(T(e)),1),t("td",Vt,l(D(e)),1),t("td",Mt,l(e.division),1)]))),128)),!_.value&&i.value.length===0?(n(),o("tr",jt,[t("td",{colspan:3+w.value.length+3,class:"px-3 py-8 text-center text-gray-600"},"No results found.",8,Ft)])):u("",!0),_.value?(n(),o("tr",Bt,[t("td",{colspan:3+w.value.length+3,class:"px-3 py-8 text-center text-gray-600"},"Loading results...",8,Rt)])):u("",!0)])])]),t("div",Et,[s[20]||(s[20]=t("div",{class:"mb-3 text-center text-sm font-semibold text-slate-800"},"Performance by Subject",-1)),t("div",Nt,[t("table",Tt,[s[19]||(s[19]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-3 py-2 text-left font-semibold text-slate-800"},"SUBJECT"),t("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"A"),t("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"B"),t("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"C"),t("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"D"),t("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"F"),t("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"AVERAGE")])],-1)),t("tbody",Dt,[(n(!0),o(v,null,y(M.value,(e,r)=>(n(),o("tr",{key:e.code,class:"hover:bg-slate-50"},[t("td",Lt,[t("div",Ut,[t("span",null,l(e.code),1),r===0?(n(),o("span",qt,"Best")):r===M.value.length-1?(n(),o("span",Ht,"Lowest")):u("",!0)])]),t("td",Pt,l(e.A),1),t("td",Xt,l(e.B),1),t("td",zt,l(e.C),1),t("td",$t,l(e.D),1),t("td",Gt,l(e.F),1),t("td",Jt,l(e.avg),1)]))),128)),M.value.length===0?(n(),o("tr",Ot,[...s[18]||(s[18]=[t("td",{colspan:"7",class:"px-3 py-8 text-center text-gray-600"},"No subject data.",-1)])])):u("",!0)])])])])]),h(z)]))}},te=$(Wt,[["__scopeId","data-v-b303ff57"]]);export{te as default};
