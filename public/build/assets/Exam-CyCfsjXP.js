import{r as _,q as p,G as z,c as l,a as I,u as L,h as D,w as V,b as e,p as M,s as E,o,F as h,y as w,t as d,z as O,m as U,l as X,e as G}from"./app-BJQxAt22.js";import{_ as H}from"./AuthenticatedLayout-DmZHm018.js";const W={class:"flex flex-col gap-2 sm:flex-row sm:items-end sm:justify-between"},Y={class:"text-xl font-semibold leading-tight text-gray-800"},Z={class:"mt-1 text-sm text-gray-600"},J={class:"flex items-center gap-2"},K={class:"space-y-4"},Q={class:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between"},ee={class:"grid w-full grid-cols-1 gap-2 sm:grid-cols-3"},te=["value"],se=["value"],ae={class:"grid grid-cols-1 gap-4 md:grid-cols-3"},le={class:"rounded-lg border bg-white p-4 shadow-sm"},oe={class:"mt-3 flex items-center gap-4"},de={viewBox:"0 0 120 120",width:"120",height:"120"},re=["d"],ne=["d"],ie={class:"text-2xl font-semibold text-gray-900"},ue={class:"text-xs text-gray-500"},ce={class:"md:col-span-2 rounded-lg border bg-white p-4 shadow-sm"},me={class:"mt-3 space-y-2"},ve={class:"w-40 truncate text-xs text-gray-700"},xe={class:"h-3 w-full rounded bg-gray-100"},he={class:"w-10 text-right text-xs text-gray-700"},ge={key:0,class:"text-xs text-gray-500"},ye={class:"overflow-hidden rounded-lg border bg-white shadow-sm"},fe={class:"overflow-x-auto"},pe={class:"min-w-full divide-y divide-gray-200 text-sm"},be={class:"divide-y divide-gray-100"},_e={key:0},we={class:"px-4 py-2 text-gray-900"},ke={class:"px-4 py-2 text-gray-800"},je={class:"px-4 py-2 text-gray-700"},$e={class:"px-4 py-2 text-gray-900"},Me={key:0},Ne={key:0,class:"rounded-md border border-rose-200 bg-rose-50 p-3 text-sm text-rose-700"},Ae={__name:"Exam",props:{teacher:{type:Object,required:!0},exam:{type:Object,required:!0}},setup(c){const N=c,b=_(""),g=_(""),q=_(!1),k=_(""),u=_({subjects:[],students:[],marks:{}}),B=p(()=>new Set((N.teacher.subjects||[]).map(a=>a.id))),R=p(()=>N.teacher.classes||[]),T=p(()=>(u.value.subjects||[]).filter(a=>B.value.has(a.id)));async function C(){if(k.value="",u.value={subjects:[],students:[],marks:{}},!!b.value){q.value=!0;try{const a=route("results.exams.marks",{examId:N.exam.id})+`?class_id=${b.value}`,s=await fetch(a,{headers:{"X-Requested-With":"XMLHttpRequest"}});if(!s.ok)throw new Error("Failed to load");const t=await s.json(),r=Array.isArray(t?.subjects)?t.subjects:[],m=Array.isArray(t?.students)?t.students:[],v=t?.marks||{},n=r.filter(i=>B.value.has(i.id));u.value={subjects:n,students:m,marks:v}}catch{k.value="Could not load results. Please try again."}finally{q.value=!1}}}const j=p(()=>{const a=u.value.subjects||[],s=u.value.students||[],t=u.value.marks||{},r=g.value?Number(g.value):null;let m=0,v=0;const n=[];for(const i of a){if(r&&i.id!==r)continue;let x=0,y=0,$=0;for(const S of s){const A=`${S.id}_${i.id}`,f=Number(t[A]??NaN);Number.isFinite(f)&&(x+=f,y+=1,f>=40&&($+=1),m+=1,f>=40&&(v+=1))}n.push({id:i.id,name:i.name,avg:y?Math.round(x/y*10)/10:0,cnt:y,pass:$})}return n.sort((i,x)=>x.avg-i.avg),{total:m,pass:v,perSubject:n}}),P=p(()=>{const a=j.value.total||1,s=j.value.pass,t=s/a*2*Math.PI;function r(m,v,n,i,x){const y=m+n*Math.cos(i),$=v+n*Math.sin(i),S=m+n*Math.cos(x),A=v+n*Math.sin(x),f=x-i>Math.PI?1:0;return`M ${m} ${v} L ${y} ${$} A ${n} ${n} 0 ${f} 1 ${S} ${A} Z`}return{passPath:r(60,60,50,0,t),failPath:r(60,60,50,t,2*Math.PI),passPct:Math.round(s/a*100)}}),F=p(()=>{const a=j.value.perSubject,s=Math.max(100,...a.map(t=>t.avg));return a.map((t,r)=>({name:t.name,width:Math.max(0,t.avg/s*100),value:t.avg,idx:r}))});return z(b,C),(a,s)=>(o(),l(h,null,[I(L(D),{title:`Exam • ${c.exam.name} • ${c.teacher.name}`},null,8,["title"]),I(H,null,{header:V(()=>[e("div",W,[e("div",null,[e("h2",Y,d(c.teacher.name)+" — "+d(c.exam.name),1),e("div",Z,"Type: "+d(c.exam.type)+" · Year "+d(c.exam.year)+" · Term "+d(c.exam.term),1)]),e("div",J,[I(L(X),{href:a.route("teachers.show",{id:c.teacher.id}),class:"text-sm text-emerald-700 hover:text-emerald-900"},{default:V(()=>[...s[2]||(s[2]=[G("← Back to teacher",-1)])]),_:1},8,["href"])])])]),default:V(()=>[e("div",K,[e("div",Q,[e("div",ee,[E(e("select",{"onUpdate:modelValue":s[0]||(s[0]=t=>b.value=t),class:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-emerald-500 focus:ring-emerald-500"},[s[3]||(s[3]=e("option",{value:""},"Select class...",-1)),(o(!0),l(h,null,w(R.value,t=>(o(),l("option",{key:t.id,value:t.id},d(t.name),9,te))),128))],512),[[O,b.value]]),E(e("select",{"onUpdate:modelValue":s[1]||(s[1]=t=>g.value=t),class:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-emerald-500 focus:ring-emerald-500"},[s[4]||(s[4]=e("option",{value:""},"All subjects",-1)),(o(!0),l(h,null,w(T.value,t=>(o(),l("option",{key:t.id,value:t.id},d(t.name),9,se))),128))],512),[[O,g.value]]),e("button",{onClick:C,class:"rounded-md border border-gray-300 px-3 py-2 text-sm text-gray-700 hover:bg-gray-50"},"Load")])]),e("div",ae,[e("div",le,[s[5]||(s[5]=e("div",{class:"text-sm font-medium text-gray-600"},"Pass rate",-1)),e("div",oe,[(o(),l("svg",de,[e("path",{d:P.value.failPath,fill:"#fee2e2"},null,8,re),e("path",{d:P.value.passPath,fill:"#34d399"},null,8,ne)])),e("div",null,[e("div",ie,d(P.value.passPct)+"%",1),e("div",ue,"of "+d(j.value.total)+" marks",1)])])]),e("div",ce,[s[6]||(s[6]=e("div",{class:"text-sm font-medium text-gray-600"},"Average by subject",-1)),e("div",me,[(o(!0),l(h,null,w(F.value,t=>(o(),l("div",{key:t.idx,class:"flex items-center gap-3"},[e("div",ve,d(t.name),1),e("div",xe,[e("div",{class:"h-3 rounded bg-emerald-500",style:U({width:t.width+"%"})},null,4)]),e("div",he,d(t.value),1)]))),128)),F.value.length===0?(o(),l("div",ge,"No data")):M("",!0)])])]),e("div",ye,[e("div",fe,[e("table",pe,[s[8]||(s[8]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"},"Reg No"),e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"},"Student"),e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"},"Subject"),e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"},"Marks")])],-1)),e("tbody",be,[(o(!0),l(h,null,w(u.value.students,t=>(o(),l(h,{key:t.id},[(o(!0),l(h,null,w(u.value.subjects,r=>(o(),l(h,{key:r.id},[!g.value||Number(g.value)===r.id?(o(),l("tr",_e,[e("td",we,d(t.reg_no),1),e("td",ke,d(t.name),1),e("td",je,d(r.name),1),e("td",$e,d(Number(u.value.marks[`${t.id}_${r.id}`]??NaN)||""),1)])):M("",!0)],64))),128))],64))),128)),(u.value.students||[]).length===0||(u.value.subjects||[]).length===0?(o(),l("tr",Me,[...s[7]||(s[7]=[e("td",{colspan:"4",class:"px-4 py-8 text-center text-sm text-gray-500"},"Select class and click Load to view results.",-1)])])):M("",!0)])])])]),k.value?(o(),l("div",Ne,d(k.value),1)):M("",!0)])]),_:1})],64))}};export{Ae as default};
