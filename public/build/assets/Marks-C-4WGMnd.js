import{r as u,m as p,g as D,k as a,a as T,d as L,h as H,w as B,b as o,l as A,o as i,F as x,x as b,n as $,t as d,G as P,e as U}from"./app-CYc99-6i.js";import{_ as W}from"./AuthenticatedLayout-BcxgN9rk.js";import{_ as I}from"./_plugin-vue_export-helper-DlAUqK2U.js";const J={class:"flex items-center justify-between"},Q={class:"text-xl font-semibold leading-tight text-gray-800"},Y={class:"space-y-4"},Z={class:"rounded-xl border border-gray-100 bg-white p-4 shadow-sm"},ee={class:"flex flex-wrap gap-2"},te=["onClick"],re={key:0,class:"text-sm text-gray-500"},oe={class:"rounded-xl border border-gray-100 bg-white p-4 shadow-sm"},se={class:"mb-3 flex items-center justify-between"},ne={class:"text-xs text-gray-500"},ae={key:0,class:"text-sm text-gray-500"},ie={key:1},le={key:0,class:"text-sm text-gray-500"},de={key:1,class:"overflow-x-auto"},ue={class:"bg-gray-50"},ce=["title"],ye={class:"sticky left-0 bg-white px-3 py-2 text-gray-900 whitespace-nowrap border-t border-r border-gray-200"},ge={class:"sticky left-28 bg-white px-3 py-2 text-gray-700 whitespace-nowrap border-t border-r border-gray-200"},me={class:"relative inline-block"},fe=["value","onInput","onChange","onBlur","onKeydown","onFocus","data-student","data-subject","disabled"],pe={key:0,class:"pointer-events-none absolute -right-1 -top-1 inline-flex h-3.5 w-3.5 items-center justify-center rounded-full bg-emerald-500 text-white"},xe={key:1,class:"pointer-events-none absolute -right-1 -top-1 inline-flex h-3.5 w-3.5 items-center justify-center rounded-full bg-blue-500/90 text-white"},ve={class:"px-2 py-1 text-center text-gray-900 font-medium border-t border-l border-gray-200"},be={class:"px-2 py-1 text-center text-gray-700 border-t border-gray-200"},he={class:"px-2 py-1 text-center text-gray-700 border-t border-gray-200"},we={class:"px-2 py-1 text-center text-gray-700 border-t border-gray-200"},ke={class:"px-2 py-1 text-center text-gray-700 border-t border-gray-200"},_e={__name:"Marks",props:{exam:{type:Object,required:!0}},setup(c){const h=c,w=u(null),k=u(!1),y=u([]),f=u([]),g=u({});u(!1);const N=u(new Set),_=u(new Set),v=new Map,C=u(new Set);function j(){const e=document.querySelector('meta[name="csrf-token"]');if(e&&e.getAttribute("content"))return e.getAttribute("content");const t=document.cookie.match(/(?:^|; )XSRF-TOKEN=([^;]+)/);return t?decodeURIComponent(t[1]):""}function E(e,t,r=0){const n=l(e,t);console.log("Scheduling save for",n),v.has(n)&&clearTimeout(v.get(n));const s=setTimeout(()=>{console.log("Auto-saving",n),saveSingle(e,t),v.delete(n)},r);v.set(n,s)}async function K(e){w.value=e,k.value=!0;try{const t=route("results.exams.marks",{examId:h.exam.id,class_id:e}),r=await fetch(t,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":j()}}),n=r.ok?await r.json():{students:[]};y.value=n.students||[],f.value=n.subjects||[],g.value=Object.assign({},n.marks||{})}finally{k.value=!1}}function z(e,t){const r=g.value[l(e,t)];return r==null||r===""?!1:typeof r!="number"?!0:r<0||r>100}p(()=>{for(const e of y.value)for(const t of f.value)if(z(e.id,t.id))return!0;return!1});const G=p(()=>(f.value||[]).length||0);function R(e,t){const r=g.value[l(e,t)];return typeof r=="number"?r:null}const M=p(()=>{const e={};for(const t of y.value){let r=0;for(const n of f.value){const s=R(t.id,n.id);typeof s=="number"&&(r+=s)}e[t.id]=r}return e}),S=p(()=>{const e={},t=G.value||1;for(const r of y.value)e[r.id]=M.value[r.id]/t;return e}),q=p(()=>{const e=y.value.map(s=>({id:s.id,total:M.value[s.id]||0}));e.sort((s,F)=>F.total-s.total);const t={};let r=0,n=null;for(const s of e)(n===null||s.total<n)&&(r+=1),t[s.id]=r,n=s.total;return t});function O(e){return e>=75?"I":e>=60?"II":e>=45?"III":e>=30?"IV":"0"}function V(e){return e>=75?"A":e>=65?"B":e>=45?"C":e>=30?"D":"F"}D(()=>{const e=(h.exam.classes||[])[0];e&&e.id&&K(e.id)});function l(e,t){return`${e}_${t}`}function X(e,t,r){const n=r.target.value;if(n===""||n===null){g.value[l(e,t)]=null,C.value.add(l(e,t));return}let s=Number(n);if(Number.isNaN(s)){g.value[l(e,t)]=null,C.value.add(l(e,t));return}s<0&&(s=0,window.__toast&&window.__toast("warning","Marks cannot be below 0")),s>100&&(s=100,window.__toast&&window.__toast("warning","Marks cannot exceed 100")),g.value[l(e,t)]=s,C.value.add(l(e,t)),E(e,t)}return p(()=>{const e=(h.exam.classes||[]).find(t=>t.id===w.value);return e?e.name:null}),(e,t)=>(i(),a(x,null,[T(L(H),{title:`Marks - ${c.exam.name}`},null,8,["title"]),T(W,null,{header:B(()=>[o("div",J,[o("h2",Q," Marks: "+d(c.exam.name)+" ("+d(c.exam.year)+"/T"+d(c.exam.term)+") ",1)])]),default:B(()=>[o("div",Y,[o("div",Z,[t[1]||(t[1]=o("div",{class:"mb-3 text-sm font-medium text-gray-700"},"Classes",-1)),o("div",ee,[(i(!0),a(x,null,b(c.exam.classes||[],r=>(i(),a("button",{key:r.id,type:"button",onClick:n=>K(r.id),class:$(["rounded-md px-3 py-1.5 text-sm ring-1 ring-inset",w.value===r.id?"bg-green-600 text-white ring-green-600":"bg-white text-gray-700 ring-gray-300 hover:bg-gray-50"])},d(r.name),11,te))),128)),!c.exam.classes||c.exam.classes.length===0?(i(),a("div",re,"No classes assigned to this exam.")):A("",!0)])]),o("div",oe,[o("div",se,[t[2]||(t[2]=o("div",{class:"text-sm font-medium text-gray-700"},"Students",-1)),o("div",ne,d(y.value.length)+" total",1)]),k.value?(i(),a("div",ae,"Loading...")):(i(),a("div",ie,[y.value.length===0?(i(),a("div",le,"Select a class to load students.")):(i(),a("div",de,[o("table",{class:"min-w-full border border-gray-200 text-sm",onKeydown:t[0]||(t[0]=P(U((...r)=>e.onGlobalEnter&&e.onGlobalEnter(...r),["stop","prevent"]),["enter"])),tabindex:"0"},[o("thead",ue,[o("tr",null,[t[3]||(t[3]=o("th",{class:"sticky top-0 left-0 z-20 bg-gray-50 px-3 py-2 text-left font-semibold text-gray-700 border-r border-gray-200"},"Reg No",-1)),t[4]||(t[4]=o("th",{class:"sticky top-0 left-28 z-20 bg-gray-50 px-3 py-2 text-left font-semibold text-gray-700 border-r border-gray-200"},"Full Name",-1)),(i(!0),a(x,null,b(f.value,r=>(i(),a("th",{key:r.id,title:r.name||"",class:"sticky top-0 z-10 bg-gray-50 px-2 py-2 text-center font-semibold text-gray-700 whitespace-nowrap border-r border-gray-200"},d((r.name||"").toString().slice(0,12)),9,ce))),128)),t[5]||(t[5]=o("th",{class:"sticky top-0 z-10 bg-gray-50 px-2 py-2 text-center font-semibold text-gray-700 whitespace-nowrap border-l border-gray-200"},"Total",-1)),t[6]||(t[6]=o("th",{class:"sticky top-0 z-10 bg-gray-50 px-2 py-2 text-center font-semibold text-gray-700 whitespace-nowrap"},"Grade",-1)),t[7]||(t[7]=o("th",{class:"sticky top-0 z-10 bg-gray-50 px-2 py-2 text-center font-semibold text-gray-700 whitespace-nowrap"},"Average",-1)),t[8]||(t[8]=o("th",{class:"sticky top-0 z-10 bg-gray-50 px-2 py-2 text-center font-semibold text-gray-700 whitespace-nowrap"},"Position",-1)),t[9]||(t[9]=o("th",{class:"sticky top-0 z-10 bg-gray-50 px-2 py-2 text-center font-semibold text-gray-700 whitespace-nowrap"},"Division",-1))])]),o("tbody",null,[(i(!0),a(x,null,b(y.value,(r,n)=>(i(),a("tr",{key:r.id,class:"odd:bg-gray-50 hover:bg-gray-50"},[o("td",ye,d(r.reg_no),1),o("td",ge,d(r.name),1),(i(!0),a(x,null,b(f.value,(s,F)=>(i(),a("td",{key:s.id,class:"px-2 py-1 text-center border-t border-r border-gray-200"},[o("div",me,[o("input",{type:"text",inputmode:"numeric",min:"0",max:"100",step:"1",value:g.value[l(r.id,s.id)]??"",placeholder:"-",onInput:m=>X(r.id,s.id,m),onChange:m=>e.saveSingle(r.id,s.id),onBlur:m=>e.saveSingle(r.id,s.id),onKeydown:m=>e.onCellKey(m,n,F),onFocus:m=>e.onCellFocus(n,s.id,m),"data-student":r.id,"data-subject":s.id,class:$(["marks-cell w-14 rounded-md border bg-white px-2 py-1 text-center text-sm placeholder-gray-400 focus:border-blue-500 focus:ring-2 focus:ring-blue-300 transition-shadow",z(r.id,s.id)?"border-rose-400 text-rose-700":"border-gray-300 text-gray-900",N.value.has(l(r.id,s.id))?"ring-2 ring-emerald-400":"",_.value.has(l(r.id,s.id))?"opacity-70 cursor-wait":""]),disabled:_.value.has(l(r.id,s.id))},null,42,fe),N.value.has(l(r.id,s.id))?(i(),a("span",pe,[...t[10]||(t[10]=[o("svg",{viewBox:"0 0 20 20",fill:"none",class:"h-2.5 w-2.5"},[o("path",{d:"M5 10l3 3 7-7",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])):_.value.has(l(r.id,s.id))?(i(),a("span",xe,[...t[11]||(t[11]=[o("svg",{class:"h-2.5 w-2.5 animate-spin",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[o("circle",{cx:"12",cy:"12",r:"9","stroke-opacity":"0.25"}),o("path",{d:"M21 12a9 9 0 0 1-9 9","stroke-linecap":"round"})],-1)])])):A("",!0)])]))),128)),o("td",ve,d(M.value[r.id]??0),1),o("td",be,d(V(S.value[r.id]??0)),1),o("td",he,d((S.value[r.id]??0).toFixed(1)),1),o("td",we,d(q.value[r.id]??"-"),1),o("td",ke,d(O(S.value[r.id]??0)),1)]))),128))])],32)]))]))])])]),_:1})],64))}},Fe=I(_e,[["__scopeId","data-v-2411173a"]]);export{Fe as default};
