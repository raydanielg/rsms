import{r as p,g as h,v as U,c as i,a as _,b as e,w as F,e as I,u as j,l as B,t as o,i as f,z as q,B as X,F as v,k as g,o as d,n as G}from"./app-BoWaoUwb.js";import{_ as O}from"./Header-CkYcwMAp.js";import{_ as W}from"./Footer-BUjBz6Ic.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const J={class:"min-h-screen bg-white antialiased"},K={class:"mx-auto max-w-7xl px-3 sm:px-4 lg:px-8 py-10"},Q={class:"mb-6 text-sm text-gray-600","aria-label":"Breadcrumb"},Y={class:"flex items-center gap-2"},ee={class:"text-gray-900 font-medium truncate max-w-[12rem] sm:max-w-none"},te={class:"mb-6"},se={class:"flex items-start justify-between gap-3"},ae={class:"flex-1"},le={class:"text-center space-y-1"},ne={key:0,class:"text-xl sm:text-2xl font-extrabold text-emerald-800 uppercase"},oe={key:0},re={key:1,class:"text-emerald-900"},ie={class:"text-sm sm:text-base font-semibold text-sky-700 uppercase"},de={class:"shrink-0 flex items-center gap-2 print:hidden"},ce=["value"],ue={class:"mb-6 text-center"},xe={class:"mt-2 overflow-x-auto"},me={class:"mx-auto inline-block rounded-lg border border-emerald-200 bg-emerald-50/70 p-1.5 shadow-sm ring-1 ring-inset ring-emerald-100"},pe={class:"divide-y divide-emerald-200 text-xs"},fe={class:"divide-y divide-emerald-100"},ye={class:"px-3 py-1 font-medium text-emerald-900"},he={class:"px-3 py-1 text-center text-emerald-900"},ve={class:"px-3 py-1 text-center text-emerald-900"},ge={class:"px-3 py-1 text-center text-emerald-900"},be={class:"px-3 py-1 text-center text-emerald-900"},_e={class:"px-3 py-1 text-center text-emerald-900"},Ie={class:"overflow-x-auto rounded-xl border border-gray-200 bg-white shadow-lg"},ke={class:"min-w-full divide-y divide-gray-200 text-sm"},we={class:"bg-gray-50"},Ae={class:"leading-tight"},Ce={class:"divide-y divide-gray-100"},Se={class:"px-3 py-2 text-slate-900 whitespace-nowrap"},Re={class:"px-3 py-2 text-slate-900"},Ne={class:"px-3 py-2 text-slate-800"},Me={class:"px-3 py-2 text-center text-slate-800"},Ve={class:"px-3 py-2 text-center text-slate-800"},Fe={class:"px-3 py-2 text-center text-slate-800"},je={class:"px-3 py-2 text-center text-slate-800"},Be={key:0},De=["colspan"],Le={key:1},Ee=["colspan"],Te={class:"mt-10"},ze={class:"overflow-x-auto rounded-xl border border-gray-200 bg-white shadow-lg"},$e={class:"min-w-full divide-y divide-gray-200 text-sm"},Pe={class:"divide-y divide-gray-100"},He={class:"px-3 py-2 text-sm font-semibold text-slate-700"},Ue={class:"px-3 py-2 text-slate-900"},qe={class:"flex items-center gap-2"},Xe={class:"font-medium"},Ge={key:0,class:"rounded-full bg-emerald-100 px-2 py-0.5 text-xs font-medium text-emerald-700"},Oe={key:1,class:"rounded-full bg-rose-100 px-2 py-0.5 text-xs font-medium text-rose-700"},We={class:"px-3 py-2 text-center text-slate-700"},Ze={class:"px-3 py-2 text-center"},Je={class:"px-3 py-2 text-center"},Ke={class:"inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold bg-rose-100 text-rose-700"},Qe={class:"px-3 py-2 text-center text-emerald-700 font-medium"},Ye={class:"px-3 py-2 text-center text-emerald-600"},et={class:"px-3 py-2 text-center text-amber-600"},tt={class:"px-3 py-2 text-center text-orange-500"},st={class:"px-3 py-2 text-center text-rose-600 font-semibold"},at={class:"px-3 py-2 text-center text-slate-900 font-semibold"},lt={key:0},nt={__name:"View",props:{schoolId:{type:[String,Number],required:!0},examId:{type:Number,required:!0}},setup(S){const k=S,w=p(!1),R=p(""),u=p(null),A=p({F:{I:0,II:0,III:0,IV:0,0:0},M:{I:0,II:0,III:0,IV:0,0:0},T:{I:0,II:0,III:0,IV:0,0:0}}),x=p([]),y=p([]),m=p(""),L=h(()=>[{label:"F",...A.value.F},{label:"M",...A.value.M},{label:"T",...A.value.T}]);h(()=>{const a=Array.isArray(x.value)?x.value.slice():[];return a.sort((t,s)=>(s.aggregate||0)-(t.aggregate||0)),a.slice(0,3)}),h(()=>{const a=(Array.isArray(x.value)?x.value:[]).filter(t=>String(t.division||"").toUpperCase()==="0");return a.sort((t,s)=>(t.aggregate||0)-(s.aggregate||0)),a.slice(0,3)});function N(a,t){const s=[a?.name,a?.title,a?.label,a?.full_name,a?.code],l=s.find(r=>typeof r=="string"&&/[A-Za-z]/.test(r));if(l)return l;const n=s.find(r=>typeof r=="string"&&r.trim()!=="");return n||`Subject ${t}`}const b=h(()=>{const a=new Map;let t=1;for(const s of x.value)for(const l of s.subjects||[]){const n=l.code??l.name??`subject-${t}`;if(!a.has(n))a.set(n,{key:n,code:l.code??null,name:l.name??null,displayName:N(l,t)}),t++;else{const r=a.get(n);!r.name&&l.name&&(r.name=l.name),!r.code&&l.code&&(r.code=l.code),(!r.displayName||!/[A-Za-z]/.test(r.displayName))&&(r.displayName=N(l,t))}}return Array.from(a.values())});h(()=>{const a=new Map;for(const t of b.value)t.code&&a.set(t.code,t.displayName),t.name&&a.set(t.name,t.displayName),a.set(t.key,t.displayName);return a});function E(a,t){const s=a.subjects||[];let l=null;if(t.code&&(l=s.find(n=>n.code===t.code)),!l&&t.name){const n=String(t.name).toLowerCase();l=s.find(r=>String(r.name||"").toLowerCase()===n)}return l&&typeof l.marks=="number"?l.marks:"-"}function T(a){let t=0;for(const s of a.subjects||[])typeof s.marks=="number"&&(t+=s.marks);return t}function D(a){let t=0,s=0;for(const l of a.subjects||[])typeof l.marks=="number"&&(t+=l.marks,s++);return s?Math.round(t/s):0}function z(a){const t=D(a);return t>=75?"A":t>=65?"B":t>=55?"C":t>=40?"D":t>0?"F":"-"}function $(a){return a>=80?"bg-emerald-100 text-emerald-700":a>=60?"bg-sky-100 text-sky-700":a>=40?"bg-amber-100 text-amber-700":"bg-rose-100 text-rose-700"}async function P(){try{const t=await(await fetch(`/api/public/schools/${k.schoolId}/exams`,{headers:{"X-Requested-With":"XMLHttpRequest"}})).json();u.value=Array.isArray(t)&&t.find(s=>s.id===k.examId)||null}catch{u.value=null}}async function M(){w.value=!0;try{const a=new URL(`/api/public/schools/${k.schoolId}/exams/${k.examId}/results`,window.location.origin);m.value?a.searchParams.set("class_name",m.value):y.value.length>0&&a.searchParams.set("class_name",y.value[0]);const s=await(await fetch(a,{headers:{"X-Requested-With":"XMLHttpRequest"}})).json();R.value=s?.school?.school_name||"",y.value=Array.isArray(s?.classes)?s.classes:[],A.value=s?.summary||{F:{I:0,II:0,III:0,IV:0,0:0},M:{I:0,II:0,III:0,IV:0,0:0},T:{I:0,II:0,III:0,IV:0,0:0}},x.value=Array.isArray(s?.students)?s.students:[]}finally{w.value=!1}}U(async()=>{try{const t=new URLSearchParams(window.location.search).get("class_name");t&&(m.value=t)}catch{}await P(),await M(),!m.value&&y.value.length>0&&(m.value=y.value[0],await M())});function H(){window.print()}const V=h(()=>{const a=new Map;let t=1;for(const l of x.value)for(const n of l.subjects||[]){const r=n.code??n.name??`subject-${t}`;a.has(r)||(a.set(r,{key:r,code:n.code??null,name:n.name??n.code??`Subject ${t}`,A:0,B:0,C:0,D:0,F:0,sum:0,cnt:0,pass:0,learners:new Set,displayName:N(n,t)}),t++);const c=a.get(r),C=String(n.grade||"").toUpperCase();C==="A"?c.A++:C==="B"?c.B++:C==="C"?c.C++:C==="D"?c.D++:c.F++,typeof n.marks=="number"&&(c.sum+=n.marks,c.cnt++),typeof n.marks=="number"&&n.marks>=40&&c.pass++,l?.reg_no&&c.learners.add(l.reg_no)}const s=Array.from(a.values()).map(l=>{const n=l.learners.size||l.cnt,r=l.cnt?Math.round(l.sum/l.cnt):0,c=n?Math.round(l.pass/n*100):0;return{...l,candidateCount:n,avg:r,passRate:c,failRate:n?Math.round((n-l.pass)/n*100):0}});return s.sort((l,n)=>n.passRate===l.passRate?n.avg-l.avg:n.passRate-l.passRate),s.map((l,n)=>({...l,position:n+1}))});return(a,t)=>(d(),i("div",J,[_(O),e("section",K,[e("nav",Q,[e("ol",Y,[e("li",null,[_(j(B),{href:"/",class:"hover:text-green-700"},{default:F(()=>[...t[1]||(t[1]=[I("Home",-1)])]),_:1})]),t[3]||(t[3]=e("li",null,"/",-1)),e("li",null,[_(j(B),{href:"/results/schools",class:"hover:text-green-700"},{default:F(()=>[...t[2]||(t[2]=[I("Results",-1)])]),_:1})]),t[4]||(t[4]=e("li",null,"/",-1)),e("li",null,[_(j(B),{href:a.route("results.schools.show",{id:S.schoolId}),class:"hover:text-green-700"},{default:F(()=>[I(o(R.value||"School"),1)]),_:1},8,["href"])]),t[5]||(t[5]=e("li",null,"/",-1)),e("li",ee,o(u.value&&u.value.name||"Exam"),1)])]),e("div",te,[e("div",se,[e("div",ae,[e("div",le,[t[6]||(t[6]=e("div",{class:"text-[11px] sm:text-xs tracking-wide text-gray-600 uppercase"},"Regional Administration and Local Government",-1)),t[7]||(t[7]=e("div",{class:"text-[11px] sm:text-xs tracking-wide text-gray-600 uppercase"},"Form Results",-1)),u.value?(d(),i("div",ne,[I(o(u.value&&u.value.name||"Exam")+" Examination Results ",1),u.value&&u.value.year?(d(),i("span",oe,", "+o(u.value.year),1)):f("",!0),m.value?(d(),i("span",re," - "+o(String(m.value).toUpperCase()),1)):f("",!0)])):f("",!0),e("div",ie,o(String(S.schoolId))+" - "+o(R.value||"School Centre"),1)])]),e("div",de,[q(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>m.value=s),onChange:M,class:"rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},[t[8]||(t[8]=e("option",{value:""},"Select Class",-1)),(d(!0),i(v,null,g(y.value,s=>(d(),i("option",{key:s,value:s},o(s),9,ce))),128))],544),[[X,m.value]]),e("button",{onClick:H,class:"inline-flex items-center rounded-md border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50"},[...t[9]||(t[9]=[e("svg",{class:"mr-2 h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[e("path",{d:"M19 8H5a3 3 0 0 0-3 3v5h4v4h12v-4h4v-5a3 3 0 0 0-3-3zM7 18h10v2H7v-2zm13-3H4v-4a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v4z"}),e("path",{d:"M17 2H7v4h10V2z"})],-1),I(" Print ",-1)])])])])]),e("div",ue,[t[11]||(t[11]=e("div",{class:"text-center text-xs font-semibold text-emerald-800 uppercase"},"Division Performance Summary",-1)),e("div",xe,[e("div",me,[e("table",pe,[t[10]||(t[10]=e("thead",null,[e("tr",{class:"bg-emerald-100/70"},[e("th",{class:"px-3 py-1 text-left font-semibold text-emerald-900"},"SEX"),e("th",{class:"px-3 py-1 text-center font-semibold text-emerald-900"},"I"),e("th",{class:"px-3 py-1 text-center font-semibold text-emerald-900"},"II"),e("th",{class:"px-3 py-1 text-center font-semibold text-emerald-900"},"III"),e("th",{class:"px-3 py-1 text-center font-semibold text-emerald-900"},"IV"),e("th",{class:"px-3 py-1 text-center font-semibold text-emerald-900"},"0")])],-1)),e("tbody",fe,[(d(!0),i(v,null,g(L.value,s=>(d(),i("tr",{key:s.label,class:"bg-white/70"},[e("td",ye,o(s.label),1),e("td",he,o(s.I),1),e("td",ve,o(s.II),1),e("td",ge,o(s.III),1),e("td",be,o(s.IV),1),e("td",_e,o(s[0]),1)]))),128))])])])])]),e("div",Ie,[e("table",ke,[e("thead",we,[e("tr",null,[t[12]||(t[12]=e("th",{class:"px-3 py-1 text-left font-semibold text-rose-900"},"CNO",-1)),t[13]||(t[13]=e("th",{class:"px-3 py-2 text-left font-semibold text-slate-800"},"STUDENT NAME",-1)),t[14]||(t[14]=e("th",{class:"px-3 py-2 text-left font-semibold text-slate-800"},"SEX",-1)),(d(!0),i(v,null,g(b.value,s=>(d(),i("th",{key:s.key,class:"px-3 py-2 text-center font-semibold text-slate-800"},[e("div",Ae,[e("div",null,o(s.displayName),1)])]))),128)),t[15]||(t[15]=e("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"TOTAL",-1)),t[16]||(t[16]=e("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"AVG",-1)),t[17]||(t[17]=e("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"GRADE",-1)),t[18]||(t[18]=e("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"DIV",-1))])]),e("tbody",Ce,[(d(!0),i(v,null,g(x.value,s=>(d(),i("tr",{key:s.reg_no,class:"hover:bg-slate-50"},[e("td",Se,o(s.reg_no),1),e("td",Re,o(s.name||s.student_name||"—"),1),e("td",Ne,o(s.sex),1),(d(!0),i(v,null,g(b.value,l=>(d(),i("td",{key:l.key,class:"px-3 py-2 text-center text-slate-800"},o(E(s,l)),1))),128)),e("td",Me,o(T(s)),1),e("td",Ve,o(D(s)),1),e("td",Fe,o(z(s)),1),e("td",je,o(s.division),1)]))),128)),!w.value&&x.value.length===0?(d(),i("tr",Be,[e("td",{colspan:3+b.value.length+4,class:"px-3 py-8 text-center text-gray-600"},"No results found.",8,De)])):f("",!0),w.value?(d(),i("tr",Le,[e("td",{colspan:3+b.value.length+4,class:"px-3 py-8 text-center text-gray-600"},"Loading results...",8,Ee)])):f("",!0)])])]),e("div",Te,[t[21]||(t[21]=e("div",{class:"mb-3 text-center text-sm font-semibold text-slate-800"},"Performance by Subject",-1)),e("div",ze,[e("table",$e,[t[20]||(t[20]=e("thead",{class:"bg-slate-100"},[e("tr",null,[e("th",{class:"px-3 py-2 text-left font-semibold text-slate-800"},"#"),e("th",{class:"px-3 py-2 text-left font-semibold text-slate-800"},"Subject"),e("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"Candidates"),e("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"Pass %"),e("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"Fail %"),e("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"A"),e("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"B"),e("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"C"),e("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"D"),e("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"F"),e("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"Average")])],-1)),e("tbody",Pe,[(d(!0),i(v,null,g(V.value,s=>(d(),i("tr",{key:s.key,class:"hover:bg-slate-50"},[e("td",He,o(s.position),1),e("td",Ue,[e("div",qe,[e("span",Xe,o(s.displayName),1),s.position===1?(d(),i("span",Ge,"Best")):s.position===V.value.length?(d(),i("span",Oe,"Lowest")):f("",!0)])]),e("td",We,o(s.candidateCount),1),e("td",Ze,[e("span",{class:G([$(s.passRate),"inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold"])},o(s.passRate)+"% ",3)]),e("td",Je,[e("span",Ke,o(s.failRate)+"% ",1)]),e("td",Qe,o(s.A),1),e("td",Ye,o(s.B),1),e("td",et,o(s.C),1),e("td",tt,o(s.D),1),e("td",st,o(s.F),1),e("td",at,o(s.avg),1)]))),128)),V.value.length===0?(d(),i("tr",lt,[...t[19]||(t[19]=[e("td",{colspan:"10",class:"px-3 py-8 text-center text-gray-600"},"No subject data.",-1)])])):f("",!0)])])])])]),_(W)]))}},ct=Z(nt,[["__scopeId","data-v-306ea31d"]]);export{ct as default};
