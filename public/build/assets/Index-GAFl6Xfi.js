import{r as d,B as oe,C as ne,m as O,k as o,a as M,d as U,h as ae,w as q,b as e,l as b,p as w,D,o as n,F as g,x as h,n as L,t as i,s as R,f,e as X,v as W,i as $}from"./app-YxQuFUj0.js";import{_ as re}from"./AuthenticatedLayout-DZRh6SQw.js";const ie={class:"space-y-4"},de={class:"rounded-xl border border-gray-100 bg-white p-4 shadow-sm"},ue={class:"flex items-end justify-between gap-3"},ce={class:"relative max-w-md flex-1"},ve={key:0,class:"absolute z-20 mt-1 w-full overflow-hidden rounded-md border border-gray-200 bg-white shadow"},be={key:0,class:"p-2 text-xs text-gray-500"},xe={key:1,class:"max-h-60 overflow-auto text-sm"},ge=["onClick"],fe={class:"flex items-center justify-between"},me={class:"font-medium text-gray-800"},pe={class:"overflow-hidden rounded-xl border border-gray-100 bg-white shadow-sm"},ye={class:"overflow-x-auto"},we={class:"min-w-full divide-y divide-gray-200 text-sm"},he={class:"divide-y divide-gray-100"},ke={class:"px-4 py-3 text-gray-900"},_e=["title"],je={class:"flex flex-wrap items-center gap-1"},Ce=["title"],Se={key:0,class:"inline-flex items-center rounded-full bg-gray-100 px-2 py-0.5 text-xs text-gray-700"},Ae={key:1,class:"text-xs text-gray-500"},Me={class:"px-4 py-3"},qe={class:"flex justify-end gap-2"},De=["onClick"],Le=["onClick"],$e={key:0,class:"flex flex-wrap items-center justify-between gap-2"},Be={class:"text-xs text-gray-500"},ze={class:"flex flex-wrap gap-1"},Ee=["disabled","onClick","innerHTML"],Fe={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},Ve={class:"relative z-10 w-full max-w-2xl overflow-hidden rounded-xl bg-white shadow-xl"},Ue={class:"bg-gradient-to-r from-green-600 to-emerald-600 px-5 py-4 text-white"},Ne={class:"flex items-center justify-between"},He={class:"mt-3 flex items-center gap-2 text-xs"},Te={class:"space-y-4 p-5"},Oe={key:0,class:"space-y-4"},Re={key:0,class:"mt-1 text-xs text-red-600"},Xe={class:"inline-flex items-center gap-2 rounded-full border border-gray-200 bg-gray-50 px-3 py-1 text-xs text-gray-700"},We={key:1,class:"space-y-3"},Ie={class:"flex items-end justify-between gap-3"},Ke={class:"flex-1"},Pe={class:"flex max-h-60 flex-wrap gap-2 overflow-auto rounded-md border border-gray-200 p-2"},Ge=["value"],Je={key:0,class:"px-2 py-1 text-xs text-gray-500"},Qe={class:"flex items-center justify-between gap-2 border-t px-5 py-3"},Ye={class:"ml-auto flex items-center gap-2"},Ze=["disabled"],et=["disabled"],tt={key:1,class:"fixed inset-0 z-50 flex items-center justify-center"},st={class:"relative z-10 w-full max-w-xl overflow-hidden rounded-xl bg-white shadow-xl"},lt={class:"flex items-center justify-between border-b px-5 py-3"},ot={class:"space-y-4 p-5"},nt={class:"flex max-h-48 flex-wrap gap-2 overflow-auto rounded-md border border-gray-200 p-2"},at=["value"],rt={class:"flex items-center justify-end gap-2 border-t px-5 py-3"},it=["disabled"],dt={key:2,class:"fixed inset-0 z-50 flex items-center justify-center"},ut={class:"relative z-10 w-full max-w-md overflow-hidden rounded-xl bg-white shadow-xl"},ct={class:"flex items-center justify-between border-b px-5 py-3"},vt={class:"space-y-3 p-5 text-sm"},bt={class:"text-gray-700"},xt={class:"font-semibold"},gt={class:"flex items-center justify-end gap-2 border-t px-5 py-3"},ft=["disabled"],yt={__name:"Index",props:{classes:{type:Object,required:!0},subjects:{type:Array,required:!0},filters:{type:Object,default:()=>({q:""})}},setup(x){const B=x;function I(l){return l?l.code&&String(l.code).trim()?String(l.code).trim():l.name&&String(l.name).trim()?String(l.name).trim().split(/\s+/).map(s=>s[0]||"").join("").toUpperCase().slice(0,4):"—":"—"}const k=d(B.filters.q||"");function N(l=route("classes.index")){$.get(l,{q:k.value},{preserveScroll:!0,preserveState:!0,replace:!0})}const r=d({open:!1,items:[],loading:!1,index:-1});let z;oe(k,l=>{z&&clearTimeout(z),z=setTimeout(async()=>{if(N(),!l||l.length<2){r.value={open:!1,items:[],loading:!1,index:-1};return}r.value.loading=!0;try{const t=await fetch(route("classes.search",{q:l}),{headers:{"X-Requested-With":"XMLHttpRequest"}});r.value.items=t.ok?await t.json():[],r.value.open=r.value.items.length>0}finally{r.value.loading=!1}},300)});function K(l){if(r.value.open){if(l.key==="ArrowDown"&&(l.preventDefault(),r.value.index=Math.min(r.value.index+1,r.value.items.length-1)),l.key==="ArrowUp"&&(l.preventDefault(),r.value.index=Math.max(r.value.index-1,0)),l.key==="Enter"&&r.value.index>=0){l.preventDefault();const t=r.value.items[r.value.index];t&&F(t)}l.key==="Escape"&&(r.value.open=!1)}}const P=ne(),H=O(()=>P.props.errors||{}),m=d(!1),c=d(1),u=d({name:"",subject_ids:[]}),_=d(!1),j=d(""),E=O(()=>{const l=j.value.trim().toLowerCase();return l?B.subjects.filter(t=>(t.name+" "+(t.code||"")).toLowerCase().includes(l)):B.subjects});function G(){u.value={name:"",subject_ids:[]},c.value=1,j.value="",m.value=!0}function J(){c.value<2&&c.value++}function Q(){c.value>1&&c.value--}function Y(){u.value.subject_ids=E.value.map(l=>l.id)}function Z(){u.value.subject_ids=[]}async function ee(){_.value=!0;try{await $.post(route("classes.store"),u.value,{preserveScroll:!0,onSuccess:()=>{m.value=!1,u.value={name:"",subject_ids:[]},window.__toast&&window.__toast("success","Class created")},onError:l=>{const t=Object.values(l||{})[0]||"Failed to create";window.__toast&&window.__toast("error",String(t))}})}finally{_.value=!1}}const p=d(!1),T=d(!1),v=d({id:null,name:"",subject_ids:[]});async function F(l){p.value=!0,T.value=!0;try{const t=l.id,s=await fetch(route("classes.show.json",{id:t}),{headers:{"X-Requested-With":"XMLHttpRequest"}}),a=s.ok?await s.json():null;if(!a){window.__toast&&window.__toast("error","Failed to load class");return}v.value={id:a.id,name:a.name,subject_ids:(a.subjects||[]).map(V=>V.id)}}finally{T.value=!1}}const C=d(!1);async function te(){if(v.value.id){C.value=!0;try{await $.patch(route("classes.update",{id:v.value.id}),{name:v.value.name,subject_ids:v.value.subject_ids},{preserveScroll:!0,onSuccess:()=>{p.value=!1,window.__toast&&window.__toast("success","Class updated")},onError:l=>{const t=Object.values(l||{})[0]||"Failed to update";window.__toast&&window.__toast("error",String(t))}})}finally{C.value=!1}}}const y=d(!1),S=d({id:null,name:""}),A=d(!1);function se(l){S.value={id:l.id,name:l.name},y.value=!0}async function le(){if(S.value.id){A.value=!0;try{await $.delete(route("classes.destroy",{id:S.value.id}),{preserveScroll:!0,onSuccess:()=>{y.value=!1,window.__toast&&window.__toast("success","Class deleted")},onError:()=>{window.__toast&&window.__toast("error","Failed to delete")}})}finally{A.value=!1}}}return(l,t)=>(n(),o(g,null,[M(U(ae),{title:"Classes"}),M(re,null,{header:q(()=>[...t[15]||(t[15]=[e("h2",{class:"text-xl font-semibold leading-tight text-gray-800"},"All Classes",-1)])]),default:q(()=>[e("div",ie,[e("div",de,[e("div",ue,[e("div",ce,[t[16]||(t[16]=e("label",{for:"q",class:"mb-1 block text-xs font-medium text-gray-600"},"Search class",-1)),w(e("input",{id:"q","onUpdate:modelValue":t[0]||(t[0]=s=>k.value=s),onKeydown:K,type:"text",placeholder:"e.g. Form 1",class:"w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},null,544),[[D,k.value]]),r.value.open?(n(),o("div",ve,[r.value.loading?(n(),o("div",be,"Loading...")):(n(),o("ul",xe,[(n(!0),o(g,null,h(r.value.items,(s,a)=>(n(),o("li",{key:s.id,onClick:V=>F(s),class:L(["cursor-pointer px-3 py-2 hover:bg-gray-50",a===r.value.index?"bg-gray-50":""])},[e("div",fe,[e("div",me,i(s.name),1)])],10,ge))),128))]))])):b("",!0)]),e("div",null,[e("button",{type:"button",onClick:G,class:"rounded-md bg-gradient-to-r from-green-600 to-emerald-600 px-3 py-2 text-sm font-medium text-white shadow hover:from-green-700 hover:to-emerald-700"},"Add Class")])])]),e("div",pe,[e("div",ye,[e("table",we,[t[20]||(t[20]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"},"Class name"),e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700",title:"Subject codes"},"Assigned subjects (codes)"),e("th",{class:"px-4 py-3 text-right font-semibold text-gray-700"},"Action")])],-1)),e("tbody",he,[(n(!0),o(g,null,h(x.classes.data,s=>(n(),o("tr",{key:s.id,class:"hover:bg-gray-50"},[e("td",ke,[M(U(R),{href:l.route("classes.show",{id:s.id}),class:"text-green-700 hover:underline"},{default:q(()=>[f(i(s.name),1)]),_:2},1032,["href"])]),e("td",{class:"px-4 py-3 text-gray-700",title:(s.subjects||[]).map(a=>a.code||a.name).join(", ")},[e("div",je,[s.subjects&&s.subjects.length?(n(),o(g,{key:0},[(n(!0),o(g,null,h(s.subjects.slice(0,6),a=>(n(),o("span",{key:a.id,title:a.name+(a.code?" • "+a.code:""),class:"inline-flex items-center rounded-full bg-gray-100 px-2 py-0.5 text-xs text-gray-700"},i(I(a)),9,Ce))),128)),s.subjects.length>6?(n(),o("span",Se,"+"+i(s.subjects.length-6)+" more",1)):b("",!0)],64)):(n(),o("span",Ae,"No subjects"))])],8,_e),e("td",Me,[e("div",qe,[M(U(R),{href:l.route("classes.show",{id:s.id}),class:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-green-50 text-green-600 ring-1 ring-inset ring-green-200 hover:bg-green-100","aria-label":"Open overview"},{default:q(()=>[...t[17]||(t[17]=[e("svg",{class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 5l7 7-7 7"})],-1)])]),_:1},8,["href"]),e("button",{type:"button",onClick:X(a=>F(s),["stop"]),class:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-emerald-50 text-emerald-600 ring-1 ring-inset ring-emerald-200 hover:bg-emerald-100","aria-label":"Edit"},[...t[18]||(t[18]=[e("svg",{class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.862 3.487a2.1 2.1 0 113 3L8.25 18.1 4.5 19.5l1.4-3.75 10.962-12.263z"})],-1)])],8,De),e("button",{type:"button",onClick:X(a=>se(s),["stop"]),class:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-rose-50 text-rose-600 ring-1 ring-inset ring-rose-200 hover:bg-rose-100","aria-label":"Delete"},[...t[19]||(t[19]=[e("svg",{class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 7h12M9 7V5a2 2 0 012-2h2a2 2 0 012 2v2m-1 0l-.867 12.142A2 2 0 0114.138 21H9.862a2 2 0 01-1.995-1.858L7 7z"})],-1)])],8,Le)])])]))),128))])])])]),x.classes.links?(n(),o("div",$e,[e("div",Be,"Showing "+i(x.classes.from||0)+"-"+i(x.classes.to||0)+" of "+i(x.classes.total||0),1),e("div",ze,[(n(!0),o(g,null,h(x.classes.links,(s,a)=>(n(),o("button",{key:a,disabled:!s.url,onClick:V=>s.url&&N(s.url),class:L(["rounded-md px-3 py-1.5 text-sm",[s.active?"bg-green-600 text-white":"border border-gray-300 text-gray-700 hover:bg-gray-50",s.url?"":"opacity-50"]]),innerHTML:s.label},null,10,Ee))),128))])])):b("",!0)]),m.value?(n(),o("div",Fe,[e("div",{class:"absolute inset-0 bg-black/40",onClick:t[1]||(t[1]=s=>m.value=!1)}),e("div",Ve,[e("div",Ue,[e("div",Ne,[t[22]||(t[22]=e("h3",{class:"text-base font-semibold"},"Add Class",-1)),e("button",{onClick:t[2]||(t[2]=s=>m.value=!1),class:"rounded-md p-1 hover:bg-white/10","aria-label":"Close"},[...t[21]||(t[21]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",He,[e("div",{class:L(["flex-1 rounded-full px-3 py-1",c.value===1?"bg-white/90 text-green-700":"bg-white/30 text-white"])},"Step 1: Basic info",2),e("div",{class:L(["flex-1 rounded-full px-3 py-1",c.value===2?"bg-white/90 text-green-700":"bg-white/30 text-white"])},"Step 2: Assign subjects",2)])]),e("div",Te,[c.value===1?(n(),o("div",Oe,[e("div",null,[t[23]||(t[23]=e("label",{class:"mb-1 block text-xs font-medium text-gray-600"},[f("Class name "),e("span",{class:"text-red-600"},"*")],-1)),w(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>u.value.name=s),required:"",type:"text",placeholder:"e.g. Form 1A",class:"w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},null,512),[[D,u.value.name]]),H.value.name?(n(),o("p",Re,i(H.value.name),1)):b("",!0)]),e("div",null,[t[25]||(t[25]=e("label",{class:"mb-1 block text-xs font-medium text-gray-600"},"Class ID (auto)",-1)),e("div",Xe,[t[24]||(t[24]=e("svg",{class:"h-3.5 w-3.5 text-gray-500",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7 7h10v10H7z"})],-1)),e("span",null,i(u.value.name?u.value.name.toUpperCase().replace(/\s+/g,"-").slice(0,15):"Will be generated automatically"),1)])])])):(n(),o("div",We,[e("div",Ie,[e("div",Ke,[t[26]||(t[26]=e("label",{class:"mb-1 block text-xs font-medium text-gray-600"},"Filter subjects",-1)),w(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>j.value=s),type:"text",placeholder:"Search subject...",class:"w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},null,512),[[D,j.value]])]),e("div",{class:"flex gap-2"},[e("button",{type:"button",onClick:Y,class:"rounded-md border border-gray-300 px-3 py-2 text-xs text-gray-700 hover:bg-gray-50"},"Select all"),e("button",{type:"button",onClick:Z,class:"rounded-md border border-gray-300 px-3 py-2 text-xs text-gray-700 hover:bg-gray-50"},"Clear")])]),e("div",Pe,[(n(!0),o(g,null,h(E.value,s=>(n(),o("label",{key:s.id,class:"flex items-center gap-2 rounded-md bg-gray-50 px-2 py-1 text-sm text-gray-700 ring-1 ring-inset ring-gray-200"},[w(e("input",{type:"checkbox",value:s.id,"onUpdate:modelValue":t[5]||(t[5]=a=>u.value.subject_ids=a)},null,8,Ge),[[W,u.value.subject_ids]]),f(" "+i(s.name),1)]))),128)),E.value.length===0?(n(),o("div",Je,"No subjects found.")):b("",!0)])]))]),e("div",Qe,[e("div",null,[c.value>1?(n(),o("button",{key:0,onClick:Q,type:"button",class:"rounded-md border border-gray-300 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50"},"Back")):b("",!0)]),e("div",Ye,[e("button",{onClick:t[6]||(t[6]=s=>m.value=!1),type:"button",class:"rounded-md border border-gray-300 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50"},"Cancel"),c.value===1?(n(),o("button",{key:0,disabled:!u.value.name,onClick:J,type:"button",class:"rounded-md bg-green-600 px-4 py-2 text-sm font-medium text-white hover:bg-green-700 disabled:opacity-60"},"Next",8,Ze)):(n(),o("button",{key:1,disabled:_.value,onClick:ee,type:"button",class:"rounded-md bg-green-600 px-4 py-2 text-sm font-medium text-white hover:bg-green-700 disabled:opacity-60"},i(_.value?"Saving...":"Save"),9,et))])])])])):b("",!0),p.value?(n(),o("div",tt,[e("div",{class:"absolute inset-0 bg-black/40",onClick:t[7]||(t[7]=s=>p.value=!1)}),e("div",st,[e("div",lt,[t[28]||(t[28]=e("h3",{class:"text-base font-semibold text-gray-800"},"Edit Class",-1)),e("button",{onClick:t[8]||(t[8]=s=>p.value=!1),class:"rounded-md p-1 text-gray-500 hover:bg-gray-100","aria-label":"Close"},[...t[27]||(t[27]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",ot,[e("div",null,[t[29]||(t[29]=e("label",{class:"mb-1 block text-xs font-medium text-gray-600"},[f("Class name "),e("span",{class:"text-red-600"},"*")],-1)),w(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>v.value.name=s),required:"",type:"text",class:"w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},null,512),[[D,v.value.name]])]),e("div",null,[t[30]||(t[30]=e("label",{class:"mb-1 block text-xs font-medium text-gray-600"},"Assign subjects",-1)),e("div",nt,[(n(!0),o(g,null,h(x.subjects,s=>(n(),o("label",{key:s.id,class:"flex items-center gap-2 text-sm text-gray-700"},[w(e("input",{type:"checkbox",value:s.id,"onUpdate:modelValue":t[10]||(t[10]=a=>v.value.subject_ids=a)},null,8,at),[[W,v.value.subject_ids]]),f(" "+i(s.name),1)]))),128))])])]),e("div",rt,[e("button",{onClick:t[11]||(t[11]=s=>p.value=!1),type:"button",class:"rounded-md border border-gray-300 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50"},"Cancel"),e("button",{disabled:C.value,onClick:te,type:"button",class:"rounded-md bg-green-600 px-4 py-2 text-sm font-medium text-white hover:bg-green-700 disabled:opacity-60"},i(C.value?"Saving...":"Save changes"),9,it)])])])):b("",!0),y.value?(n(),o("div",dt,[e("div",{class:"absolute inset-0 bg-black/40",onClick:t[12]||(t[12]=s=>y.value=!1)}),e("div",ut,[e("div",ct,[t[32]||(t[32]=e("h3",{class:"text-base font-semibold text-gray-800"},"Delete Class",-1)),e("button",{onClick:t[13]||(t[13]=s=>y.value=!1),class:"rounded-md p-1 text-gray-500 hover:bg-gray-100","aria-label":"Close"},[...t[31]||(t[31]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",vt,[e("p",bt,[t[33]||(t[33]=f("Are you sure you want to delete ",-1)),e("span",xt,i(S.value.name),1),t[34]||(t[34]=f("?",-1))])]),e("div",gt,[e("button",{onClick:t[14]||(t[14]=s=>y.value=!1),type:"button",class:"rounded-md border border-gray-300 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50"},"Cancel"),e("button",{disabled:A.value,onClick:le,type:"button",class:"rounded-md bg-rose-600 px-4 py-2 text-sm font-medium text-white hover:bg-rose-700 disabled:opacity-60"},i(A.value?"Deleting...":"Delete"),9,ft)])])])):b("",!0)]),_:1})],64))}};export{yt as default};
