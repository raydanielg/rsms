import{r as p,q as v,j as z,c as r,a as _,b as t,w as F,e as I,u as j,l as R,t as o,p as y,s as H,z as P,F as h,y as g,o as d}from"./app-CQgFi69a.js";import{_ as X}from"./Header-D227mufn.js";import{_ as G}from"./Footer-DjRS-aWN.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";const W={class:"min-h-screen bg-white antialiased"},Z={class:"mx-auto max-w-7xl px-3 sm:px-4 lg:px-8 py-10"},J={class:"mb-6 text-sm text-gray-600","aria-label":"Breadcrumb"},K={class:"flex items-center gap-2"},Q={class:"text-gray-900 font-medium truncate max-w-[12rem] sm:max-w-none"},Y={class:"mb-6"},ee={class:"flex items-start justify-between gap-3"},te={class:"flex-1"},se={class:"text-center space-y-1"},ae={key:0,class:"text-xl sm:text-2xl font-extrabold text-emerald-800 uppercase"},le={key:0},oe={key:1,class:"text-emerald-900"},ne={class:"text-sm sm:text-base font-semibold text-sky-700 uppercase"},re={class:"shrink-0 flex items-center gap-2 print:hidden"},de=["value"],ie={class:"mb-6 text-center"},ce={class:"mt-2 overflow-x-auto"},ue={class:"mx-auto inline-block rounded-lg border border-emerald-200 bg-emerald-50/70 p-1.5 shadow-sm ring-1 ring-inset ring-emerald-100"},xe={class:"divide-y divide-emerald-200 text-xs"},me={class:"divide-y divide-emerald-100"},pe={class:"px-3 py-1 font-medium text-emerald-900"},ye={class:"px-3 py-1 text-center text-emerald-900"},fe={class:"px-3 py-1 text-center text-emerald-900"},ve={class:"px-3 py-1 text-center text-emerald-900"},he={class:"px-3 py-1 text-center text-emerald-900"},ge={class:"px-3 py-1 text-center text-emerald-900"},be={class:"overflow-x-auto rounded-xl border border-gray-200 bg-white shadow-lg"},_e={class:"min-w-full divide-y divide-gray-200 text-sm"},Ie={class:"bg-gray-50"},we={class:"leading-tight"},ke={class:"divide-y divide-gray-100"},Ae={class:"px-3 py-2 text-slate-900 whitespace-nowrap"},Se={class:"px-3 py-2 text-slate-900"},Ce={class:"px-3 py-2 text-slate-800"},Ne={class:"px-3 py-2 text-center text-slate-800"},Ve={class:"px-3 py-2 text-center text-slate-800"},Me={class:"px-3 py-2 text-center text-slate-800"},Fe={class:"px-3 py-2 text-center text-slate-800"},je={key:0},Re=["colspan"],Be={key:1},De=["colspan"],Ee={class:"mt-10"},Le={class:"overflow-x-auto rounded-xl border border-gray-200 bg-white shadow-lg"},Te={class:"min-w-full divide-y divide-gray-200 text-sm"},$e={class:"divide-y divide-gray-100"},Ue={class:"px-3 py-2 text-slate-900"},qe={class:"flex items-center gap-2"},ze={key:0,class:"rounded-full bg-emerald-100 px-2 py-0.5 text-xs font-medium text-emerald-700"},He={key:1,class:"rounded-full bg-rose-100 px-2 py-0.5 text-xs font-medium text-rose-700"},Pe={class:"px-3 py-2 text-center text-slate-800"},Xe={class:"px-3 py-2 text-center text-slate-800"},Ge={class:"px-3 py-2 text-center text-slate-800"},Oe={class:"px-3 py-2 text-center text-slate-800"},We={class:"px-3 py-2 text-center text-slate-800"},Ze={class:"px-3 py-2 text-center text-slate-900 font-semibold"},Je={key:0},Ke={__name:"View",props:{schoolId:{type:[String,Number],required:!0},examId:{type:Number,required:!0}},setup(C){const w=C,k=p(!1),N=p(""),c=p(null),A=p({F:{I:0,II:0,III:0,IV:0,0:0},M:{I:0,II:0,III:0,IV:0,0:0},T:{I:0,II:0,III:0,IV:0,0:0}}),u=p([]),f=p([]),x=p(""),E=v(()=>[{label:"F",...A.value.F},{label:"M",...A.value.M},{label:"T",...A.value.T}]);v(()=>{const a=Array.isArray(u.value)?u.value.slice():[];return a.sort((e,s)=>(s.aggregate||0)-(e.aggregate||0)),a.slice(0,3)}),v(()=>{const a=(Array.isArray(u.value)?u.value:[]).filter(e=>String(e.division||"").toUpperCase()==="0");return a.sort((e,s)=>(e.aggregate||0)-(s.aggregate||0)),a.slice(0,3)});function B(a,e){const s=[a?.name,a?.title,a?.label,a?.full_name,a?.code],l=s.find(i=>typeof i=="string"&&/[A-Za-z]/.test(i));if(l)return l;const n=s.find(i=>typeof i=="string"&&i.trim()!=="");return n||`Subject ${e}`}const b=v(()=>{const a=new Map;let e=1;for(const s of u.value)for(const l of s.subjects||[]){const n=l.code??l.name??`subject-${e}`;if(!a.has(n))a.set(n,{key:n,code:l.code??null,name:l.name??null,displayName:B(l,e)}),e++;else{const i=a.get(n);!i.name&&l.name&&(i.name=l.name),!i.code&&l.code&&(i.code=l.code),(!i.displayName||!/[A-Za-z]/.test(i.displayName))&&(i.displayName=B(l,e))}}return Array.from(a.values())});v(()=>{const a=new Map;for(const e of b.value)e.code&&a.set(e.code,e.displayName),e.name&&a.set(e.name,e.displayName),a.set(e.key,e.displayName);return a});function L(a,e){const s=a.subjects||[];let l=null;if(e.code&&(l=s.find(n=>n.code===e.code)),!l&&e.name){const n=String(e.name).toLowerCase();l=s.find(i=>String(i.name||"").toLowerCase()===n)}return l&&typeof l.marks=="number"?l.marks:"-"}function T(a){let e=0;for(const s of a.subjects||[])typeof s.marks=="number"&&(e+=s.marks);return e}function D(a){let e=0,s=0;for(const l of a.subjects||[])typeof l.marks=="number"&&(e+=l.marks,s++);return s?Math.round(e/s):0}function $(a){const e=D(a);return e>=75?"A":e>=65?"B":e>=55?"C":e>=40?"D":e>0?"F":"-"}async function U(){try{const e=await(await fetch(`/api/public/schools/${w.schoolId}/exams`,{headers:{"X-Requested-With":"XMLHttpRequest"}})).json();c.value=Array.isArray(e)&&e.find(s=>s.id===w.examId)||null}catch{c.value=null}}async function V(){k.value=!0;try{const a=new URL(`/api/public/schools/${w.schoolId}/exams/${w.examId}/results`,window.location.origin);x.value?a.searchParams.set("class_name",x.value):f.value.length>0&&a.searchParams.set("class_name",f.value[0]);const s=await(await fetch(a,{headers:{"X-Requested-With":"XMLHttpRequest"}})).json();N.value=s?.school?.school_name||"",f.value=Array.isArray(s?.classes)?s.classes:[],A.value=s?.summary||{F:{I:0,II:0,III:0,IV:0,0:0},M:{I:0,II:0,III:0,IV:0,0:0},T:{I:0,II:0,III:0,IV:0,0:0}},u.value=Array.isArray(s?.students)?s.students:[]}finally{k.value=!1}}z(async()=>{try{const e=new URLSearchParams(window.location.search).get("class_name");e&&(x.value=e)}catch{}await U(),await V(),!x.value&&f.value.length>0&&(x.value=f.value[0],await V())});function q(){window.print()}const M=v(()=>{const a=new Map;let e=1;for(const l of u.value)for(const n of l.subjects||[]){const i=n.code??n.name??`subject-${e}`;a.has(i)||(a.set(i,{key:i,code:n.code??null,name:n.name??n.code??`Subject ${e}`,A:0,B:0,C:0,D:0,F:0,sum:0,cnt:0}),e++);const m=a.get(i),S=String(n.grade||"").toUpperCase();S==="A"?m.A++:S==="B"?m.B++:S==="C"?m.C++:S==="D"?m.D++:m.F++,typeof n.marks=="number"&&(m.sum+=n.marks,m.cnt++)}const s=Array.from(a.values()).map(l=>({...l,avg:l.cnt?Math.round(l.sum/l.cnt):0}));return s.sort((l,n)=>n.avg-l.avg),s});return(a,e)=>(d(),r("div",W,[_(X),t("section",Z,[t("nav",J,[t("ol",K,[t("li",null,[_(j(R),{href:"/",class:"hover:text-green-700"},{default:F(()=>[...e[1]||(e[1]=[I("Home",-1)])]),_:1})]),e[3]||(e[3]=t("li",null,"/",-1)),t("li",null,[_(j(R),{href:"/results/schools",class:"hover:text-green-700"},{default:F(()=>[...e[2]||(e[2]=[I("Results",-1)])]),_:1})]),e[4]||(e[4]=t("li",null,"/",-1)),t("li",null,[_(j(R),{href:a.route("results.schools.show",{id:C.schoolId}),class:"hover:text-green-700"},{default:F(()=>[I(o(N.value||"School"),1)]),_:1},8,["href"])]),e[5]||(e[5]=t("li",null,"/",-1)),t("li",Q,o(c.value&&c.value.name||"Exam"),1)])]),t("div",Y,[t("div",ee,[t("div",te,[t("div",se,[e[6]||(e[6]=t("div",{class:"text-[11px] sm:text-xs tracking-wide text-gray-600 uppercase"},"Regional Administration and Local Government",-1)),e[7]||(e[7]=t("div",{class:"text-[11px] sm:text-xs tracking-wide text-gray-600 uppercase"},"Form Results",-1)),c.value?(d(),r("div",ae,[I(o(c.value&&c.value.name||"Exam")+" Examination Results ",1),c.value&&c.value.year?(d(),r("span",le,", "+o(c.value.year),1)):y("",!0),x.value?(d(),r("span",oe," - "+o(String(x.value).toUpperCase()),1)):y("",!0)])):y("",!0),t("div",ne,o(String(C.schoolId))+" - "+o(N.value||"School Centre"),1)])]),t("div",re,[H(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>x.value=s),onChange:V,class:"rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},[e[8]||(e[8]=t("option",{value:""},"Select Class",-1)),(d(!0),r(h,null,g(f.value,s=>(d(),r("option",{key:s,value:s},o(s),9,de))),128))],544),[[P,x.value]]),t("button",{onClick:q,class:"inline-flex items-center rounded-md border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50"},[...e[9]||(e[9]=[t("svg",{class:"mr-2 h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[t("path",{d:"M19 8H5a3 3 0 0 0-3 3v5h4v4h12v-4h4v-5a3 3 0 0 0-3-3zM7 18h10v2H7v-2zm13-3H4v-4a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v4z"}),t("path",{d:"M17 2H7v4h10V2z"})],-1),I(" Print ",-1)])])])])]),t("div",ie,[e[11]||(e[11]=t("div",{class:"text-center text-xs font-semibold text-emerald-800 uppercase"},"Division Performance Summary",-1)),t("div",ce,[t("div",ue,[t("table",xe,[e[10]||(e[10]=t("thead",null,[t("tr",{class:"bg-emerald-100/70"},[t("th",{class:"px-3 py-1 text-left font-semibold text-emerald-900"},"SEX"),t("th",{class:"px-3 py-1 text-center font-semibold text-emerald-900"},"I"),t("th",{class:"px-3 py-1 text-center font-semibold text-emerald-900"},"II"),t("th",{class:"px-3 py-1 text-center font-semibold text-emerald-900"},"III"),t("th",{class:"px-3 py-1 text-center font-semibold text-emerald-900"},"IV"),t("th",{class:"px-3 py-1 text-center font-semibold text-emerald-900"},"0")])],-1)),t("tbody",me,[(d(!0),r(h,null,g(E.value,s=>(d(),r("tr",{key:s.label,class:"bg-white/70"},[t("td",pe,o(s.label),1),t("td",ye,o(s.I),1),t("td",fe,o(s.II),1),t("td",ve,o(s.III),1),t("td",he,o(s.IV),1),t("td",ge,o(s[0]),1)]))),128))])])])])]),t("div",be,[t("table",_e,[t("thead",Ie,[t("tr",null,[e[12]||(e[12]=t("th",{class:"px-3 py-1 text-left font-semibold text-rose-900"},"CNO",-1)),e[13]||(e[13]=t("th",{class:"px-3 py-2 text-left font-semibold text-slate-800"},"STUDENT NAME",-1)),e[14]||(e[14]=t("th",{class:"px-3 py-2 text-left font-semibold text-slate-800"},"SEX",-1)),(d(!0),r(h,null,g(b.value,s=>(d(),r("th",{key:s.key,class:"px-3 py-2 text-center font-semibold text-slate-800"},[t("div",we,[t("div",null,o(s.displayName),1)])]))),128)),e[15]||(e[15]=t("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"TOTAL",-1)),e[16]||(e[16]=t("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"AVG",-1)),e[17]||(e[17]=t("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"GRADE",-1)),e[18]||(e[18]=t("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"DIV",-1))])]),t("tbody",ke,[(d(!0),r(h,null,g(u.value,s=>(d(),r("tr",{key:s.reg_no,class:"hover:bg-slate-50"},[t("td",Ae,o(s.reg_no),1),t("td",Se,o(s.name||s.student_name||"—"),1),t("td",Ce,o(s.sex),1),(d(!0),r(h,null,g(b.value,l=>(d(),r("td",{key:l.key,class:"px-3 py-2 text-center text-slate-800"},o(L(s,l)),1))),128)),t("td",Ne,o(T(s)),1),t("td",Ve,o(D(s)),1),t("td",Me,o($(s)),1),t("td",Fe,o(s.division),1)]))),128)),!k.value&&u.value.length===0?(d(),r("tr",je,[t("td",{colspan:3+b.value.length+4,class:"px-3 py-8 text-center text-gray-600"},"No results found.",8,Re)])):y("",!0),k.value?(d(),r("tr",Be,[t("td",{colspan:3+b.value.length+4,class:"px-3 py-8 text-center text-gray-600"},"Loading results...",8,De)])):y("",!0)])])]),t("div",Ee,[e[21]||(e[21]=t("div",{class:"mb-3 text-center text-sm font-semibold text-slate-800"},"Performance by Subject",-1)),t("div",Le,[t("table",Te,[e[20]||(e[20]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-3 py-2 text-left font-semibold text-slate-800"},"SUBJECT"),t("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"A"),t("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"B"),t("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"C"),t("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"D"),t("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"F"),t("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"AVERAGE")])],-1)),t("tbody",$e,[(d(!0),r(h,null,g(M.value,(s,l)=>(d(),r("tr",{key:s.key,class:"hover:bg-slate-50"},[t("td",Ue,[t("div",qe,[t("span",null,o(s.displayName),1),l===0?(d(),r("span",ze,"Best")):l===M.value.length-1?(d(),r("span",He,"Lowest")):y("",!0)])]),t("td",Pe,o(s.A),1),t("td",Xe,o(s.B),1),t("td",Ge,o(s.C),1),t("td",Oe,o(s.D),1),t("td",We,o(s.F),1),t("td",Ze,o(s.avg),1)]))),128)),M.value.length===0?(d(),r("tr",Je,[...e[19]||(e[19]=[t("td",{colspan:"7",class:"px-3 py-8 text-center text-gray-600"},"No subject data.",-1)])])):y("",!0)])])])])]),_(G)]))}},st=O(Ke,[["__scopeId","data-v-41307fb3"]]);export{st as default};
