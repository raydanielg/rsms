import{r as x,h as ze,E as vt,g as E,f as xt,c as l,a as Le,u as mt,m as pt,w as Ve,b as e,i,z as g,O as gt,G as $,o as a,F as p,k as b,n as D,t as n,e as m,B as q,I as te,A as bt,s as j,x as se}from"./app-BoWaoUwb.js";import{_ as yt}from"./AuthenticatedLayout-CQFJTYU6.js";import"./DropdownLink-v00n1gGZ.js";const ft={class:"space-y-4"},wt={class:"flex flex-col gap-3 rounded-xl border border-gray-100 bg-white p-4 shadow-sm sm:flex-row sm:items-end sm:justify-between"},ht={class:"grid flex-1 grid-cols-1 gap-3 sm:grid-cols-3"},_t={class:"relative"},kt={key:0,class:"absolute z-20 mt-1 w-full overflow-hidden rounded-md border border-gray-200 bg-white shadow"},Ct={key:0,class:"p-2 text-xs text-gray-500"},jt={key:1,class:"max-h-60 overflow-auto text-sm"},St=["onClick"],Mt={class:"flex items-center justify-between"},Rt={class:"font-medium text-gray-800"},$t={class:"text-xs text-gray-500"},At={key:0,class:"pointer-events-none fixed right-4 top-4 z-50 space-y-2"},qt={key:0,class:"pointer-events-auto rounded-md border border-emerald-200 bg-emerald-50 px-4 py-3 text-sm text-emerald-800 shadow"},It={key:1,class:"pointer-events-auto rounded-md border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-800 shadow"},Ft={key:1,class:"fixed inset-0 z-50 flex items-center justify-center"},Xt={class:"relative z-10 w-full max-w-md overflow-hidden rounded-xl bg-white shadow-xl"},Ot={class:"flex items-center justify-between border-b px-5 py-3"},Dt={class:"space-y-3 p-5 text-sm"},Et={class:"text-gray-700"},zt={class:"font-semibold"},Lt={class:"flex items-center justify-end gap-2 border-t px-5 py-3"},Vt=["disabled"],Ht={class:"text-xs text-gray-500"},Bt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},Ut={class:"relative z-10 w-full max-w-4xl overflow-hidden rounded-xl bg-white shadow-xl"},Tt={class:"flex items-center justify-between border-b px-5 py-3"},Nt={class:"flex items-center gap-3"},Pt={class:"h-10 w-10 overflow-hidden rounded-full bg-gray-100"},Wt=["src"],Kt={class:"text-base font-semibold text-gray-800"},Gt={class:"text-xs text-gray-500"},Yt={class:"px-5 pt-4"},Jt={key:0,class:"mx-5 mb-2 rounded-md border border-amber-200 bg-amber-50 px-3 py-2 text-xs text-amber-800"},Qt={class:"flex flex-wrap gap-2 border-b pb-2 text-sm"},Zt={class:"p-5"},es={key:0,class:"grid gap-4 sm:grid-cols-2"},ts={class:"rounded-lg border border-gray-100 p-4"},ss={class:"mt-2 grid grid-cols-1 gap-2 text-sm sm:grid-cols-2"},os={class:"mt-0.5 inline-flex items-center rounded border border-gray-200 bg-gray-50 px-2 py-0.5 text-gray-800"},ls={class:"mt-0.5 inline-flex items-center rounded border border-gray-200 bg-gray-50 px-2 py-0.5 text-gray-800"},as={class:"mt-0.5 inline-flex items-center rounded-full bg-gray-100 px-2 py-0.5 text-xs text-gray-700"},ns={class:"mt-0.5 inline-flex items-center rounded border border-gray-200 bg-gray-50 px-2 py-0.5 text-gray-800"},rs={class:"sm:col-span-2"},ds={class:"mt-0.5 inline-flex items-center rounded border border-gray-200 bg-gray-50 px-2 py-0.5 text-gray-800"},is={class:"mt-3 flex items-center justify-between"},us=["href"],cs={class:"mt-1 flex flex-wrap gap-1"},vs=["title"],xs={key:0,class:"text-xs text-gray-500"},ms={key:0,class:"mt-3 overflow-hidden rounded-md border border-gray-100"},ps={class:"min-w-full divide-y divide-gray-200 text-sm"},gs={class:"divide-y divide-gray-100"},bs={class:"px-3 py-2 text-gray-900"},ys={class:"px-3 py-2 text-gray-700"},fs={class:"rounded-lg border border-gray-100 p-4"},ws={class:"mt-2 text-sm text-gray-700"},hs={class:"text-sm text-gray-700"},_s={class:"text-sm text-gray-700"},ks={key:1,class:"space-y-4"},Cs={class:"rounded-lg border border-gray-100 p-4"},js={class:"grid gap-3 sm:grid-cols-4"},Ss=["disabled"],Ms={class:"rounded-lg border border-gray-100"},Rs={class:"max-h-64 overflow-auto p-2"},$s={key:0,class:"p-3 text-xs text-gray-500"},As={class:"divide-y divide-gray-100 text-sm"},qs={class:"font-medium text-gray-800"},Is={key:0,class:"ml-2 rounded bg-gray-100 px-2 py-0.5 text-xs text-gray-600"},Fs={class:"text-xs text-gray-600"},Xs={class:"text-xs text-gray-700"},Os={key:2,class:"rounded-lg border border-gray-100 p-4 text-sm text-gray-600"},Ds={key:3,class:"space-y-4"},Es={class:"rounded-lg border border-gray-100 p-4"},zs={class:"text-sm text-gray-700"},Ls={class:"font-medium"},Vs={class:"text-sm text-gray-700"},Hs={class:"text-sm text-gray-700"},Bs={class:"rounded-lg border border-gray-100 p-4"},Us={class:"grid gap-3 sm:grid-cols-3"},Ts=["disabled"],Ns={key:1,class:"fixed inset-0 z-50 flex items-center justify-center"},Ps={class:"relative z-10 w-full max-w-xl overflow-hidden rounded-xl bg-white shadow-xl"},Ws={class:"flex items-center justify-between border-b px-5 py-3"},Ks={class:"grid gap-4 p-5"},Gs={class:"grid gap-2 sm:grid-cols-3"},Ys={class:"flex items-center gap-2 text-sm text-gray-700"},Js={class:"flex items-center gap-2 text-sm text-gray-700"},Qs={class:"flex items-center gap-2"},Zs={class:"flex items-center gap-2 text-sm text-gray-700"},eo=["disabled"],to=["value"],so={class:"flex items-center gap-4 text-sm text-gray-700"},oo={class:"flex items-center gap-2"},lo={class:"flex items-center gap-2 opacity-70"},ao={class:"flex items-center justify-end gap-2 border-t px-5 py-3"},no={key:2,class:"fixed inset-0 z-50 flex items-center justify-center"},ro={class:"relative z-10 w-full max-w-3xl overflow-hidden rounded-xl bg-white shadow-xl"},io={class:"flex items-center justify-between border-b px-5 py-3"},uo={class:"grid gap-5 p-5 sm:grid-cols-2"},co={class:"space-y-3"},vo={class:"rounded-md border border-gray-200 bg-gray-50 p-3 text-xs text-gray-700"},xo={class:"mt-2 list-decimal space-y-1 pl-5"},mo=["href"],po={class:"min-h-[200px]"},go={class:"mb-2 text-sm font-semibold text-gray-800"},bo={key:0,class:"text-gray-500"},yo={key:0,class:"overflow-x-auto rounded-md border border-gray-200"},fo={class:"min-w-full divide-y divide-gray-200 text-xs"},wo={class:"bg-gray-50"},ho={class:"divide-y divide-gray-100"},_o={key:1,class:"rounded-md border border-dashed border-gray-300 p-6 text-center text-xs text-gray-500"},ko={class:"flex items-center justify-end gap-2 border-t px-5 py-3"},Co=["disabled"],jo=["value"],So={class:"flex gap-2"},Mo={class:"flex flex-col gap-2 rounded-xl border border-gray-100 bg-white p-4 shadow-sm sm:flex-row sm:items-center sm:justify-between"},Ro={class:"flex flex-wrap items-center gap-2"},$o=["href"],Ao={class:"rounded-xl border border-gray-100 bg-white p-4 shadow-sm"},qo={class:"flex flex-wrap items-center justify-between gap-2"},Io={class:"flex flex-wrap gap-2"},Fo=["onClick"],Xo={key:0,class:"ml-1 text-[10px] text-gray-500"},Oo={class:"flex items-center gap-2 text-xs text-gray-700"},Do={class:"overflow-hidden rounded-xl border border-gray-100 bg-white shadow-sm"},Eo={class:"overflow-x-auto"},zo={key:0,class:"min-w-full divide-y divide-gray-200 text-sm"},Lo={class:"divide-y divide-gray-100"},Vo={class:"px-4 py-3 text-gray-900"},Ho={class:"px-4 py-3 text-gray-700"},Bo={class:"px-4 py-3"},Uo={class:"inline-flex items-center rounded-full bg-gray-100 px-2 py-0.5 text-xs font-medium text-gray-700"},To={class:"px-4 py-3 text-gray-700"},No={class:"px-4 py-3 text-xs text-gray-700"},Po={key:0,class:"space-y-2"},Wo={key:0},Ko={class:"flex flex-wrap gap-1"},Go={key:1},Yo={class:"flex flex-wrap gap-1"},Jo={key:2},Qo={class:"flex flex-wrap gap-1"},Zo=["onClick","disabled"],el={key:0,class:"h-3 w-3 animate-spin text-emerald-900",viewBox:"0 0 24 24",fill:"none"},tl={key:1},sl={key:3,class:"space-y-1 border-t border-dashed border-emerald-200 pt-2"},ol={class:"flex flex-wrap gap-1"},ll=["onClick","disabled"],al={class:"flex items-center gap-1"},nl={key:0,class:"h-3 w-3 animate-spin text-emerald-600",viewBox:"0 0 24 24",fill:"none"},rl={key:1,class:"text-[11px] italic text-gray-400"},dl={class:"px-4 py-3"},il={class:"flex justify-end gap-2"},ul=["onClick"],cl=["onClick"],vl=["onClick"],xl=["onClick"],ml=["onClick"],pl={key:0},gl={key:1,class:"divide-y divide-gray-100"},bl={class:"sticky top-0 z-10 bg-white px-4 py-2 text-sm font-semibold text-gray-800 ring-1 ring-gray-100"},yl={class:"ml-1 text-xs text-gray-500"},fl={class:"min-w-full divide-y divide-gray-200 text-sm"},wl={class:"divide-y divide-gray-100"},hl={class:"px-4 py-3 text-gray-900"},_l={class:"px-4 py-3 text-gray-700"},kl={class:"px-4 py-3"},Cl={class:"inline-flex items-center rounded-full bg-gray-100 px-2 py-0.5 text-xs font-medium text-gray-700"},jl={class:"px-4 py-3 text-xs text-gray-700"},Sl={key:0,class:"space-y-2"},Ml={key:0},Rl={class:"flex flex-wrap gap-1"},$l={key:1},Al={class:"flex flex-wrap gap-1"},ql={key:2},Il={class:"flex flex-wrap gap-1"},Fl=["onClick","disabled"],Xl={key:3,class:"space-y-1 border-t border-dashed border-emerald-200 pt-2"},Ol={class:"flex flex-wrap gap-1"},Dl=["onClick","disabled"],El={class:"flex items-center gap-1"},zl={key:0,class:"h-3 w-3 animate-spin text-emerald-600",viewBox:"0 0 24 24",fill:"none"},Ll={key:1,class:"text-[11px] italic text-gray-400"},Vl={class:"px-4 py-3"},Hl={class:"flex justify-end gap-2"},Bl=["onClick"],Ul=["onClick"],Tl=["onClick"],Nl=["onClick"],Pl={key:0,class:"flex flex-wrap items-center justify-between gap-2"},Wl={class:"text-xs text-gray-500"},Kl={class:"flex flex-wrap gap-1"},Gl=["disabled","onClick","innerHTML"],Yl={key:1,class:"fixed inset-0 z-50 flex items-center justify-center"},Jl={class:"relative z-10 w-full max-w-3xl overflow-hidden rounded-xl bg-white shadow-xl"},Ql={class:"flex items-center justify-between border-b px-5 py-3"},Zl={class:"text-xs text-gray-500"},ea={class:"grid gap-5 p-5 md:grid-cols-2"},ta={class:"mb-2 flex items-center justify-between"},sa={key:0,class:"text-xs text-gray-500"},oa={class:"rounded-lg border border-gray-100 bg-gray-50 p-3 text-xs text-gray-700"},la={key:0,class:"flex flex-wrap gap-1"},aa={key:1,class:"text-[11px] italic text-gray-400"},na={class:"space-y-4"},ra={class:"rounded-lg border border-gray-100 p-3"},da={class:"mb-3 flex flex-wrap items-center justify-between gap-2"},ia={key:0,class:"text-xs text-rose-600"},ua={class:"flex flex-col gap-3 sm:flex-row"},ca=["disabled"],va=["value"],xa=["disabled"],ma={key:0,class:"mt-2 text-xs text-gray-500"},pa={class:"rounded-lg border border-gray-100"},ga={key:0,class:"max-h-64 overflow-auto divide-y divide-gray-100 text-sm"},ba={class:"font-medium text-gray-800"},ya={class:"text-xs text-gray-500"},fa=["onClick","disabled"],wa={key:1,class:"p-4 text-xs text-gray-500"},ha={key:2,class:"fixed inset-0 z-50 flex items-center justify-center"},_a={class:"relative z-10 w-full max-w-2xl overflow-hidden rounded-xl bg-white shadow-xl"},ka={class:"flex items-center justify-between border-b px-5 py-3"},Ca={class:"grid gap-4 p-5 sm:grid-cols-2"},ja={key:0,class:"mt-1 text-xs text-red-600"},Sa={key:0,class:"mt-1 text-xs text-red-600"},Ma=["value"],Ra={key:0,class:"mt-1 text-xs text-red-600"},$a={key:0,class:"mt-1 text-xs text-red-600"},Aa={key:0,class:"mt-1 text-xs text-red-600"},qa={class:"flex"},Ia={class:"inline-flex items-center rounded-l-md border border-r-0 border-gray-300 bg-gray-50 px-2 text-xs text-gray-600"},Fa={key:0,class:"mt-1 text-xs text-gray-500"},Xa={key:1,class:"mt-1 text-xs text-red-600"},Oa={class:"sm:col-span-2"},Da={key:0,class:"mt-1 text-xs text-red-600"},Ea={key:0,class:"mt-1 text-xs text-red-600"},za={class:"sm:col-span-2"},La={key:0,class:"mt-1 text-xs text-red-600"},Va={key:1,class:"mt-2 rounded-md border border-amber-200 bg-amber-50 p-2 text-xs text-amber-800"},Ha={class:"mt-1 list-disc pl-5"},Ba={class:"flex items-center justify-end gap-2 border-t px-5 py-3"},Ua=["disabled"],Wa={__name:"Index",props:{students:{type:Object,required:!0},classes:{type:Array,required:!0},all_classes:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({q:"",class:"",sex:""})},school_number:{type:String,default:""},class_subjects:{type:Object,default:()=>({})}},setup(M){const k=M,z=x(k.filters.q||""),A=x(k.filters.class||""),W=x(k.filters.sex||"");function I(o=route("students.index")){se.get(o,{q:z.value,class:A.value,sex:W.value},{preserveState:!0,preserveScroll:!0,replace:!0})}const L=x(!1),F=x({id:null,name:"",reg_no:""}),oe=x(!1);function Ce(o){F.value={id:o.id||null,name:o.name,reg_no:o.reg_no},L.value=!0}async function He(){oe.value=!0;try{if(!F.value.id&&F.value.reg_no)try{const o=await fetch(route("students.show.json",{reg_no:F.value.reg_no}),{headers:{"X-Requested-With":"XMLHttpRequest"}});if(o.ok){const t=await o.json();F.value.id=t.id}}catch{}if(!F.value.id){window.__toast&&window.__toast("error","Missing student ID");return}await se.delete(route("students.destroy",{id:F.value.id}),{preserveScroll:!0,onSuccess:()=>{L.value=!1,window.__toast&&window.__toast("success","Student deleted")},onError:()=>{window.__toast&&window.__toast("error","Failed to delete")}})}finally{oe.value=!1}}async function je(o,t){if(!o?.id||!t?.id)return;const s=ne(o.id,t.id);qe(s,!0);try{const r=route("students.subjects.detach",{student:o.id,subject:t.id}),d=await fetch(r,{method:"DELETE",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":ie()}}),v=await d.json().catch(()=>({}));if(!d.ok){window.__toast&&window.__toast("error",v.message||"Imeshindikana kuondoa somo.");return}Ke(o.id,t),de(),window.__toast&&window.__toast("success","Somo limeondolewa.")}catch(r){window.__toast&&window.__toast("error",r instanceof Error?r.message:"Imeshindikana kuondoa somo.")}finally{qe(s,!1)}}async function Se(o,t){if(!o?.id||!t?.id){window.__toast&&window.__toast("error","Haikuwezekana kutambua mwanafunzi au somo.");return}const s=ne(o.id,t.id);Ie(s,!0);try{const r=route("students.subjects.attach",{student:o.id}),d=await fetch(r,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":ie(),"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({subject_id:t.id})}),v=await d.json().catch(()=>({}));if(!d.ok){window.__toast&&window.__toast("error",v.message||"Imeshindikana kuongeza somo.");return}Ge(o.id,t.id),de(),window.__toast&&window.__toast("success","Somo limeongezwa tena.")}catch(r){window.__toast&&window.__toast("error",r instanceof Error?r.message:"Imeshindikana kuongeza somo.")}finally{Ie(s,!1)}}const Be=x(!1),Me=x(!1),Ue=x({id:null,name:"",sex:"M",class_name:"",dob:"",academic_year:new Date().getFullYear(),guardian_name:"",guardian_phone:"",guardian_relation:"",exam_no:"",photo:null});async function Re(o){Be.value=!0,Me.value=!0,B.value="";try{const t=o.id?{id:o.id}:{reg_no:o.reg_no},s=route("students.show.json",t),r=await fetch(s,{headers:{"X-Requested-With":"XMLHttpRequest"}}),d=r.ok?await r.json():null;if(!d){B.value="Failed to load student for editing.",window.__toast&&window.__toast("error","Failed to load student");return}Ue.value={id:d.id,name:d.name||"",sex:d.sex||"M",class_name:d.class_name||"",dob:d.dob||"",academic_year:d.academic_year||new Date().getFullYear(),guardian_name:d.guardian_name||"",guardian_phone:d.guardian_phone||"",guardian_relation:d.guardian_relation||"",exam_no:d.exam_no||R.value,photo:null}}finally{Me.value=!1}}x(!1);const V=x(!1),w=x({format:"csv",scope:"current",class_name:""});function Te(){w.value={format:"csv",scope:"current",class_name:A.value||""},V.value=!0}function Ne(){let o=A.value||"";if(w.value.scope==="all"&&(o=""),w.value.scope==="class"&&w.value.class_name&&(o=w.value.class_name),w.value.format==="csv"){const t=route("students.export",{q:z.value,class:o,sex:W.value});window.location.href=t,V.value=!1}else alert("PDF export will be enabled after installing barryvdh/laravel-dompdf.")}function Pe(){N.value=!0,R.value&&!y.value.exam_no&&(y.value.exam_no=R.value)}function We(){z.value="",A.value="",W.value="",I()}const f=x({open:!1,items:[],loading:!1,index:-1});let ge;ze(z,o=>{ge&&clearTimeout(ge),ge=setTimeout(async()=>{if(I(),!o||o.length<2){f.value={open:!1,items:[],loading:!1,index:-1};return}f.value.loading=!0;try{const t=route("students.search",{q:o}),s=await fetch(t,{headers:{"X-Requested-With":"XMLHttpRequest"}});f.value.items=s.ok?await s.json():[],f.value.open=f.value.items.length>0}finally{f.value.loading=!1}},300)});const u=x({open:!1,loading:!1,student:null,core:[],classOptional:[],optional:[],available:[],addId:"",saving:!1,removingId:null,quickAddingId:null,error:""}),be=x(new Set),ye=x(new Set),K=vt(new Map);function le(o){if(!o)return[];const t=o.class_name||"",s=k.class_subjects?.[t]||[];return Array.isArray(s)?s:[]}function G(o){const t=le(o);return t.length?t.filter((s,r)=>s.is_core===!0||s.is_core===void 0&&r<7).slice(0,7):[]}function Y(o){const t=le(o);return t.length?t.filter((s,r)=>s.is_core===!1||s.is_core===void 0&&r>=7):[]}function O(o){if(!o)return[];const t=o.subjects||[];return Array.isArray(t)?t:[]}function $e(o){const t=Y(o);if(!t.length)return[];const s=new Set(O(o).map(r=>r.id));return t.filter(r=>!s.has(r.id))}function fe(o){return o&&(o.code||o.name)||"—"}function H(o){return o&&(o.name||o.code)||"—"}function Ae(o){return o?.name||o?.code||"—"}function Ke(o,t){if(!o||!t?.id)return;const s=K.get(o)||[];s.some(r=>r.id===t.id)||K.set(o,[...s,t])}function ae(o){return K.get(o)||[]}function Ge(o,t){if(!o||!t)return;const r=(K.get(o)||[]).filter(d=>d.id!==t);K.set(o,r)}function ne(o,t){return`${o??""}:${t??""}`}function qe(o,t){const s=new Set(be.value);t?s.add(o):s.delete(o),be.value=s}function we(o,t){return be.value.has(ne(o,t))}function Ie(o,t){const s=new Set(ye.value);t?s.add(o):s.delete(o),ye.value=s}function re(o,t){return ye.value.has(ne(o,t))}function Ye(){Object.assign(u.value,{open:!1,loading:!1,student:null,core:[],classOptional:[],optional:[],available:[],addId:"",saving:!1,removingId:null,error:""})}function Fe(){u.value.open=!1,setTimeout(()=>Ye(),200)}function he(o){if(!o)return;const t=Array.isArray(o.available)?o.available:[];Object.assign(u.value,{student:o.student||u.value.student,core:Array.isArray(o.core)?o.core:[],classOptional:Array.isArray(o.class_optional)?o.class_optional:u.value.classOptional,optional:Array.isArray(o.optional)?o.optional:[],available:t,addId:t.length?String(t[0].id):"",quickAddingId:null})}async function Je(o){const t=route("students.subjects",{student:o}),s=await fetch(t,{headers:{"X-Requested-With":"XMLHttpRequest"}});if(!s.ok){const r=await s.json().catch(()=>({}));throw new Error(r.message||"Failed to load subjects")}return s.json()}function de(){se.reload({only:["students","class_subjects"],preserveState:!0,preserveScroll:!0})}async function Xe(o){if(!o?.id){window.__toast&&window.__toast("error","Missing student ID");return}Object.assign(u.value,{open:!0,loading:!0,student:{id:o.id,name:o.name,reg_no:o.reg_no,class_name:o.class_name},core:G(o),classOptional:$e(o),optional:O(o),available:$e(o),addId:"",saving:!1,removingId:null,quickAddingId:null,error:""});try{const t=await Je(o.id);he(t)}catch(t){u.value.error=t instanceof Error?t.message:"Failed to load subjects"}finally{u.value.loading=!1}}function ie(){return document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}async function Qe(){if(u.value.student?.id){if(!u.value.addId){u.value.error="Chagua somo la kuongeza.";return}u.value.saving=!0,u.value.error="";try{const o=route("students.subjects.attach",{student:u.value.student.id}),t=await fetch(o,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":ie(),"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({subject_id:u.value.addId})}),s=await t.json().catch(()=>({}));if(!t.ok){u.value.error=s.message||"Imeshindikana kuongeza somo.";return}he(s),de(),window.__toast&&window.__toast("success","Somo limeongezwa.")}catch(o){u.value.error=o instanceof Error?o.message:"Imeshindikana kuongeza somo."}finally{u.value.saving=!1}}}async function Ze(o){if(u.value.student?.id){u.value.error="",u.value.removingId=o;try{const t=route("students.subjects.detach",{student:u.value.student.id,subject:o}),s=await fetch(t,{method:"DELETE",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":ie()}}),r=await s.json().catch(()=>({}));if(!s.ok){u.value.error=r.message||"Imeshindikana kuondoa somo.";return}he(r),de(),window.__toast&&window.__toast("success","Somo limeondolewa.")}catch(t){u.value.error=t instanceof Error?t.message:"Imeshindikana kuondoa somo."}finally{u.value.removingId=null}}}function et(o){if(f.value.open){if(o.key==="ArrowDown"&&(o.preventDefault(),f.value.index=Math.min(f.value.index+1,f.value.items.length-1)),o.key==="ArrowUp"&&(o.preventDefault(),f.value.index=Math.max(f.value.index-1,0)),o.key==="Enter"&&f.value.index>=0){o.preventDefault();const t=f.value.items[f.value.index];t&&U(t)}o.key==="Escape"&&(f.value.open=!1)}}const ue=x(!1),c=x(null),Oe=x(!1),B=x(""),tt=x([]),S=x("profile"),J=x([]),C=x({type:"Merit",severity:"",date:new Date().toISOString().slice(0,10),description:""}),ce=x(!1),_=x({status:"active",status_reason:"",status_date:new Date().toISOString().slice(0,10)}),ve=x(!1);async function U(o){f.value.open=!1,Oe.value=!0,B.value="",ue.value=!0;try{const t=route("students.show.json",o.id?{id:o.id}:{reg_no:o.reg_no}),s=await fetch(t,{headers:{"X-Requested-With":"XMLHttpRequest"}});if(s.ok){if(c.value=await s.json(),(!c.value.class_subjects||c.value.class_subjects.length===0)&&c.value.class_info?.id)try{const v=await fetch(route("classes.show.json",{id:c.value.class_info.id}),{headers:{"X-Requested-With":"XMLHttpRequest"}});if(v.ok){const ee=await v.json();c.value.class_subjects=ee?.subjects||[]}}catch{}}else if(c.value=o,B.value="Failed to load full details.",o?.class_name)try{const v=await fetch(route("classes.show.json",{name:o.class_name}),{headers:{"X-Requested-With":"XMLHttpRequest"}});if(v.ok){const ee=await v.json();c.value.class_subjects=ee?.subjects||[]}}catch{}_.value.status=c.value?.status||"active",_.value.status_reason=c.value?.status_reason||"",_.value.status_date=c.value?.status_date||new Date().toISOString().slice(0,10);const r=await fetch(route("students.history",{id:c.value?.id||o.id}),{headers:{"X-Requested-With":"XMLHttpRequest"}});tt.value=r.ok?(await r.json()).items:[];const d=await fetch(route("students.behaviours",{id:c.value?.id||o.id}),{headers:{"X-Requested-With":"XMLHttpRequest"}});J.value=d.ok?(await d.json()).items:[]}finally{Oe.value=!1}}async function st(){if(c.value?.id){ce.value=!0;try{if((await fetch(route("students.behaviours.add",{id:c.value.id}),{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector("meta[name=csrf-token]")?.getAttribute("content")||""},body:new URLSearchParams({type:C.value.type,severity:C.value.severity||"",date:C.value.date,description:C.value.description||""})})).ok){const t=await fetch(route("students.behaviours",{id:c.value.id}),{headers:{"X-Requested-With":"XMLHttpRequest"}});J.value=t.ok?(await t.json()).items:J.value,C.value.description="",window.__toast&&window.__toast("success","Behaviour saved")}else window.__toast&&window.__toast("error","Failed to save behaviour")}finally{ce.value=!1}}}async function ot(){if(c.value?.id){ve.value=!0;try{(await fetch(route("students.status.update",{id:c.value.id}),{method:"PATCH",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector("meta[name=csrf-token]")?.getAttribute("content")||"","Content-Type":"application/json"},body:JSON.stringify({status:_.value.status,status_reason:_.value.status_reason||"",status_date:_.value.status_date})})).ok?(c.value.status=_.value.status,c.value.status_reason=_.value.status_reason,c.value.status_date=_.value.status_date,window.__toast&&window.__toast("success","Status updated")):window.__toast&&window.__toast("error","Failed to update status")}finally{ve.value=!1}}}const T=x(!1),Q=x(null),xe=x(!1),X=x({headers:[],rows:[],total:0});function lt(){X.value={headers:[],rows:[],total:0},Q.value=null,T.value=!0}function at(o){const t=o.split(/\r?\n/).filter(d=>d.trim().length);if(!t.length)return{headers:[],rows:[],total:0};const s=t[0].split(",").map(d=>d.trim()),r=t.slice(1).map(d=>d.split(",").map(v=>v.trim()));return{headers:s,rows:r.slice(0,10),total:r.length}}function nt(o){const t=o.target.files?.[0];if(Q.value=t||null,!t){X.value={headers:[],rows:[],total:0};return}const s=new FileReader;s.onload=()=>{try{X.value=at(String(s.result||""))}catch{X.value={headers:[],rows:[],total:0}}},s.readAsText(t)}async function rt(){if(!Q.value)return;const o=new FormData;o.append("file",Q.value),xe.value=!0;try{await se.post(route("students.import"),o,{preserveScroll:!0,onSuccess:()=>{T.value=!1,window.__toast&&window.__toast("success","Import completed")},onError:()=>{window.__toast&&window.__toast("error","Import failed")}})}finally{xe.value=!1}}const N=x(!1),y=x({name:"",sex:"M",class_name:"",dob:"",academic_year:new Date().getFullYear(),guardian_name:"",guardian_phone:"",guardian_relation:"",exam_no:"",photo:null}),R=E(()=>k.school_number?`${k.school_number}-`:"");function dt(o){y.value.photo=o.target.files?.[0]??null}function it(){if(!R.value)return;const o=y.value.exam_no||"";o&&!o.startsWith(R.value)&&(y.value.exam_no=R.value+o.replace(/^.*?-/,""))}const me=x(!1);async function ut(){const o=new FormData;Object.entries(y.value).forEach(([t,s])=>{s!=null&&s!==""&&o.append(t,s)}),me.value=!0;try{await se.post(route("students.store"),o,{preserveScroll:!0,onSuccess:()=>{N.value=!1,window.__toast&&window.__toast("success","Student added successfully")},onError:t=>{const s=Object.values(t||{})[0]||"Failed to add student";window.__toast&&window.__toast("error",String(s))}}),y.value={name:"",sex:"M",class_name:"",dob:"",academic_year:new Date().getFullYear(),guardian_name:"",guardian_phone:"",guardian_relation:"",exam_no:R.value,photo:null}}finally{me.value=!1}}const De=xt(),h=E(()=>De.props.errors||{}),P=E(()=>De.props.flash||{}),_e=x(!1),pe=E(()=>{const o={};return(k.students?.data||[]).forEach(t=>{o[t.class_name]=(o[t.class_name]||0)+1}),o});E(()=>Object.keys(pe.value).sort());const Ee=E(()=>{const o=new Set([...k.all_classes||[],...k.classes||[]]);return Array.from(o).filter(Boolean).sort()}),ct=E(()=>k.all_classes&&k.all_classes.length?k.all_classes:k.classes),Z=x({count:0,students:[]});let ke;return ze(()=>y.value.guardian_phone,o=>{ke&&clearTimeout(ke),ke=setTimeout(async()=>{if(!o){Z.value={count:0,students:[]};return}try{const t=route("students.guardian.stats",{phone:o}),s=await fetch(t,{headers:{"X-Requested-With":"XMLHttpRequest"}});s.ok&&(Z.value=await s.json())}catch{}},300)}),(o,t)=>(a(),l(p,null,[Le(mt(pt),{title:"Students"}),Le(yt,null,{header:Ve(()=>[...t[55]||(t[55]=[e("h2",{class:"text-xl font-semibold leading-tight text-gray-800"},"Students",-1)])]),default:Ve(()=>[e("div",ft,[e("div",wt,[e("div",ht,[e("div",_t,[t[59]||(t[59]=e("label",{for:"q",class:"mb-1 block text-xs font-medium text-gray-600"},"Search (Reg_No or Name)",-1)),g(e("input",{id:"q","onUpdate:modelValue":t[0]||(t[0]=s=>z.value=s),onKeydown:et,onKeyup:t[1]||(t[1]=gt(s=>I(),["enter"])),type:"text",placeholder:"e.g. RSMS-001 or Asha",class:"w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},null,544),[[$,z.value]]),f.value.open?(a(),l("div",kt,[f.value.loading?(a(),l("div",Ct,"Loading...")):(a(),l("ul",jt,[(a(!0),l(p,null,b(f.value.items,(s,r)=>(a(),l("li",{key:s.reg_no,onClick:d=>U(s),class:D(["cursor-pointer px-3 py-2 hover:bg-gray-50",r===f.value.index?"bg-gray-50":""])},[e("div",Mt,[e("div",Rt,n(s.name),1),e("div",$t,n(s.reg_no),1)]),P.value.success||P.value.error?(a(),l("div",At,[P.value.success?(a(),l("div",qt,n(P.value.success),1)):i("",!0),P.value.error?(a(),l("div",It,n(P.value.error),1)):i("",!0)])):i("",!0),L.value?(a(),l("div",Ft,[e("div",{class:"absolute inset-0 bg-black/40",onClick:t[2]||(t[2]=d=>L.value=!1)}),e("div",Xt,[e("div",Ot,[t[57]||(t[57]=e("h3",{class:"text-base font-semibold text-gray-800"},"Delete Student",-1)),e("button",{onClick:t[3]||(t[3]=d=>L.value=!1),class:"rounded-md p-1 text-gray-500 hover:bg-gray-100","aria-label":"Close"},[...t[56]||(t[56]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Dt,[e("p",Et,[t[58]||(t[58]=m("Are you sure you want to delete ",-1)),e("span",zt,n(F.value.name),1),m(" ("+n(F.value.reg_no)+")? This action cannot be undone.",1)])]),e("div",Lt,[e("button",{onClick:t[4]||(t[4]=d=>L.value=!1),type:"button",class:"rounded-md border border-gray-300 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50"},"Cancel"),e("button",{disabled:oe.value,onClick:He,type:"button",class:"rounded-md bg-rose-600 px-4 py-2 text-sm font-medium text-white hover:bg-rose-700 disabled:opacity-60"},n(oe.value?"Deleting...":"Delete"),9,Vt)])])])):i("",!0),e("div",Ht,n(s.class_name)+" • "+n(s.sex),1)],10,St))),128))]))])):i("",!0)]),ue.value?(a(),l("div",Bt,[e("div",{class:"absolute inset-0 bg-black/40",onClick:t[5]||(t[5]=s=>ue.value=!1)}),e("div",Ut,[e("div",Tt,[e("div",Nt,[e("div",Pt,[c.value?.photo_path?(a(),l("img",{key:0,src:"/storage/"+c.value.photo_path,alt:"photo",class:"h-10 w-10 object-cover"},null,8,Wt)):i("",!0)]),e("div",null,[e("div",Kt,n(c.value?.name||"Student"),1),e("div",Gt,n(c.value?.reg_no)+" • "+n(c.value?.class_name)+" • "+n(c.value?.sex),1)])]),e("button",{onClick:t[6]||(t[6]=s=>ue.value=!1),class:"rounded-md p-1 text-gray-500 hover:bg-gray-100","aria-label":"Close"},[...t[60]||(t[60]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Yt,[B.value?(a(),l("div",Jt,[m(n(B.value)+" ",1),e("button",{onClick:t[7]||(t[7]=s=>U(c.value||{})),class:"ml-2 rounded border border-amber-300 px-2 py-0.5 text-amber-700 hover:bg-amber-100"},"Retry")])):i("",!0),e("div",Qt,[e("button",{onClick:t[8]||(t[8]=s=>S.value="profile"),class:D([S.value==="profile"?"border-b-2 border-green-600 text-green-700":"text-gray-600","px-2 py-1"])},"Profile",2),e("button",{onClick:t[9]||(t[9]=s=>S.value="behaviours"),class:D([S.value==="behaviours"?"border-b-2 border-green-600 text-green-700":"text-gray-600","px-2 py-1"])},"Behaviours",2),e("button",{onClick:t[10]||(t[10]=s=>S.value="results"),class:D([S.value==="results"?"border-b-2 border-green-600 text-green-700":"text-gray-600","px-2 py-1"])},"Results History",2),e("button",{onClick:t[11]||(t[11]=s=>S.value="status"),class:D([S.value==="status"?"border-b-2 border-green-600 text-green-700":"text-gray-600","px-2 py-1"])},"Status & Actions",2)])]),e("div",Zt,[S.value==="profile"?(a(),l("div",es,[e("div",ts,[t[68]||(t[68]=e("div",{class:"text-sm font-semibold text-gray-800"},"Registration",-1)),e("div",ss,[e("div",null,[t[61]||(t[61]=e("div",{class:"text-xs text-gray-500"},"Reg No",-1)),e("div",os,n(c.value?.reg_no),1)]),e("div",null,[t[62]||(t[62]=e("div",{class:"text-xs text-gray-500"},"Class",-1)),e("div",ls,n(c.value?.class_name),1)]),e("div",null,[t[63]||(t[63]=e("div",{class:"text-xs text-gray-500"},"Sex",-1)),e("div",as,n(c.value?.sex),1)]),e("div",null,[t[64]||(t[64]=e("div",{class:"text-xs text-gray-500"},"DOB",-1)),e("div",ns,n(c.value?.dob||"-"),1)]),e("div",rs,[t[65]||(t[65]=e("div",{class:"text-xs text-gray-500"},"Exam No",-1)),e("div",ds,n(c.value?.exam_no||"-"),1)])]),e("div",is,[t[66]||(t[66]=e("div",{class:"text-sm font-semibold text-gray-800"},"Assigned subjects",-1)),c.value?.class_info?.id?(a(),l("a",{key:0,href:o.route("classes.show",{id:c.value.class_info.id}),class:"text-xs text-green-700 hover:underline"},"Open class",8,us)):i("",!0)]),e("div",cs,[(a(!0),l(p,null,b(c.value?.class_subjects||[],s=>(a(),l("span",{key:s.id,title:s.name,class:"inline-flex items-center rounded-full bg-gray-100 px-2 py-0.5 text-xs text-gray-700"},n(s.code||s.name),9,vs))),128)),!c.value?.class_subjects||c.value.class_subjects.length===0?(a(),l("span",xs,"No subjects")):i("",!0)]),c.value?.class_subjects&&c.value.class_subjects.length?(a(),l("div",ms,[e("table",ps,[t[67]||(t[67]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-3 py-2 text-left font-semibold text-gray-700"},"Code"),e("th",{class:"px-3 py-2 text-left font-semibold text-gray-700"},"Name")])],-1)),e("tbody",gs,[(a(!0),l(p,null,b(c.value.class_subjects,s=>(a(),l("tr",{key:s.id,class:"hover:bg-gray-50"},[e("td",bs,n(s.code||"—"),1),e("td",ys,n(s.name),1)]))),128))])])])):i("",!0)]),e("div",fs,[t[69]||(t[69]=e("div",{class:"text-sm font-semibold text-gray-800"},"Guardian",-1)),e("div",ws,"Name: "+n(c.value?.guardian_name||"-"),1),e("div",hs,"Phone: "+n(c.value?.guardian_phone||"-"),1),e("div",_s,"Relation: "+n(c.value?.guardian_relation||"-"),1)])])):i("",!0),S.value==="behaviours"?(a(),l("div",ks,[e("div",Cs,[t[72]||(t[72]=e("div",{class:"mb-3 text-sm font-semibold text-gray-800"},"Add Behaviour",-1)),e("div",js,[g(e("select",{"onUpdate:modelValue":t[12]||(t[12]=s=>C.value.type=s),class:"w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},[...t[70]||(t[70]=[e("option",{value:"Merit"},"Merit",-1),e("option",{value:"Demerit"},"Demerit",-1)])],512),[[q,C.value.type]]),g(e("select",{"onUpdate:modelValue":t[13]||(t[13]=s=>C.value.severity=s),class:"w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},[...t[71]||(t[71]=[e("option",{value:""},"Severity",-1),e("option",null,"Low",-1),e("option",null,"Medium",-1),e("option",null,"High",-1)])],512),[[q,C.value.severity]]),g(e("input",{"onUpdate:modelValue":t[14]||(t[14]=s=>C.value.date=s),type:"date",class:"w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},null,512),[[$,C.value.date]]),e("button",{disabled:ce.value,onClick:st,class:"rounded-md bg-green-600 px-3 py-2 text-sm font-medium text-white hover:bg-green-700 disabled:opacity-60"},n(ce.value?"Saving...":"Save"),9,Ss)]),g(e("textarea",{"onUpdate:modelValue":t[15]||(t[15]=s=>C.value.description=s),rows:"3",placeholder:"Description (optional)",class:"mt-3 w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},null,512),[[$,C.value.description]])]),e("div",Ms,[t[73]||(t[73]=e("div",{class:"border-b px-4 py-2 text-sm font-semibold text-gray-800"},"Recent Behaviours",-1)),e("div",Rs,[J.value.length===0?(a(),l("div",$s,"No behaviour records.")):i("",!0),e("ul",As,[(a(!0),l(p,null,b(J.value,s=>(a(),l("li",{key:s.id,class:"flex items-start justify-between gap-3 px-3 py-2"},[e("div",null,[e("div",qs,[m(n(s.type)+" ",1),s.severity?(a(),l("span",Is,n(s.severity),1)):i("",!0)]),e("div",Fs,n(s.date||"-"),1),e("div",Xs,n(s.description),1)])]))),128))])])])])):i("",!0),S.value==="results"?(a(),l("div",Os," Results history integration can be wired here. ")):i("",!0),S.value==="status"?(a(),l("div",Ds,[e("div",Es,[t[75]||(t[75]=e("div",{class:"mb-3 text-sm font-semibold text-gray-800"},"Current Status",-1)),e("div",zs,[t[74]||(t[74]=m("Status: ",-1)),e("span",Ls,n(c.value?.status||"active"),1)]),e("div",Vs,"Since: "+n(c.value?.status_date||"-"),1),e("div",Hs,"Reason: "+n(c.value?.status_reason||"-"),1)]),e("div",Bs,[t[77]||(t[77]=e("div",{class:"mb-3 text-sm font-semibold text-gray-800"},"Update Status",-1)),e("div",Us,[g(e("select",{"onUpdate:modelValue":t[16]||(t[16]=s=>_.value.status=s),class:"w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},[...t[76]||(t[76]=[e("option",{value:"active"},"Active",-1),e("option",{value:"suspended"},"Suspended",-1),e("option",{value:"transferred"},"Transferred",-1),e("option",{value:"alumni"},"Alumni",-1),e("option",{value:"expelled"},"Expelled",-1)])],512),[[q,_.value.status]]),g(e("input",{"onUpdate:modelValue":t[17]||(t[17]=s=>_.value.status_date=s),type:"date",class:"w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},null,512),[[$,_.value.status_date]]),e("button",{disabled:ve.value,onClick:ot,class:"rounded-md bg-green-600 px-3 py-2 text-sm font-medium text-white hover:bg-green-700 disabled:opacity-60"},n(ve.value?"Saving...":"Save"),9,Ts)]),g(e("textarea",{"onUpdate:modelValue":t[18]||(t[18]=s=>_.value.status_reason=s),rows:"3",placeholder:"Reason (optional)",class:"mt-3 w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},null,512),[[$,_.value.status_reason]])])])):i("",!0)])])])):i("",!0),V.value?(a(),l("div",Ns,[e("div",{class:"absolute inset-0 bg-black/40",onClick:t[19]||(t[19]=s=>V.value=!1)}),e("div",Ps,[e("div",Ws,[t[79]||(t[79]=e("h3",{class:"text-base font-semibold text-gray-800"},"Export Students",-1)),e("button",{onClick:t[20]||(t[20]=s=>V.value=!1),class:"rounded-md p-1 text-gray-500 hover:bg-gray-100","aria-label":"Close"},[...t[78]||(t[78]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Ks,[e("div",null,[t[84]||(t[84]=e("div",{class:"mb-1 text-xs font-medium text-gray-600"},"Scope",-1)),e("div",Gs,[e("label",Ys,[g(e("input",{type:"radio",value:"current","onUpdate:modelValue":t[21]||(t[21]=s=>w.value.scope=s)},null,512),[[te,w.value.scope]]),t[80]||(t[80]=m(" Current filters ",-1))]),e("label",Js,[g(e("input",{type:"radio",value:"all","onUpdate:modelValue":t[22]||(t[22]=s=>w.value.scope=s)},null,512),[[te,w.value.scope]]),t[81]||(t[81]=m(" All students ",-1))]),e("div",Qs,[e("label",Zs,[g(e("input",{type:"radio",value:"class","onUpdate:modelValue":t[23]||(t[23]=s=>w.value.scope=s)},null,512),[[te,w.value.scope]]),t[82]||(t[82]=m(" Class ",-1))]),g(e("select",{disabled:w.value.scope!=="class","onUpdate:modelValue":t[24]||(t[24]=s=>w.value.class_name=s),class:"w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},[t[83]||(t[83]=e("option",{value:""},"Select class",-1)),(a(!0),l(p,null,b(M.classes,s=>(a(),l("option",{key:s,value:s},n(s),9,to))),128))],8,eo),[[q,w.value.class_name]])])])]),e("div",null,[t[87]||(t[87]=e("div",{class:"mb-1 text-xs font-medium text-gray-600"},"Format",-1)),e("div",so,[e("label",oo,[g(e("input",{type:"radio",value:"csv","onUpdate:modelValue":t[25]||(t[25]=s=>w.value.format=s)},null,512),[[te,w.value.format]]),t[85]||(t[85]=m(" CSV",-1))]),e("label",lo,[g(e("input",{type:"radio",value:"pdf","onUpdate:modelValue":t[26]||(t[26]=s=>w.value.format=s)},null,512),[[te,w.value.format]]),t[86]||(t[86]=m(" PDF",-1))])]),t[88]||(t[88]=e("p",{class:"mt-1 text-xs text-gray-500"},"PDF will be enabled after installing the PDF package.",-1))])]),e("div",ao,[e("button",{onClick:t[27]||(t[27]=s=>V.value=!1),type:"button",class:"rounded-md border border-gray-300 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50"},"Cancel"),e("button",{onClick:Ne,type:"button",class:"rounded-md bg-green-600 px-4 py-2 text-sm font-medium text-white hover:bg-green-700"},"Export")])])])):i("",!0),T.value?(a(),l("div",no,[e("div",{class:"absolute inset-0 bg-black/40",onClick:t[28]||(t[28]=s=>T.value=!1)}),e("div",ro,[e("div",io,[t[90]||(t[90]=e("h3",{class:"text-base font-semibold text-gray-800"},"Import Students (CSV)",-1)),e("button",{onClick:t[29]||(t[29]=s=>T.value=!1),class:"rounded-md p-1 text-gray-500 hover:bg-gray-100","aria-label":"Close"},[...t[89]||(t[89]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",uo,[e("div",co,[e("div",vo,[t[96]||(t[96]=e("div",{class:"font-semibold text-gray-800"},"Instructions",-1)),e("ol",xo,[t[93]||(t[93]=e("li",null,"Download the CSV template and fill it.",-1)),t[94]||(t[94]=e("li",null,[m("Required columns: "),e("code",null,"reg_no,name,sex,class_name"),m(".")],-1)),t[95]||(t[95]=e("li",null,[m("Optional columns: "),e("code",null,"guardian_name,guardian_phone,guardian_relation,academic_year,dob,exam_no"),m(".")],-1)),e("li",null,[t[91]||(t[91]=m("If you include ",-1)),t[92]||(t[92]=e("code",null,"exam_no",-1)),m(", prefix must match your school number ("+n(M.school_number)+"-XXXX).",1)])])]),e("a",{href:o.route("students.template"),class:"inline-flex items-center justify-center rounded-md border border-gray-300 px-3 py-2 text-sm text-gray-700 hover:bg-gray-50"},"Download Template",8,mo),e("div",null,[t[97]||(t[97]=e("label",{class:"mb-1 block text-xs font-medium text-gray-600"},[m("Choose CSV file "),e("span",{class:"text-red-600"},"*")],-1)),e("input",{type:"file",accept:".csv,text/csv",onChange:nt,class:"w-full rounded-md border border-gray-300 text-sm shadow-sm"},null,32),t[98]||(t[98]=e("p",{class:"mt-1 text-xs text-gray-500"},"Max size ~10MB. Use commas, no embedded commas inside values.",-1))])]),e("div",po,[e("div",go,[t[99]||(t[99]=m("Preview ",-1)),X.value.total?(a(),l("span",bo,"(showing first 10 of "+n(X.value.total)+")",1)):i("",!0)]),X.value.headers.length?(a(),l("div",yo,[e("table",fo,[e("thead",wo,[e("tr",null,[(a(!0),l(p,null,b(X.value.headers,s=>(a(),l("th",{key:s,class:"px-3 py-2 text-left font-medium text-gray-700"},n(s),1))),128))])]),e("tbody",ho,[(a(!0),l(p,null,b(X.value.rows,(s,r)=>(a(),l("tr",{key:r},[(a(!0),l(p,null,b(s,(d,v)=>(a(),l("td",{key:v,class:"px-3 py-2 text-gray-700"},n(d),1))),128))]))),128))])])])):(a(),l("div",_o,"No file selected."))])]),e("div",ko,[e("button",{onClick:t[30]||(t[30]=s=>T.value=!1),type:"button",class:"rounded-md border border-gray-300 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50"},"Cancel"),e("button",{disabled:!Q.value||xe.value,onClick:rt,type:"button",class:"rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-60"},n(xe.value?"Importing...":"Confirm Import"),9,Co)])])])):i("",!0),e("div",null,[t[101]||(t[101]=e("label",{for:"class",class:"mb-1 block text-xs font-medium text-gray-600"},"Class",-1)),g(e("select",{id:"class","onUpdate:modelValue":t[31]||(t[31]=s=>A.value=s),onChange:t[32]||(t[32]=s=>I()),class:"w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},[t[100]||(t[100]=e("option",{value:""},"All",-1)),(a(!0),l(p,null,b(Ee.value,s=>(a(),l("option",{key:s,value:s},n(s),9,jo))),128))],544),[[q,A.value]])]),e("div",null,[t[103]||(t[103]=e("label",{for:"sex",class:"mb-1 block text-xs font-medium text-gray-600"},"Sex",-1)),g(e("select",{id:"sex","onUpdate:modelValue":t[33]||(t[33]=s=>W.value=s),onChange:t[34]||(t[34]=s=>I()),class:"w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},[...t[102]||(t[102]=[e("option",{value:""},"All",-1),e("option",{value:"M"},"Male",-1),e("option",{value:"F"},"Female",-1)])],544),[[q,W.value]])])]),e("div",So,[e("button",{type:"button",onClick:t[35]||(t[35]=s=>We()),class:"rounded-md border border-gray-300 px-3 py-2 text-sm text-gray-700 hover:bg-gray-50"},"Clear"),e("button",{type:"button",onClick:t[36]||(t[36]=s=>I()),class:"rounded-md bg-green-600 px-3 py-2 text-sm font-medium text-white hover:bg-green-700"},"Search")])]),e("div",Mo,[t[104]||(t[104]=e("div",{class:"text-sm text-gray-600"},"Bulk actions",-1)),e("div",Ro,[e("button",{type:"button",onClick:t[37]||(t[37]=s=>lt()),class:"rounded-md bg-blue-600 px-3 py-2 text-sm font-medium text-white hover:bg-blue-700"},"Import CSV"),e("a",{href:o.route("students.template"),class:"rounded-md border border-gray-300 px-3 py-2 text-sm text-gray-700 hover:bg-gray-50"},"Download Template",8,$o),e("button",{type:"button",onClick:t[38]||(t[38]=s=>Te()),class:"rounded-md border border-gray-300 px-3 py-2 text-sm text-gray-700 hover:bg-gray-50"},"Export"),e("button",{type:"button",onClick:t[39]||(t[39]=s=>Pe()),class:"rounded-md bg-emerald-600 px-3 py-2 text-sm font-medium text-white hover:bg-emerald-700"},"Add Student")])]),e("div",Ao,[e("div",qo,[e("div",Io,[e("button",{type:"button",onClick:t[40]||(t[40]=s=>{A.value="",I()}),class:D(["rounded-full px-3 py-1 text-xs",A.value===""?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"])},"All",2),(a(!0),l(p,null,b(Ee.value,s=>(a(),l("button",{key:s,type:"button",onClick:r=>{A.value=s,I()},class:D(["rounded-full px-3 py-1 text-xs",A.value===s?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"])},[m(n(s),1),pe.value[s]?(a(),l("span",Xo," ("+n(pe.value[s])+")",1)):i("",!0)],10,Fo))),128))]),e("label",Oo,[g(e("input",{type:"checkbox","onUpdate:modelValue":t[41]||(t[41]=s=>_e.value=s)},null,512),[[bt,_e.value]]),t[105]||(t[105]=m(" Group by class ",-1))])])]),e("div",Do,[e("div",Eo,[_e.value?(a(),l("div",gl,[(a(!0),l(p,null,b(pe.value,(s,r)=>(a(),l("div",{key:r,class:"p-0"},[e("div",bl,[m(n(r)+" ",1),e("span",yl,"("+n(s)+")",1)]),e("table",fl,[t[130]||(t[130]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"},"Reg_No"),e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"},"Full name"),e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"},"Sex"),e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"},"Subjects"),e("th",{class:"px-4 py-3 text-right font-semibold text-gray-700"},"Action")])],-1)),e("tbody",wl,[(a(!0),l(p,null,b((M.students.data||[]).filter(d=>d.class_name===r),d=>(a(),l("tr",{key:d.reg_no,class:"hover:bg-gray-50"},[e("td",hl,n(d.reg_no),1),e("td",_l,n(d.name),1),e("td",kl,[e("span",Cl,n(d.sex),1)]),e("td",jl,[le(d).length||O(d).length?(a(),l("div",Sl,[G(d).length?(a(),l("div",Ml,[t[120]||(t[120]=e("div",{class:"mb-1 text-[11px] font-semibold uppercase tracking-wide text-slate-500"},"Core",-1)),e("div",Rl,[(a(!0),l(p,null,b(G(d),v=>(a(),l("span",{key:`group-core-${d.reg_no}-${v.id}`,class:"inline-flex items-center rounded-full border border-slate-200 bg-slate-100 px-2 py-0.5 text-[11px] font-medium text-slate-700"},n(H(v)),1))),128))])])):i("",!0),Y(d).length?(a(),l("div",$l,[t[121]||(t[121]=e("div",{class:"mb-1 text-[11px] font-semibold uppercase tracking-wide text-amber-600"},"Class Optional",-1)),e("div",Al,[(a(!0),l(p,null,b(Y(d),v=>(a(),l("span",{key:`group-cls-opt-${d.reg_no}-${v.id}`,class:"inline-flex items-center gap-1 rounded-full border border-amber-200 bg-amber-50 px-2 py-0.5 text-[11px] font-medium text-amber-700"},[e("span",null,n(H(v)),1)]))),128))])])):i("",!0),O(d).length?(a(),l("div",ql,[t[122]||(t[122]=e("div",{class:"mb-1 text-[11px] font-semibold uppercase tracking-wide text-emerald-600"},"Optional",-1)),e("div",Il,[(a(!0),l(p,null,b(O(d),v=>(a(),l("span",{key:`group-opt-${d.reg_no}-${v.id}`,class:"inline-flex items-center gap-1 rounded-full border border-emerald-200 bg-emerald-50 px-2 py-0.5 text-[11px] font-medium text-emerald-700"},[e("span",null,n(H(v)),1),e("button",{type:"button",onClick:j(ee=>je(d,v),["stop"]),disabled:we(d.id,v.id),class:"rounded-full bg-emerald-200/60 p-0.5 text-[10px] text-emerald-900 hover:bg-emerald-300 disabled:opacity-50"}," × ",8,Fl)]))),128))])])):i("",!0),ae(d.id).length?(a(),l("div",Xl,[t[125]||(t[125]=e("div",{class:"text-[11px] font-semibold uppercase tracking-wide text-emerald-500"},"Removed (click to add back)",-1)),e("div",Ol,[(a(!0),l(p,null,b(ae(d.id),v=>(a(),l("button",{key:`group-removed-${d.reg_no}-${v.id}`,type:"button",onClick:j(ee=>Se(d,v),["stop"]),disabled:re(d.id,v.id),class:"inline-flex items-center gap-2 rounded-full border border-emerald-300 bg-white px-2 py-0.5 text-[11px] font-medium text-emerald-600 hover:bg-emerald-50 disabled:opacity-60"},[t[124]||(t[124]=e("span",{class:"rounded-full bg-emerald-100 px-1.5 py-0.5 text-[9px] uppercase tracking-wide text-emerald-600"},"Add",-1)),e("span",El,[re(d.id,v.id)?(a(),l("svg",zl,[...t[123]||(t[123]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"3"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v3a5 5 0 00-5 5H4z"},null,-1)])])):i("",!0),e("span",null,n(Ae(v)),1)])],8,Dl))),128))])])):i("",!0)])):(a(),l("div",Ll,"No subjects yet"))]),e("td",Vl,[e("div",Hl,[e("button",{type:"button",onClick:j(v=>Xe(d),["stop"]),class:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-amber-50 text-amber-600 ring-1 ring-inset ring-amber-200 hover:bg-amber-100","aria-label":"Manage Subjects"},[...t[126]||(t[126]=[e("svg",{class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 19.5A2.5 2.5 0 006.5 22H20"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 4.5A2.5 2.5 0 016.5 2H20v18H6.5A2.5 2.5 0 014 17.5V4.5z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8 6h8M8 10h8M8 14h5"})],-1)])],8,Bl),e("button",{type:"button",onClick:j(v=>U(d),["stop"]),class:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-indigo-50 text-indigo-600 ring-1 ring-inset ring-indigo-200 hover:bg-indigo-100","aria-label":"View"},[...t[127]||(t[127]=[e("svg",{class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 12s3.75-7.5 9.75-7.5S21.75 12 21.75 12s-3.75 7.5-9.75 7.5S2.25 12 2.25 12z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 15a3 3 0 100-6 3 3 0 000 6z"})],-1)])],8,Ul),e("button",{type:"button",onClick:j(v=>Re(d),["stop"]),class:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-emerald-50 text-emerald-600 ring-1 ring-inset ring-emerald-200 hover:bg-emerald-100","aria-label":"Edit"},[...t[128]||(t[128]=[e("svg",{class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.862 3.487a2.1 2.1 0 113 3L8.25 18.1 4.5 19.5l1.4-3.75 10.962-12.263z"})],-1)])],8,Tl),e("button",{type:"button",onClick:j(v=>Ce(d),["stop"]),class:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-rose-50 text-rose-600 ring-1 ring-inset ring-rose-200 hover:bg-rose-100","aria-label":"Delete"},[...t[129]||(t[129]=[e("svg",{class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 7h12M9 7V5a2 2 0 012-2h2a2 2 0 012 2v2m-1 0l-.867 12.142A2 2 0 0114.138 21H9.862a2 2 0 01-1.995-1.858L7 7z"})],-1)])],8,Nl)])])]))),128))])])]))),128))])):(a(),l("table",zo,[t[119]||(t[119]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"},"Reg_No"),e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"},"Full name"),e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"},"Sex"),e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"},"Class"),e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"},"Subjects"),e("th",{class:"px-4 py-3 text-right font-semibold text-gray-700"},"Action")])],-1)),e("tbody",Lo,[(a(!0),l(p,null,b(M.students.data,s=>(a(),l("tr",{key:s.reg_no,class:"hover:bg-gray-50"},[e("td",Vo,n(s.reg_no),1),e("td",Ho,n(s.name),1),e("td",Bo,[e("span",Uo,n(s.sex),1)]),e("td",To,n(s.class_name),1),e("td",No,[le(s).length||O(s).length?(a(),l("div",Po,[G(s).length?(a(),l("div",Wo,[t[106]||(t[106]=e("div",{class:"mb-1 text-[11px] font-semibold uppercase tracking-wide text-slate-500"},"Core",-1)),e("div",Ko,[(a(!0),l(p,null,b(G(s),r=>(a(),l("span",{key:`core-${s.reg_no}-${r.id}`,class:"inline-flex items-center gap-1 rounded-full border border-slate-200 bg-slate-100 px-2 py-0.5 text-[11px] font-medium text-slate-700"},[e("span",null,n(H(r)),1)]))),128))])])):i("",!0),Y(s).length?(a(),l("div",Go,[t[107]||(t[107]=e("div",{class:"mb-1 text-[11px] font-semibold uppercase tracking-wide text-amber-600"},"Class Optional",-1)),e("div",Yo,[(a(!0),l(p,null,b(Y(s),r=>(a(),l("span",{key:`cls-opt-${s.reg_no}-${r.id}`,class:"inline-flex items-center gap-1 rounded-full border border-amber-200 bg-amber-50 px-2 py-0.5 text-[11px] font-medium text-amber-700"},[e("span",null,n(H(r)),1)]))),128))])])):i("",!0),O(s).length?(a(),l("div",Jo,[t[109]||(t[109]=e("div",{class:"mb-1 text-[11px] font-semibold uppercase tracking-wide text-emerald-600"},"Optional",-1)),e("div",Qo,[(a(!0),l(p,null,b(O(s),r=>(a(),l("span",{key:`opt-${s.reg_no}-${r.id}`,class:"inline-flex items-center gap-1 rounded-full border border-emerald-200 bg-emerald-50 px-2 py-0.5 text-[11px] font-medium text-emerald-700"},[e("span",null,n(H(r)),1),e("button",{type:"button",onClick:j(d=>je(s,r),["stop"]),disabled:we(s.id,r.id),class:"flex h-4 w-4 items-center justify-center rounded-full bg-emerald-200/60 text-[10px] text-emerald-900 hover:bg-emerald-300 disabled:opacity-50","aria-label":"Remove subject"},[we(s.id,r.id)?(a(),l("svg",el,[...t[108]||(t[108]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"3"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v3a5 5 0 00-5 5H4z"},null,-1)])])):(a(),l("span",tl,"×"))],8,Zo)]))),128))])])):i("",!0),ae(s.id).length?(a(),l("div",sl,[t[112]||(t[112]=e("div",{class:"text-[11px] font-semibold uppercase tracking-wide text-emerald-500"},"Removed (click to add back)",-1)),e("div",ol,[(a(!0),l(p,null,b(ae(s.id),r=>(a(),l("button",{key:`removed-${s.reg_no}-${r.id}`,type:"button",onClick:j(d=>Se(s,r),["stop"]),disabled:re(s.id,r.id),class:"inline-flex items-center gap-2 rounded-full border border-emerald-300 bg-white px-2 py-0.5 text-[11px] font-medium text-emerald-600 hover:bg-emerald-50 disabled:opacity-60"},[t[111]||(t[111]=e("span",{class:"rounded-full bg-emerald-100 px-1.5 py-0.5 text-[9px] uppercase tracking-wide text-emerald-600"},"Add",-1)),e("span",al,[re(s.id,r.id)?(a(),l("svg",nl,[...t[110]||(t[110]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"3"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v3a5 5 0 00-5 5H4z"},null,-1)])])):i("",!0),e("span",null,n(Ae(r)),1)])],8,ll))),128))])])):i("",!0)])):(a(),l("div",rl,"No subjects yet"))]),e("td",dl,[e("div",il,[e("button",{type:"button",onClick:j(r=>Xe(s),["stop"]),class:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-amber-50 text-amber-600 ring-1 ring-inset ring-amber-200 hover:bg-amber-100","aria-label":"Manage Subjects"},[...t[113]||(t[113]=[e("svg",{class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 19.5A2.5 2.5 0 006.5 22H20"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 4.5A2.5 2.5 0 016.5 2H20v18H6.5A2.5 2.5 0 014 17.5V4.5z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8 6h8M8 10h8M8 14h5"})],-1)])],8,ul),e("button",{type:"button",onClick:j(r=>U(s),["stop"]),class:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-indigo-50 text-indigo-600 ring-1 ring-inset ring-indigo-200 hover:bg-indigo-100","aria-label":"View"},[...t[114]||(t[114]=[e("svg",{class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 12s3.75-7.5 9.75-7.5S21.75 12 21.75 12s-3.75 7.5-9.75 7.5S2.25 12 2.25 12z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 15a3 3 0 100-6 3 3 0 000 6z"})],-1)])],8,cl),e("button",{type:"button",onClick:j(r=>U(s),["stop"]),class:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-sky-50 text-sky-600 ring-1 ring-inset ring-sky-200 hover:bg-sky-100","aria-label":"History"},[...t[115]||(t[115]=[e("svg",{class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 12a9 9 0 109-9v2"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 3v6h6"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 7v5l3 3"})],-1)])],8,vl),e("button",{type:"button",onClick:j(r=>Re(s),["stop"]),class:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-emerald-50 text-emerald-600 ring-1 ring-inset ring-emerald-200 hover:bg-emerald-100","aria-label":"Edit"},[...t[116]||(t[116]=[e("svg",{class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.862 3.487a2.1 2.1 0 113 3L8.25 18.1 4.5 19.5l1.4-3.75 10.962-12.263z"})],-1)])],8,xl),e("button",{type:"button",onClick:j(r=>Ce(s),["stop"]),class:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-rose-50 text-rose-600 ring-1 ring-inset ring-rose-200 hover:bg-rose-100","aria-label":"Delete"},[...t[117]||(t[117]=[e("svg",{class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 7h12M9 7V5a2 2 0 012-2h2a2 2 0 012 2v2m-1 0l-.867 12.142A2 2 0 0114.138 21H9.862a2 2 0 01-1.995-1.858L7 7z"})],-1)])],8,ml)])])]))),128)),(M.students.data||[]).length===0?(a(),l("tr",pl,[...t[118]||(t[118]=[e("td",{colspan:"6",class:"px-4 py-8 text-center text-sm text-gray-500"},"No students found.",-1)])])):i("",!0)])]))])]),M.students.links?(a(),l("div",Pl,[e("div",Wl,"Showing "+n(M.students.from||0)+"-"+n(M.students.to||0)+" of "+n(M.students.total||0),1),e("div",Kl,[(a(!0),l(p,null,b(M.students.links,(s,r)=>(a(),l("button",{key:r,disabled:!s.url,onClick:d=>s.url&&I(s.url),class:D(["rounded-md px-3 py-1.5 text-sm",[s.active?"bg-green-600 text-white":"border border-gray-300 text-gray-700 hover:bg-gray-50",s.url?"":"opacity-50"]]),innerHTML:s.label},null,10,Gl))),128))])])):i("",!0),u.value.open?(a(),l("div",Yl,[e("div",{class:"absolute inset-0 bg-black/40",onClick:Fe}),e("div",Jl,[e("div",Ql,[e("div",null,[t[131]||(t[131]=e("div",{class:"text-base font-semibold text-gray-800"},"Manage Subjects",-1)),e("div",Zl,n(u.value.student?.name)+" • "+n(u.value.student?.reg_no)+" • "+n(u.value.student?.class_name||"No class"),1)]),e("button",{onClick:Fe,class:"rounded-md p-1 text-gray-500 hover:bg-gray-100","aria-label":"Close"},[...t[132]||(t[132]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",ea,[e("div",null,[e("div",ta,[t[133]||(t[133]=e("h3",{class:"text-sm font-semibold text-gray-800"},"Class Core Subjects",-1)),u.value.loading?(a(),l("span",sa,"Loading…")):i("",!0)]),e("div",oa,[u.value.core.length?(a(),l("div",la,[(a(!0),l(p,null,b(u.value.core,s=>(a(),l("span",{key:`modal-core-${s.id}`,class:"inline-flex items-center rounded-full border border-slate-200 bg-white px-2 py-0.5 text-[11px] font-medium text-slate-700"},[t[134]||(t[134]=e("span",{class:"mr-1 rounded-full bg-slate-100 px-1.5 py-0.5 text-[10px] uppercase tracking-wide text-slate-500"},"CORE",-1)),m(" "+n(fe(s)),1)]))),128))])):(a(),l("div",aa,"No core subjects detected for this class."))])]),e("div",na,[e("div",ra,[e("div",da,[t[135]||(t[135]=e("h3",{class:"text-sm font-semibold text-gray-800"},"Add Optional Subject",-1)),u.value.error?(a(),l("div",ia,n(u.value.error),1)):i("",!0)]),e("div",ua,[g(e("select",{"onUpdate:modelValue":t[42]||(t[42]=s=>u.value.addId=s),disabled:u.value.saving||u.value.loading,class:"flex-1 rounded-md border-gray-300 text-sm shadow-sm focus:border-emerald-600 focus:ring-emerald-600"},[t[136]||(t[136]=e("option",{value:""},"Chagua somo",-1)),(a(!0),l(p,null,b(u.value.available,s=>(a(),l("option",{key:s.id,value:String(s.id)},n(fe(s))+" — "+n(s.name),9,va))),128))],8,ca),[[q,u.value.addId]]),e("button",{type:"button",onClick:Qe,disabled:u.value.saving||u.value.loading,class:"inline-flex items-center justify-center rounded-md bg-emerald-600 px-3 py-2 text-sm font-medium text-white hover:bg-emerald-700 disabled:opacity-60"},n(u.value.saving?"Saving…":"Add Subject"),9,xa)]),u.value.available.length?i("",!0):(a(),l("p",ma,"Hakuna masomo ya ziada yaliyobaki. Jaribu kuondoa ili kubadilisha."))]),e("div",pa,[t[137]||(t[137]=e("div",{class:"border-b px-4 py-2 text-sm font-semibold text-gray-800"},"Optional Subjects",-1)),u.value.optional.length?(a(),l("div",ga,[(a(!0),l(p,null,b(u.value.optional,s=>(a(),l("div",{key:`modal-opt-${s.id}`,class:"flex items-center justify-between gap-3 px-4 py-2"},[e("div",null,[e("div",ba,n(fe(s)),1),e("div",ya,n(s.name),1)]),e("button",{type:"button",onClick:r=>Ze(s.id),disabled:u.value.removingId===s.id,class:"inline-flex items-center justify-center rounded-md border border-rose-200 bg-rose-50 px-2 py-1 text-xs font-medium text-rose-700 hover:bg-rose-100 disabled:opacity-60"},n(u.value.removingId===s.id?"Removing…":"Remove"),9,fa)]))),128))])):(a(),l("div",wa,"Haujachagua somo la ziada bado."))])])])])])):i("",!0),N.value?(a(),l("div",ha,[e("div",{class:"absolute inset-0 bg-black/40",onClick:t[43]||(t[43]=s=>N.value=!1)}),e("div",_a,[e("div",ka,[t[139]||(t[139]=e("h3",{class:"text-base font-semibold text-gray-800"},"Add Student",-1)),e("button",{onClick:t[44]||(t[44]=s=>N.value=!1),class:"rounded-md p-1 text-gray-500 hover:bg-gray-100","aria-label":"Close"},[...t[138]||(t[138]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Ca,[e("div",null,[t[140]||(t[140]=e("label",{class:"mb-1 block text-xs font-medium text-gray-600"},[m("Full Name "),e("span",{class:"text-red-600"},"*")],-1)),g(e("input",{"onUpdate:modelValue":t[45]||(t[45]=s=>y.value.name=s),required:"",type:"text",class:"w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},null,512),[[$,y.value.name]]),h.value.name?(a(),l("p",ja,n(h.value.name),1)):i("",!0)]),e("div",null,[t[142]||(t[142]=e("label",{class:"mb-1 block text-xs font-medium text-gray-600"},[m("Sex "),e("span",{class:"text-red-600"},"*")],-1)),g(e("select",{"onUpdate:modelValue":t[46]||(t[46]=s=>y.value.sex=s),required:"",class:"w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},[...t[141]||(t[141]=[e("option",{value:"M"},"Male",-1),e("option",{value:"F"},"Female",-1)])],512),[[q,y.value.sex]]),h.value.sex?(a(),l("p",Sa,n(h.value.sex),1)):i("",!0)]),e("div",null,[t[144]||(t[144]=e("label",{class:"mb-1 block text-xs font-medium text-gray-600"},[m("Class "),e("span",{class:"text-red-600"},"*")],-1)),g(e("select",{"onUpdate:modelValue":t[47]||(t[47]=s=>y.value.class_name=s),required:"",class:"w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},[t[143]||(t[143]=e("option",{value:"",disabled:""},"Select class",-1)),(a(!0),l(p,null,b(ct.value,s=>(a(),l("option",{key:s,value:s},n(s),9,Ma))),128))],512),[[q,y.value.class_name]]),h.value.class_name?(a(),l("p",Ra,n(h.value.class_name),1)):i("",!0)]),e("div",null,[t[145]||(t[145]=e("label",{class:"mb-1 block text-xs font-medium text-gray-600"},[m("Date of Birth "),e("span",{class:"text-red-600"},"*")],-1)),g(e("input",{"onUpdate:modelValue":t[48]||(t[48]=s=>y.value.dob=s),required:"",type:"date",class:"w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},null,512),[[$,y.value.dob]]),h.value.dob?(a(),l("p",$a,n(h.value.dob),1)):i("",!0)]),e("div",null,[t[146]||(t[146]=e("label",{class:"mb-1 block text-xs font-medium text-gray-600"},[m("Academic Year "),e("span",{class:"text-red-600"},"*")],-1)),g(e("input",{"onUpdate:modelValue":t[49]||(t[49]=s=>y.value.academic_year=s),required:"",type:"number",min:"2000",max:"2100",class:"w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},null,512),[[$,y.value.academic_year]]),h.value.academic_year?(a(),l("p",Aa,n(h.value.academic_year),1)):i("",!0)]),e("div",null,[t[147]||(t[147]=e("label",{class:"mb-1 block text-xs font-medium text-gray-600"},[m("Exam Number "),e("span",{class:"text-red-600"},"*")],-1)),e("div",qa,[e("span",Ia,n(R.value),1),g(e("input",{"onUpdate:modelValue":t[50]||(t[50]=s=>y.value.exam_no=s),required:"",onBlur:it,type:"text",placeholder:"e.g. 0011",class:"w-full rounded-r-md border border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},null,544),[[$,y.value.exam_no]])]),R.value?(a(),l("p",Fa,"Format: "+n(R.value)+"XXXX (e.g. "+n(R.value)+"0011)",1)):i("",!0),h.value.exam_no?(a(),l("p",Xa,n(h.value.exam_no),1)):i("",!0)]),e("div",Oa,[t[148]||(t[148]=e("label",{class:"mb-1 block text-xs font-medium text-gray-600"},"Photo",-1)),e("input",{type:"file",accept:"image/*",onChange:dt,class:"w-full rounded-md border border-gray-300 text-sm shadow-sm"},null,32)]),t[153]||(t[153]=e("div",{class:"sm:col-span-2 mt-2"},[e("div",{class:"text-sm font-semibold text-gray-800"},"Guardian Details")],-1)),e("div",null,[t[149]||(t[149]=e("label",{class:"mb-1 block text-xs font-medium text-gray-600"},[m("Guardian Name "),e("span",{class:"text-red-600"},"*")],-1)),g(e("input",{"onUpdate:modelValue":t[51]||(t[51]=s=>y.value.guardian_name=s),required:"",type:"text",class:"w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},null,512),[[$,y.value.guardian_name]]),h.value.guardian_name?(a(),l("p",Da,n(h.value.guardian_name),1)):i("",!0)]),e("div",null,[t[151]||(t[151]=e("label",{class:"mb-1 block text-xs font-medium text-gray-600"},[m("Relation "),e("span",{class:"text-red-600"},"*")],-1)),g(e("select",{"onUpdate:modelValue":t[52]||(t[52]=s=>y.value.guardian_relation=s),required:"",class:"w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},[...t[150]||(t[150]=[e("option",{value:""},"Select",-1),e("option",{value:"Parent"},"Parent",-1),e("option",{value:"Mother"},"Mother",-1),e("option",{value:"Father"},"Father",-1),e("option",{value:"Guardian"},"Guardian",-1),e("option",{value:"Relative"},"Relative",-1)])],512),[[q,y.value.guardian_relation]]),h.value.guardian_relation?(a(),l("p",Ea,n(h.value.guardian_relation),1)):i("",!0)]),e("div",za,[t[152]||(t[152]=e("label",{class:"mb-1 block text-xs font-medium text-gray-600"},[m("Guardian Phone "),e("span",{class:"text-red-600"},"*")],-1)),g(e("input",{"onUpdate:modelValue":t[53]||(t[53]=s=>y.value.guardian_phone=s),required:"",type:"tel",inputmode:"tel",placeholder:"2557########",class:"w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},null,512),[[$,y.value.guardian_phone]]),h.value.guardian_phone?(a(),l("p",La,n(h.value.guardian_phone),1)):i("",!0),Z.value.count>0?(a(),l("div",Va,[m(" This guardian has "+n(Z.value.count)+" student(s): ",1),e("ul",Ha,[(a(!0),l(p,null,b(Z.value.students,s=>(a(),l("li",{key:s.reg_no},n(s.reg_no)+" — "+n(s.name)+" ("+n(s.class_name)+")",1))),128))])])):i("",!0)])]),e("div",Ba,[e("button",{onClick:t[54]||(t[54]=s=>N.value=!1),type:"button",class:"rounded-md border border-gray-300 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50"},"Cancel"),e("button",{disabled:me.value,onClick:ut,type:"button",class:"rounded-md bg-green-600 px-4 py-2 text-sm font-medium text-white hover:bg-green-700 disabled:opacity-60"},n(me.value?"Saving...":"Save Student"),9,Ua)])])])):i("",!0)])]),_:1})],64))}};export{Wa as default};
