import{r as i,G as Q,E as Y,q as B,c as o,a as z,u as T,h as Z,w as N,b as e,p as x,s as g,D as w,o as a,F as m,y as h,n as H,t as d,l as ee,e as b,i as O,v as R,k as $}from"./app-CNtTXHrN.js";import{_ as te}from"./AuthenticatedLayout-2X-NjQgu.js";const se={class:"space-y-4"},le={class:"rounded-xl border border-gray-100 bg-white p-4 shadow-sm"},oe={class:"flex items-end justify-between gap-3"},ae={class:"relative max-w-md flex-1"},re={key:0,class:"absolute z-20 mt-1 w-full overflow-hidden rounded-md border border-gray-200 bg-white shadow"},ne={key:0,class:"p-2 text-xs text-gray-500"},de={key:1,class:"max-h-60 overflow-auto text-sm"},ie=["onClick"],ue={class:"flex items-center justify-between"},ce={class:"font-medium text-gray-800"},xe={class:"text-xs text-gray-500"},ve={class:"overflow-hidden rounded-xl border border-gray-100 bg-white shadow-sm"},be={class:"overflow-x-auto"},ge={class:"min-w-full divide-y divide-gray-200 text-sm"},me={class:"divide-y divide-gray-100"},ye={class:"px-4 py-3 text-gray-900"},fe={class:"px-4 py-3"},pe={class:"inline-flex items-center rounded-full bg-gray-100 px-2 py-0.5 text-xs text-gray-700"},we={class:"px-4 py-3 text-gray-700"},he={class:"flex flex-wrap gap-1"},_e={key:0,class:"text-xs text-gray-500"},ke={class:"px-4 py-3"},je={class:"inline-flex items-center rounded-full bg-emerald-50 px-2 py-0.5 text-xs text-emerald-700 ring-1 ring-inset ring-emerald-200"},Ce={class:"px-4 py-3"},Se={class:"flex justify-end gap-2"},qe=["onClick"],Me=["onClick"],$e={key:0},Ae={key:0,class:"flex flex-wrap items-center justify-between gap-2"},De={class:"text-xs text-gray-500"},Le={class:"flex flex-wrap gap-1"},Ve=["disabled","onClick","innerHTML"],Ee={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},ze={class:"relative z-10 w-full max-w-xl overflow-hidden rounded-xl bg-white shadow-xl"},Ne={class:"flex items-center justify-between border-b px-5 py-3"},Fe={class:"space-y-4 p-5"},Ue={class:"grid gap-4 sm:grid-cols-2"},Be={key:0,class:"mt-1 text-xs text-red-600"},Te={key:0,class:"mt-1 text-xs text-red-600"},He={class:"mb-2 flex items-end justify-between gap-2"},Oe={class:"flex-1"},Re={class:"flex gap-2"},Xe={class:"flex max-h-48 flex-wrap gap-2 overflow-auto rounded-md border border-gray-200 p-2"},Ke=["value"],We={key:0,class:"px-2 py-1 text-xs text-gray-500"},Ge={class:"flex items-center justify-end gap-2 border-t px-5 py-3"},Ie=["disabled"],Pe={key:1,class:"fixed inset-0 z-50 flex items-center justify-center"},Je={class:"relative z-10 w-full max-w-xl overflow-hidden rounded-xl bg-white shadow-xl"},Qe={class:"flex items-center justify-between border-b px-5 py-3"},Ye={class:"space-y-4 p-5"},Ze={class:"grid gap-4 sm:grid-cols-2"},et={class:"flex max-h-48 flex-wrap gap-2 overflow-auto rounded-md border border-gray-200 p-2"},tt=["value"],st={class:"flex items-center justify-end gap-2 border-t px-5 py-3"},lt=["disabled"],ot={key:2,class:"fixed inset-0 z-50 flex items-center justify-center"},at={class:"relative z-10 w-full max-w-md overflow-hidden rounded-xl bg-white shadow-xl"},rt={class:"flex items-center justify-between border-b px-5 py-3"},nt={class:"space-y-3 p-5 text-sm"},dt={class:"text-gray-700"},it={class:"font-semibold"},ut={class:"flex items-center justify-end gap-2 border-t px-5 py-3"},ct=["disabled"],bt={__name:"Index",props:{subjects:{type:Object,required:!0},classes:{type:Array,required:!0},filters:{type:Object,default:()=>({q:""})}},setup(v){const A=v,_=i(A.filters.q||"");function F(l=route("subjects.index")){$.get(l,{q:_.value},{preserveScroll:!0,preserveState:!0,replace:!0})}const r=i({open:!1,items:[],loading:!1,index:-1});let D;Q(_,l=>{D&&clearTimeout(D),D=setTimeout(async()=>{if(F(),!l||l.length<2){r.value={open:!1,items:[],loading:!1,index:-1};return}r.value.loading=!0;try{const t=await fetch(route("subjects.search",{q:l}),{headers:{"X-Requested-With":"XMLHttpRequest"}});r.value.items=t.ok?await t.json():[],r.value.open=r.value.items.length>0}finally{r.value.loading=!1}},300)});function X(l){if(r.value.open){if(l.key==="ArrowDown"&&(l.preventDefault(),r.value.index=Math.min(r.value.index+1,r.value.items.length-1)),l.key==="ArrowUp"&&(l.preventDefault(),r.value.index=Math.max(r.value.index-1,0)),l.key==="Enter"&&r.value.index>=0){l.preventDefault();const t=r.value.items[r.value.index];t&&V(t)}l.key==="Escape"&&(r.value.open=!1)}}const K=Y(),k=B(()=>K.props.errors||{}),y=i(!1),c=i({name:"",code:"",class_ids:[]}),j=i(!1),C=i(""),L=B(()=>{const l=C.value.trim().toLowerCase();return l?A.classes.filter(t=>(t.name||"").toLowerCase().includes(l)):A.classes});function W(){c.value={name:"",code:"",class_ids:[]},C.value="",y.value=!0}async function G(){j.value=!0;try{await $.post(route("subjects.store"),c.value,{preserveScroll:!0,onSuccess:()=>{y.value=!1,window.__toast&&window.__toast("success","Subject created")},onError:l=>{const t=Object.values(l||{})[0]||"Failed to create";window.__toast&&window.__toast("error",String(t))}})}finally{j.value=!1}}const f=i(!1),U=i(!1),u=i({id:null,name:"",code:"",class_ids:[]});async function V(l){f.value=!0,U.value=!0;try{const t=l.id,s=await fetch(route("subjects.show.json",{id:t}),{headers:{"X-Requested-With":"XMLHttpRequest"}}),n=s.ok?await s.json():null;if(!n){window.__toast&&window.__toast("error","Failed to load subject");return}u.value={id:n.id,name:n.name,code:n.code,class_ids:(n.classes||[]).map(E=>E.id)}}finally{U.value=!1}}const S=i(!1);async function I(){if(u.value.id){S.value=!0;try{await $.patch(route("subjects.update",{id:u.value.id}),{name:u.value.name,code:u.value.code,class_ids:u.value.class_ids},{preserveScroll:!0,onSuccess:()=>{f.value=!1,window.__toast&&window.__toast("success","Subject updated")},onError:l=>{const t=Object.values(l||{})[0]||"Failed to update";window.__toast&&window.__toast("error",String(t))}})}finally{S.value=!1}}}const p=i(!1),q=i({id:null,name:""}),M=i(!1);function P(l){q.value={id:l.id,name:l.name},p.value=!0}async function J(){if(q.value.id){M.value=!0;try{await $.delete(route("subjects.destroy",{id:q.value.id}),{preserveScroll:!0,onSuccess:()=>{p.value=!1,window.__toast&&window.__toast("success","Subject deleted")},onError:()=>{window.__toast&&window.__toast("error","Failed to delete")}})}finally{M.value=!1}}}return(l,t)=>(a(),o(m,null,[z(T(Z),{title:"Subjects"}),z(te,null,{header:N(()=>[...t[19]||(t[19]=[e("h2",{class:"text-xl font-semibold leading-tight text-gray-800"},"Subjects",-1)])]),default:N(()=>[e("div",se,[e("div",le,[e("div",oe,[e("div",ae,[t[20]||(t[20]=e("label",{for:"q",class:"mb-1 block text-xs font-medium text-gray-600"},"Search subject",-1)),g(e("input",{id:"q","onUpdate:modelValue":t[0]||(t[0]=s=>_.value=s),onKeydown:X,type:"text",placeholder:"e.g. Mathematics or MATH",class:"w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},null,544),[[w,_.value]]),r.value.open?(a(),o("div",re,[r.value.loading?(a(),o("div",ne,"Loading...")):(a(),o("ul",de,[(a(!0),o(m,null,h(r.value.items,(s,n)=>(a(),o("li",{key:s.id,onClick:E=>V(s),class:H(["cursor-pointer px-3 py-2 hover:bg-gray-50",n===r.value.index?"bg-gray-50":""])},[e("div",ue,[e("div",ce,d(s.name),1),e("div",xe,d(s.code),1)])],10,ie))),128))]))])):x("",!0)]),e("div",null,[e("button",{type:"button",onClick:W,class:"rounded-md bg-gradient-to-r from-green-600 to-emerald-600 px-3 py-2 text-sm font-medium text-white shadow hover:from-green-700 hover:to-emerald-700"},"Add Subject")])])]),t[25]||(t[25]=e("div",{class:"rounded-md border border-emerald-200 bg-emerald-50 px-4 py-2 text-xs text-emerald-800"}," Subjects listed here are scoped to your school. Codes must be unique within your school. ",-1)),e("div",ve,[e("div",be,[e("table",ge,[t[24]||(t[24]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"},"Name"),e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"},"Code"),e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"},"Assigned classes"),e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"},"Count"),e("th",{class:"px-4 py-3 text-right font-semibold text-gray-700"},"Action")])],-1)),e("tbody",me,[(a(!0),o(m,null,h(v.subjects.data,s=>(a(),o("tr",{key:s.id,class:"hover:bg-gray-50"},[e("td",ye,[z(T(ee),{href:l.route("subjects.show",{id:s.id}),class:"text-green-700 hover:underline"},{default:N(()=>[b(d(s.name),1)]),_:2},1032,["href"])]),e("td",fe,[e("span",pe,d(s.code),1)]),e("td",we,[e("div",he,[(a(!0),o(m,null,h(s.classes,n=>(a(),o("span",{key:n.id,class:"inline-flex items-center rounded-full bg-gray-100 px-2 py-0.5 text-xs text-gray-700"},d(n.name),1))),128)),!s.classes||s.classes.length===0?(a(),o("span",_e,"No classes")):x("",!0)])]),e("td",ke,[e("span",je,d(s.classes&&s.classes.length||0),1)]),e("td",Ce,[e("div",Se,[e("button",{type:"button",onClick:O(n=>V(s),["stop"]),class:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-emerald-50 text-emerald-600 ring-1 ring-inset ring-emerald-200 hover:bg-emerald-100","aria-label":"Edit"},[...t[21]||(t[21]=[e("svg",{class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.862 3.487a2.1 2.1 0 113 3L8.25 18.1 4.5 19.5l1.4-3.75 10.962-12.263z"})],-1)])],8,qe),e("button",{type:"button",onClick:O(n=>P(s),["stop"]),class:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-rose-50 text-rose-600 ring-1 ring-inset ring-rose-200 hover:bg-rose-100","aria-label":"Delete"},[...t[22]||(t[22]=[e("svg",{class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 7h12M9 7V5a2 2 0 012-2h2a2 2 0 012 2v2m-1 0l-.867 12.142A2 2 0 0114.138 21H9.862a2 2 0 01-1.995-1.858L7 7z"})],-1)])],8,Me)])])]))),128)),(v.subjects.data||[]).length===0?(a(),o("tr",$e,[...t[23]||(t[23]=[e("td",{colspan:"4",class:"px-4 py-8 text-center text-sm text-gray-500"},"No subjects found.",-1)])])):x("",!0)])])])]),v.subjects.links?(a(),o("div",Ae,[e("div",De,"Showing "+d(v.subjects.from||0)+"-"+d(v.subjects.to||0)+" of "+d(v.subjects.total||0),1),e("div",Le,[(a(!0),o(m,null,h(v.subjects.links,(s,n)=>(a(),o("button",{key:n,disabled:!s.url,onClick:E=>s.url&&F(s.url),class:H(["rounded-md px-3 py-1.5 text-sm",[s.active?"bg-green-600 text-white":"border border-gray-300 text-gray-700 hover:bg-gray-50",s.url?"":"opacity-50"]]),innerHTML:s.label},null,10,Ve))),128))])])):x("",!0)]),y.value?(a(),o("div",Ee,[e("div",{class:"absolute inset-0 bg-black/40",onClick:t[1]||(t[1]=s=>y.value=!1)}),e("div",ze,[e("div",Ne,[t[27]||(t[27]=e("h3",{class:"text-base font-semibold text-gray-800"},"Add Subject",-1)),e("button",{onClick:t[2]||(t[2]=s=>y.value=!1),class:"rounded-md p-1 text-gray-500 hover:bg-gray-100","aria-label":"Close"},[...t[26]||(t[26]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Fe,[e("div",Ue,[e("div",null,[t[28]||(t[28]=e("label",{class:"mb-1 block text-xs font-medium text-gray-600"},[b("Name "),e("span",{class:"text-red-600"},"*")],-1)),g(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>c.value.name=s),required:"",type:"text",class:"w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},null,512),[[w,c.value.name]]),k.value.name?(a(),o("p",Be,d(k.value.name),1)):x("",!0)]),e("div",null,[t[29]||(t[29]=e("label",{class:"mb-1 block text-xs font-medium text-gray-600"},[b("Code "),e("span",{class:"text-red-600"},"*")],-1)),g(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>c.value.code=s),required:"",type:"text",class:"w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},null,512),[[w,c.value.code]]),k.value.code?(a(),o("p",Te,d(k.value.code),1)):x("",!0)])]),e("div",null,[t[30]||(t[30]=e("label",{class:"mb-1 block text-xs font-medium text-gray-600"},"Assign classes",-1)),e("div",He,[e("div",Oe,[g(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>C.value=s),type:"text",placeholder:"Filter classes...",class:"w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},null,512),[[w,C.value]])]),e("div",Re,[e("button",{type:"button",onClick:t[6]||(t[6]=s=>c.value.class_ids=L.value.map(n=>n.id)),class:"rounded-md border border-gray-300 px-3 py-1.5 text-xs text-gray-700 hover:bg-gray-50"},"Select all"),e("button",{type:"button",onClick:t[7]||(t[7]=s=>c.value.class_ids=[]),class:"rounded-md border border-gray-300 px-3 py-1.5 text-xs text-gray-700 hover:bg-gray-50"},"Clear")])]),e("div",Xe,[(a(!0),o(m,null,h(L.value,s=>(a(),o("label",{key:s.id,class:"flex items-center gap-2 rounded-md bg-gray-50 px-2 py-1 text-sm text-gray-700 ring-1 ring-inset ring-gray-200"},[g(e("input",{type:"checkbox",value:s.id,"onUpdate:modelValue":t[8]||(t[8]=n=>c.value.class_ids=n)},null,8,Ke),[[R,c.value.class_ids]]),b(" "+d(s.name),1)]))),128)),L.value.length===0?(a(),o("div",We,"No classes found.")):x("",!0)])])]),e("div",Ge,[e("button",{onClick:t[9]||(t[9]=s=>y.value=!1),type:"button",class:"rounded-md border border-gray-300 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50"},"Cancel"),e("button",{disabled:j.value,onClick:G,type:"button",class:"rounded-md bg-green-600 px-4 py-2 text-sm font-medium text-white hover:bg-green-700 disabled:opacity-60"},d(j.value?"Saving...":"Save"),9,Ie)])])])):x("",!0),f.value?(a(),o("div",Pe,[e("div",{class:"absolute inset-0 bg-black/40",onClick:t[10]||(t[10]=s=>f.value=!1)}),e("div",Je,[e("div",Qe,[t[32]||(t[32]=e("h3",{class:"text-base font-semibold text-gray-800"},"Edit Subject",-1)),e("button",{onClick:t[11]||(t[11]=s=>f.value=!1),class:"rounded-md p-1 text-gray-500 hover:bg-gray-100","aria-label":"Close"},[...t[31]||(t[31]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Ye,[e("div",Ze,[e("div",null,[t[33]||(t[33]=e("label",{class:"mb-1 block text-xs font-medium text-gray-600"},[b("Name "),e("span",{class:"text-red-600"},"*")],-1)),g(e("input",{"onUpdate:modelValue":t[12]||(t[12]=s=>u.value.name=s),required:"",type:"text",class:"w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},null,512),[[w,u.value.name]])]),e("div",null,[t[34]||(t[34]=e("label",{class:"mb-1 block text-xs font-medium text-gray-600"},[b("Code "),e("span",{class:"text-red-600"},"*")],-1)),g(e("input",{"onUpdate:modelValue":t[13]||(t[13]=s=>u.value.code=s),required:"",type:"text",class:"w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},null,512),[[w,u.value.code]])])]),e("div",null,[t[35]||(t[35]=e("label",{class:"mb-1 block text-xs font-medium text-gray-600"},"Assign classes",-1)),e("div",et,[(a(!0),o(m,null,h(v.classes,s=>(a(),o("label",{key:s.id,class:"flex items-center gap-2 rounded-md bg-gray-50 px-2 py-1 text-sm text-gray-700 ring-1 ring-inset ring-gray-200"},[g(e("input",{type:"checkbox",value:s.id,"onUpdate:modelValue":t[14]||(t[14]=n=>u.value.class_ids=n)},null,8,tt),[[R,u.value.class_ids]]),b(" "+d(s.name),1)]))),128))])])]),e("div",st,[e("button",{onClick:t[15]||(t[15]=s=>f.value=!1),type:"button",class:"rounded-md border border-gray-300 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50"},"Cancel"),e("button",{disabled:S.value,onClick:I,type:"button",class:"rounded-md bg-green-600 px-4 py-2 text-sm font-medium text-white hover:bg-green-700 disabled:opacity-60"},d(S.value?"Saving...":"Save changes"),9,lt)])])])):x("",!0),p.value?(a(),o("div",ot,[e("div",{class:"absolute inset-0 bg-black/40",onClick:t[16]||(t[16]=s=>p.value=!1)}),e("div",at,[e("div",rt,[t[37]||(t[37]=e("h3",{class:"text-base font-semibold text-gray-800"},"Delete Subject",-1)),e("button",{onClick:t[17]||(t[17]=s=>p.value=!1),class:"rounded-md p-1 text-gray-500 hover:bg-gray-100","aria-label":"Close"},[...t[36]||(t[36]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",nt,[e("p",dt,[t[38]||(t[38]=b("Are you sure you want to delete ",-1)),e("span",it,d(q.value.name),1),t[39]||(t[39]=b("?",-1))])]),e("div",ut,[e("button",{onClick:t[18]||(t[18]=s=>p.value=!1),type:"button",class:"rounded-md border border-gray-300 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50"},"Cancel"),e("button",{disabled:M.value,onClick:J,type:"button",class:"rounded-md bg-rose-600 px-4 py-2 text-sm font-medium text-white hover:bg-rose-700 disabled:opacity-60"},d(M.value?"Deleting...":"Delete"),9,ct)])])])):x("",!0)]),_:1})],64))}};export{bt as default};
