import{r as p,q as v,j as H,c as r,a as _,b as e,w as j,e as I,u as F,l as D,t as o,p as f,s as U,z as X,F as h,y as g,o as i,n as G}from"./app-CNtTXHrN.js";import{_ as O}from"./Header-BHK__-nG.js";import{_ as W}from"./Footer-CdGFEjz1.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const J={class:"min-h-screen bg-white antialiased"},K={class:"mx-auto max-w-7xl px-3 sm:px-4 lg:px-8 py-10"},Q={class:"mb-6 text-sm text-gray-600","aria-label":"Breadcrumb"},Y={class:"flex items-center gap-2"},ee={class:"text-gray-900 font-medium truncate max-w-[12rem] sm:max-w-none"},te={class:"mb-6"},se={class:"flex items-start justify-between gap-3"},ae={class:"flex-1"},le={class:"text-center space-y-1"},oe={key:0,class:"text-xl sm:text-2xl font-extrabold text-emerald-800 uppercase"},ne={key:0},re={key:1,class:"text-emerald-900"},ie={class:"text-sm sm:text-base font-semibold text-sky-700 uppercase"},de={class:"shrink-0 flex items-center gap-2 print:hidden"},ce=["value"],ue={class:"mb-6 text-center"},xe={class:"mt-2 overflow-x-auto"},me={class:"mx-auto inline-block rounded-lg border border-emerald-200 bg-emerald-50/70 p-1.5 shadow-sm ring-1 ring-inset ring-emerald-100"},pe={class:"divide-y divide-emerald-200 text-xs"},fe={class:"divide-y divide-emerald-100"},ye={class:"px-3 py-1 font-medium text-emerald-900"},ve={class:"px-3 py-1 text-center text-emerald-900"},he={class:"px-3 py-1 text-center text-emerald-900"},ge={class:"px-3 py-1 text-center text-emerald-900"},be={class:"px-3 py-1 text-center text-emerald-900"},_e={class:"px-3 py-1 text-center text-emerald-900"},Ie={class:"overflow-x-auto rounded-xl border border-gray-200 bg-white shadow-lg"},ke={class:"min-w-full divide-y divide-gray-200 text-sm"},we={class:"bg-gray-50"},Ae={class:"leading-tight"},Ce={class:"divide-y divide-gray-100"},Se={class:"px-3 py-2 text-slate-900 whitespace-nowrap"},Ne={class:"px-3 py-2 text-slate-900"},Re={class:"px-3 py-2 text-slate-800"},Me={class:"px-3 py-2 text-center text-slate-800"},Ve={class:"px-3 py-2 text-center text-slate-800"},je={class:"px-3 py-2 text-center text-slate-800"},Fe={class:"px-3 py-2 text-center text-slate-800"},De={key:0},Be=["colspan"],Le={key:1},Ee=["colspan"],Te={class:"mt-10"},$e={class:"overflow-x-auto rounded-xl border border-gray-200 bg-white shadow-lg"},ze={class:"min-w-full divide-y divide-gray-200 text-sm"},Pe={class:"divide-y divide-gray-100"},qe={class:"px-3 py-2 text-sm font-semibold text-slate-700"},He={class:"px-3 py-2 text-slate-900"},Ue={class:"flex items-center gap-2"},Xe={class:"font-medium"},Ge={key:0,class:"rounded-full bg-emerald-100 px-2 py-0.5 text-xs font-medium text-emerald-700"},Oe={key:1,class:"rounded-full bg-rose-100 px-2 py-0.5 text-xs font-medium text-rose-700"},We={class:"px-3 py-2 text-center"},Ze={class:"px-3 py-2 text-center text-emerald-700 font-medium"},Je={class:"px-3 py-2 text-center text-emerald-600"},Ke={class:"px-3 py-2 text-center text-amber-600"},Qe={class:"px-3 py-2 text-center text-orange-500"},Ye={class:"px-3 py-2 text-center text-rose-600 font-semibold"},et={class:"px-3 py-2 text-center text-slate-900 font-semibold"},tt={key:0},st={__name:"View",props:{schoolId:{type:[String,Number],required:!0},examId:{type:Number,required:!0}},setup(S){const k=S,w=p(!1),N=p(""),c=p(null),A=p({F:{I:0,II:0,III:0,IV:0,0:0},M:{I:0,II:0,III:0,IV:0,0:0},T:{I:0,II:0,III:0,IV:0,0:0}}),u=p([]),y=p([]),x=p(""),L=v(()=>[{label:"F",...A.value.F},{label:"M",...A.value.M},{label:"T",...A.value.T}]);v(()=>{const a=Array.isArray(u.value)?u.value.slice():[];return a.sort((t,s)=>(s.aggregate||0)-(t.aggregate||0)),a.slice(0,3)}),v(()=>{const a=(Array.isArray(u.value)?u.value:[]).filter(t=>String(t.division||"").toUpperCase()==="0");return a.sort((t,s)=>(t.aggregate||0)-(s.aggregate||0)),a.slice(0,3)});function R(a,t){const s=[a?.name,a?.title,a?.label,a?.full_name,a?.code],l=s.find(d=>typeof d=="string"&&/[A-Za-z]/.test(d));if(l)return l;const n=s.find(d=>typeof d=="string"&&d.trim()!=="");return n||`Subject ${t}`}const b=v(()=>{const a=new Map;let t=1;for(const s of u.value)for(const l of s.subjects||[]){const n=l.code??l.name??`subject-${t}`;if(!a.has(n))a.set(n,{key:n,code:l.code??null,name:l.name??null,displayName:R(l,t)}),t++;else{const d=a.get(n);!d.name&&l.name&&(d.name=l.name),!d.code&&l.code&&(d.code=l.code),(!d.displayName||!/[A-Za-z]/.test(d.displayName))&&(d.displayName=R(l,t))}}return Array.from(a.values())});v(()=>{const a=new Map;for(const t of b.value)t.code&&a.set(t.code,t.displayName),t.name&&a.set(t.name,t.displayName),a.set(t.key,t.displayName);return a});function E(a,t){const s=a.subjects||[];let l=null;if(t.code&&(l=s.find(n=>n.code===t.code)),!l&&t.name){const n=String(t.name).toLowerCase();l=s.find(d=>String(d.name||"").toLowerCase()===n)}return l&&typeof l.marks=="number"?l.marks:"-"}function T(a){let t=0;for(const s of a.subjects||[])typeof s.marks=="number"&&(t+=s.marks);return t}function B(a){let t=0,s=0;for(const l of a.subjects||[])typeof l.marks=="number"&&(t+=l.marks,s++);return s?Math.round(t/s):0}function $(a){const t=B(a);return t>=75?"A":t>=65?"B":t>=55?"C":t>=40?"D":t>0?"F":"-"}function z(a){return a>=80?"bg-emerald-100 text-emerald-700":a>=60?"bg-sky-100 text-sky-700":a>=40?"bg-amber-100 text-amber-700":"bg-rose-100 text-rose-700"}async function P(){try{const t=await(await fetch(`/api/public/schools/${k.schoolId}/exams`,{headers:{"X-Requested-With":"XMLHttpRequest"}})).json();c.value=Array.isArray(t)&&t.find(s=>s.id===k.examId)||null}catch{c.value=null}}async function M(){w.value=!0;try{const a=new URL(`/api/public/schools/${k.schoolId}/exams/${k.examId}/results`,window.location.origin);x.value?a.searchParams.set("class_name",x.value):y.value.length>0&&a.searchParams.set("class_name",y.value[0]);const s=await(await fetch(a,{headers:{"X-Requested-With":"XMLHttpRequest"}})).json();N.value=s?.school?.school_name||"",y.value=Array.isArray(s?.classes)?s.classes:[],A.value=s?.summary||{F:{I:0,II:0,III:0,IV:0,0:0},M:{I:0,II:0,III:0,IV:0,0:0},T:{I:0,II:0,III:0,IV:0,0:0}},u.value=Array.isArray(s?.students)?s.students:[]}finally{w.value=!1}}H(async()=>{try{const t=new URLSearchParams(window.location.search).get("class_name");t&&(x.value=t)}catch{}await P(),await M(),!x.value&&y.value.length>0&&(x.value=y.value[0],await M())});function q(){window.print()}const V=v(()=>{const a=new Map;let t=1;for(const l of u.value)for(const n of l.subjects||[]){const d=n.code??n.name??`subject-${t}`;a.has(d)||(a.set(d,{key:d,code:n.code??null,name:n.name??n.code??`Subject ${t}`,A:0,B:0,C:0,D:0,F:0,sum:0,cnt:0,pass:0,displayName:R(n,t)}),t++);const m=a.get(d),C=String(n.grade||"").toUpperCase();C==="A"?m.A++:C==="B"?m.B++:C==="C"?m.C++:C==="D"?m.D++:m.F++,typeof n.marks=="number"&&(m.sum+=n.marks,m.cnt++),typeof n.marks=="number"&&n.marks>=40&&m.pass++}const s=Array.from(a.values()).map(l=>({...l,avg:l.cnt?Math.round(l.sum/l.cnt):0,passRate:l.cnt?Math.round(l.pass/l.cnt*100):0}));return s.sort((l,n)=>n.passRate===l.passRate?n.avg-l.avg:n.passRate-l.passRate),s.map((l,n)=>({...l,position:n+1}))});return(a,t)=>(i(),r("div",J,[_(O),e("section",K,[e("nav",Q,[e("ol",Y,[e("li",null,[_(F(D),{href:"/",class:"hover:text-green-700"},{default:j(()=>[...t[1]||(t[1]=[I("Home",-1)])]),_:1})]),t[3]||(t[3]=e("li",null,"/",-1)),e("li",null,[_(F(D),{href:"/results/schools",class:"hover:text-green-700"},{default:j(()=>[...t[2]||(t[2]=[I("Results",-1)])]),_:1})]),t[4]||(t[4]=e("li",null,"/",-1)),e("li",null,[_(F(D),{href:a.route("results.schools.show",{id:S.schoolId}),class:"hover:text-green-700"},{default:j(()=>[I(o(N.value||"School"),1)]),_:1},8,["href"])]),t[5]||(t[5]=e("li",null,"/",-1)),e("li",ee,o(c.value&&c.value.name||"Exam"),1)])]),e("div",te,[e("div",se,[e("div",ae,[e("div",le,[t[6]||(t[6]=e("div",{class:"text-[11px] sm:text-xs tracking-wide text-gray-600 uppercase"},"Regional Administration and Local Government",-1)),t[7]||(t[7]=e("div",{class:"text-[11px] sm:text-xs tracking-wide text-gray-600 uppercase"},"Form Results",-1)),c.value?(i(),r("div",oe,[I(o(c.value&&c.value.name||"Exam")+" Examination Results ",1),c.value&&c.value.year?(i(),r("span",ne,", "+o(c.value.year),1)):f("",!0),x.value?(i(),r("span",re," - "+o(String(x.value).toUpperCase()),1)):f("",!0)])):f("",!0),e("div",ie,o(String(S.schoolId))+" - "+o(N.value||"School Centre"),1)])]),e("div",de,[U(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>x.value=s),onChange:M,class:"rounded-md border-gray-300 text-sm shadow-sm focus:border-green-600 focus:ring-green-600"},[t[8]||(t[8]=e("option",{value:""},"Select Class",-1)),(i(!0),r(h,null,g(y.value,s=>(i(),r("option",{key:s,value:s},o(s),9,ce))),128))],544),[[X,x.value]]),e("button",{onClick:q,class:"inline-flex items-center rounded-md border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50"},[...t[9]||(t[9]=[e("svg",{class:"mr-2 h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[e("path",{d:"M19 8H5a3 3 0 0 0-3 3v5h4v4h12v-4h4v-5a3 3 0 0 0-3-3zM7 18h10v2H7v-2zm13-3H4v-4a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v4z"}),e("path",{d:"M17 2H7v4h10V2z"})],-1),I(" Print ",-1)])])])])]),e("div",ue,[t[11]||(t[11]=e("div",{class:"text-center text-xs font-semibold text-emerald-800 uppercase"},"Division Performance Summary",-1)),e("div",xe,[e("div",me,[e("table",pe,[t[10]||(t[10]=e("thead",null,[e("tr",{class:"bg-emerald-100/70"},[e("th",{class:"px-3 py-1 text-left font-semibold text-emerald-900"},"SEX"),e("th",{class:"px-3 py-1 text-center font-semibold text-emerald-900"},"I"),e("th",{class:"px-3 py-1 text-center font-semibold text-emerald-900"},"II"),e("th",{class:"px-3 py-1 text-center font-semibold text-emerald-900"},"III"),e("th",{class:"px-3 py-1 text-center font-semibold text-emerald-900"},"IV"),e("th",{class:"px-3 py-1 text-center font-semibold text-emerald-900"},"0")])],-1)),e("tbody",fe,[(i(!0),r(h,null,g(L.value,s=>(i(),r("tr",{key:s.label,class:"bg-white/70"},[e("td",ye,o(s.label),1),e("td",ve,o(s.I),1),e("td",he,o(s.II),1),e("td",ge,o(s.III),1),e("td",be,o(s.IV),1),e("td",_e,o(s[0]),1)]))),128))])])])])]),e("div",Ie,[e("table",ke,[e("thead",we,[e("tr",null,[t[12]||(t[12]=e("th",{class:"px-3 py-1 text-left font-semibold text-rose-900"},"CNO",-1)),t[13]||(t[13]=e("th",{class:"px-3 py-2 text-left font-semibold text-slate-800"},"STUDENT NAME",-1)),t[14]||(t[14]=e("th",{class:"px-3 py-2 text-left font-semibold text-slate-800"},"SEX",-1)),(i(!0),r(h,null,g(b.value,s=>(i(),r("th",{key:s.key,class:"px-3 py-2 text-center font-semibold text-slate-800"},[e("div",Ae,[e("div",null,o(s.displayName),1)])]))),128)),t[15]||(t[15]=e("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"TOTAL",-1)),t[16]||(t[16]=e("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"AVG",-1)),t[17]||(t[17]=e("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"GRADE",-1)),t[18]||(t[18]=e("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"DIV",-1))])]),e("tbody",Ce,[(i(!0),r(h,null,g(u.value,s=>(i(),r("tr",{key:s.reg_no,class:"hover:bg-slate-50"},[e("td",Se,o(s.reg_no),1),e("td",Ne,o(s.name||s.student_name||"—"),1),e("td",Re,o(s.sex),1),(i(!0),r(h,null,g(b.value,l=>(i(),r("td",{key:l.key,class:"px-3 py-2 text-center text-slate-800"},o(E(s,l)),1))),128)),e("td",Me,o(T(s)),1),e("td",Ve,o(B(s)),1),e("td",je,o($(s)),1),e("td",Fe,o(s.division),1)]))),128)),!w.value&&u.value.length===0?(i(),r("tr",De,[e("td",{colspan:3+b.value.length+4,class:"px-3 py-8 text-center text-gray-600"},"No results found.",8,Be)])):f("",!0),w.value?(i(),r("tr",Le,[e("td",{colspan:3+b.value.length+4,class:"px-3 py-8 text-center text-gray-600"},"Loading results...",8,Ee)])):f("",!0)])])]),e("div",Te,[t[21]||(t[21]=e("div",{class:"mb-3 text-center text-sm font-semibold text-slate-800"},"Performance by Subject",-1)),e("div",$e,[e("table",ze,[t[20]||(t[20]=e("thead",{class:"bg-slate-100"},[e("tr",null,[e("th",{class:"px-3 py-2 text-left font-semibold text-slate-800"},"#"),e("th",{class:"px-3 py-2 text-left font-semibold text-slate-800"},"Subject"),e("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"Pass %"),e("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"A"),e("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"B"),e("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"C"),e("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"D"),e("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"F"),e("th",{class:"px-3 py-2 text-center font-semibold text-slate-800"},"Average")])],-1)),e("tbody",Pe,[(i(!0),r(h,null,g(V.value,s=>(i(),r("tr",{key:s.key,class:"hover:bg-slate-50"},[e("td",qe,o(s.position),1),e("td",He,[e("div",Ue,[e("span",Xe,o(s.displayName),1),s.position===1?(i(),r("span",Ge,"Best")):s.position===V.value.length?(i(),r("span",Oe,"Lowest")):f("",!0)])]),e("td",We,[e("span",{class:G([z(s.passRate),"inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold"])},o(s.passRate)+"% ",3)]),e("td",Ze,o(s.A),1),e("td",Je,o(s.B),1),e("td",Ke,o(s.C),1),e("td",Qe,o(s.D),1),e("td",Ye,o(s.F),1),e("td",et,o(s.avg),1)]))),128)),V.value.length===0?(i(),r("tr",tt,[...t[19]||(t[19]=[e("td",{colspan:"9",class:"px-3 py-8 text-center text-gray-600"},"No subject data.",-1)])])):f("",!0)])])])])]),_(W)]))}},rt=Z(st,[["__scopeId","data-v-32c00d8d"]]);export{rt as default};
