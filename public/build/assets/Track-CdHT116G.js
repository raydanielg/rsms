import{r as u,q as B,c as l,a as k,b as e,p as c,s as V,D as X,F as v,y as h,t as a,e as _,w as E,u as M,l as N,o as i,n as U}from"./app-D5MV6r13.js";import{_ as H}from"./Header-dBQtE1X9.js";import{_ as I}from"./Footer-BsV406YB.js";const W={class:"min-h-screen bg-white antialiased"},z={class:"mx-auto max-w-5xl px-3 sm:px-4 lg:px-8 py-10"},F={class:"mx-auto max-w-3xl"},G={class:"relative"},P={key:0,class:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400"},J={key:0,class:"relative mt-2"},K={class:"absolute z-10 w-full overflow-hidden rounded-xl border border-gray-200 bg-white shadow-xl"},O={class:"divide-y divide-gray-100 text-sm"},Y=["onClick"],Q={class:"flex items-center justify-between gap-3"},Z={class:"min-w-0"},ee={class:"truncate font-medium text-gray-900"},te={class:"truncate text-xs text-gray-600"},se={class:"shrink-0 rounded-full bg-emerald-50 px-2 py-0.5 text-[11px] font-medium text-emerald-700"},ae={key:0,class:"px-4 py-4 text-center text-gray-600"},oe={key:0,class:"mt-8"},le={class:"mx-auto max-w-3xl rounded-2xl border border-gray-200 bg-white p-4 shadow-sm"},ie={class:"flex items-start justify-between"},ne={class:"text-lg font-semibold text-gray-900"},re={class:"mt-1 text-sm text-gray-700"},de={class:"font-medium"},ue={class:"mt-1 text-sm text-gray-700"},ce={class:"font-medium"},me={class:"mt-1 text-sm text-gray-700"},xe={class:"font-medium"},pe={class:"mt-1 text-sm text-gray-700"},ve={class:"font-medium"},he={class:"shrink-0 flex gap-2"},_e={key:1,class:"mx-auto mt-8 max-w-5xl"},fe={class:"grid gap-4 lg:grid-cols-3"},ye={class:"border-b bg-slate-50 px-4 py-2 text-sm font-semibold text-slate-800 uppercase"},ge={class:"divide-y divide-slate-100 text-sm"},be={class:"flex items-start justify-between"},we={class:"font-medium text-slate-900"},ke={class:"text-xs text-slate-600"},Se=["onClick","disabled"],Ce={key:0,class:"mt-3 overflow-x-auto rounded-lg border border-slate-200"},Re={class:"min-w-full divide-y divide-slate-200 text-xs"},je={class:"divide-y divide-slate-100"},Te={class:"px-2 py-1 text-slate-900"},qe={class:"leading-tight"},Ae={key:0,class:"text-[10px] text-slate-500"},De={class:"px-2 py-1 text-right text-slate-800"},Le={class:"px-2 py-1 text-right"},$e={class:"rounded-xl border border-amber-200 bg-amber-50/60 shadow-sm lg:col-span-3"},Be={class:"p-3"},Ve={class:"divide-y divide-amber-100 text-sm"},Xe={class:"flex items-start justify-between gap-3"},Ee={class:"font-medium text-amber-900"},Me={class:"text-amber-800/80"},Ne={class:"shrink-0 text-xs text-amber-700"},Ue={key:0,class:"py-4 text-center text-amber-800/80"},He={key:1,class:"py-4 text-center text-amber-800/80"},Ge={__name:"Track",setup(Ie){const f=u(""),y=u(!1),b=u(!1),p=u([]),r=u(null);let S=null;const C=u([]),x=u(new Set),R=u(!1),w=u([]),g=u(!1),j=B(()=>{const o={};for(const t of C.value){const s=(t.type||"Exam").toString().toUpperCase();o[s]||(o[s]=[]),o[s].push(t)}for(const t of Object.keys(o))o[t].sort((s,d)=>d.year-s.year||d.term-s.term||d.id-s.id);return o});async function T(o){if(!o){p.value=[];return}y.value=!0;try{const s=await(await fetch(`/api/public/students/search?query=${encodeURIComponent(o)}`,{headers:{"X-Requested-With":"XMLHttpRequest"}})).json();p.value=Array.isArray(s)?s:[]}catch{p.value=[]}finally{y.value=!1}}function q(){b.value=!0,clearTimeout(S),S=setTimeout(()=>T(f.value),300)}async function A(o){b.value=!1,f.value=o.name;try{const s=await(await fetch(`/api/public/students/${o.id}`,{headers:{"X-Requested-With":"XMLHttpRequest"}})).json();r.value=s&&s.id?s:null}catch{r.value=o}x.value=new Set,R.value=!0,g.value=!0;try{const[t,s]=await Promise.all([fetch(`/api/public/students/${o.id}/results`,{headers:{"X-Requested-With":"XMLHttpRequest"}}),fetch(`/api/public/students/${o.id}/behaviours`,{headers:{"X-Requested-With":"XMLHttpRequest"}})]),d=await t.json(),n=await s.json();C.value=Array.isArray(d?.exams)?d.exams:[],w.value=Array.isArray(n)?n:[]}finally{R.value=!1,g.value=!1}}function D(o){const t=new Set(x.value);t.add(o),x.value=t}function L(o){const t=(o||"").toUpperCase();return t==="A"?"inline-flex items-center rounded-full bg-emerald-100 px-2 py-0.5 text-[11px] font-semibold text-emerald-800":t==="B"?"inline-flex items-center rounded-full bg-green-100 px-2 py-0.5 text-[11px] font-semibold text-green-800":t==="C"?"inline-flex items-center rounded-full bg-amber-100 px-2 py-0.5 text-[11px] font-semibold text-amber-800":t==="D"?"inline-flex items-center rounded-full bg-orange-100 px-2 py-0.5 text-[11px] font-semibold text-orange-800":"inline-flex items-center rounded-full bg-rose-100 px-2 py-0.5 text-[11px] font-semibold text-rose-800"}function $(o){try{return new Date(o).toLocaleDateString()}catch{return o}}return(o,t)=>(i(),l("div",W,[k(H),e("section",z,[t[10]||(t[10]=e("div",{class:"mb-6"},[e("div",{class:"text-center space-y-1"},[e("div",{class:"text-[11px] sm:text-xs tracking-wide text-black uppercase"},"Student Tracker"),e("div",{class:"text-xl sm:text-2xl font-extrabold text-emerald-800 uppercase"},"Search Student")])],-1)),e("div",F,[e("div",G,[V(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>f.value=s),onInput:q,type:"text",placeholder:"Type student name or reg no...",class:"w-full rounded-xl border border-gray-300 bg-white px-4 py-3 text-sm shadow-sm focus:border-emerald-600 focus:outline-none focus:ring-1 focus:ring-emerald-600"},null,544),[[X,f.value,void 0,{trim:!0}]]),y.value?(i(),l("div",P,[...t[1]||(t[1]=[e("svg",{class:"h-5 w-5 animate-spin",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("circle",{cx:"12",cy:"12",r:"10","stroke-width":"2",opacity:"0.25"}),e("path",{d:"M4 12a8 8 0 0 1 8-8","stroke-width":"2"})],-1)])])):c("",!0)]),b.value?(i(),l("div",J,[e("div",K,[e("ul",O,[(i(!0),l(v,null,h(p.value,s=>(i(),l("li",{key:s.id,class:"flex items-center justify-between px-4 py-2 hover:bg-gray-50"},[e("button",{type:"button",class:"w-full text-left",onClick:d=>A(s)},[e("div",Q,[e("div",Z,[e("div",ee,a(s.name),1),e("div",te,a(s.reg_no)+" • "+a(s.class_name)+" • "+a(s.school_name),1)]),e("span",se,a(s.sex),1)])],8,Y)]))),128)),!y.value&&p.value.length===0?(i(),l("li",ae,"No results")):c("",!0)])])])):c("",!0)]),r.value?(i(),l("div",oe,[e("div",le,[e("div",ie,[e("div",null,[e("div",ne,a(r.value.name),1),e("div",re,[t[2]||(t[2]=_("Reg No: ",-1)),e("span",de,a(r.value.reg_no),1)]),e("div",ue,[t[3]||(t[3]=_("Class: ",-1)),e("span",ce,a(r.value.class_name),1)]),e("div",me,[t[4]||(t[4]=_("School: ",-1)),e("span",xe,a(r.value.school_name)+" ("+a(r.value.school_number)+")",1)]),e("div",pe,[t[5]||(t[5]=_("Sex: ",-1)),e("span",ve,a(r.value.sex),1)])]),e("div",he,[k(M(N),{href:`/results/schools/${r.value.school_number}`,class:"rounded-md border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50"},{default:E(()=>[...t[6]||(t[6]=[_("View School",-1)])]),_:1},8,["href"])])])])])):c("",!0),r.value?(i(),l("div",_e,[t[9]||(t[9]=e("div",{class:"mb-3 text-center text-sm font-semibold text-slate-800"},"Student Results",-1)),e("div",fe,[(i(!0),l(v,null,h(j.value,(s,d)=>(i(),l("div",{key:d,class:"rounded-xl border border-slate-200 bg-white shadow-sm"},[e("div",ye,a(d),1),e("ul",ge,[(i(!0),l(v,null,h(s,n=>(i(),l("li",{key:n.id,class:"p-3"},[e("div",be,[e("div",null,[e("div",we,a(n.name),1),e("div",ke,"Year "+a(n.year)+" • Term "+a(n.term)+" • DIV "+a(n.division)+" • AVG "+a(n.aggregate),1)]),e("button",{type:"button",onClick:m=>D(n.id),disabled:x.value.has(n.id),class:"rounded-md px-2 py-1 text-xs font-medium text-emerald-700 ring-1 ring-inset ring-emerald-200 hover:bg-emerald-50 disabled:cursor-default disabled:opacity-60"},a(x.value.has(n.id)?"Expanded":"Expand"),9,Se)]),x.value.has(n.id)?(i(),l("div",Ce,[e("table",Re,[t[7]||(t[7]=e("thead",{class:"bg-slate-50"},[e("tr",null,[e("th",{class:"px-2 py-1 text-left font-semibold text-slate-800"},"SUBJECT"),e("th",{class:"px-2 py-1 text-right font-semibold text-slate-800"},"MARKS"),e("th",{class:"px-2 py-1 text-right font-semibold text-slate-800"},"GRADE")])],-1)),e("tbody",je,[(i(!0),l(v,null,h(n.subjects,m=>(i(),l("tr",{key:m.code,class:"hover:bg-slate-50"},[e("td",Te,[e("div",qe,[e("div",null,a(m.code),1),m.name?(i(),l("div",Ae,a(m.name),1)):c("",!0)])]),e("td",De,a(m.marks),1),e("td",Le,[e("span",{class:U(L(m.grade))},a(m.grade),3)])]))),128))])])])):c("",!0)]))),128))])]))),128)),e("div",$e,[t[8]||(t[8]=e("div",{class:"border-b bg-amber-100/70 px-4 py-2 text-sm font-semibold text-amber-900 uppercase"},"Behaviours",-1)),e("div",Be,[e("ul",Ve,[(i(!0),l(v,null,h(w.value,s=>(i(),l("li",{key:s.id,class:"py-2"},[e("div",Xe,[e("div",null,[e("div",Ee,a(s.type),1),e("div",Me,a(s.note),1)]),e("div",Ne,a($(s.created_at)),1)])]))),128)),!g.value&&w.value.length===0?(i(),l("li",Ue,"No behaviours found.")):c("",!0),g.value?(i(),l("li",He,"Loading behaviours...")):c("",!0)])])])])])):c("",!0)]),k(I)]))}};export{Ge as default};
